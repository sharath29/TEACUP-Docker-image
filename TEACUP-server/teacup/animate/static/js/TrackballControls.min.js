// threejs.org/license
THREE.TrackballControls=function(G,F){var u=this;var v={NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM_PAN:4};this.object=G;this.domElement=(F!==undefined)?F:document;this.enabled=true;this.screen={left:0,top:0,width:0,height:0};this.rotateSpeed=1;this.zoomSpeed=1.2;this.panSpeed=0.3;this.noRotate=false;this.noZoom=false;this.noPan=false;this.staticMoving=false;this.dynamicDampingFactor=0.2;this.minDistance=0;this.maxDistance=Infinity;this.keys=[65,83,68];this.target=new THREE.Vector3();var m=0.000001;var l=new THREE.Vector3();var w=v.NONE,p=v.NONE,a=new THREE.Vector3(),q=new THREE.Vector2(),B=new THREE.Vector2(),E=new THREE.Vector3(),b=0,n=new THREE.Vector2(),z=new THREE.Vector2(),k=0,d=0,f=new THREE.Vector2(),y=new THREE.Vector2();this.target0=this.target.clone();this.position0=this.object.position.clone();this.up0=this.object.up.clone();var D={type:"change"};var o={type:"start"};var j={type:"end"};this.handleResize=function(){if(this.domElement===document){this.screen.left=0;this.screen.top=0;this.screen.width=window.innerWidth;this.screen.height=window.innerHeight}else{var H=this.domElement.getBoundingClientRect();var I=this.domElement.ownerDocument.documentElement;this.screen.left=H.left+window.pageXOffset-I.clientLeft;this.screen.top=H.top+window.pageYOffset-I.clientTop;this.screen.width=H.width;this.screen.height=H.height}};this.handleEvent=function(H){if(typeof this[H.type]=="function"){this[H.type](H)}};var c=(function(){var H=new THREE.Vector2();return function(J,I){H.set((J-u.screen.left)/u.screen.width,(I-u.screen.top)/u.screen.height);return H}}());var e=(function(){var H=new THREE.Vector2();return function(J,I){H.set(((J-u.screen.width*0.5-u.screen.left)/(u.screen.width*0.5)),((u.screen.height+2*(u.screen.top-I))/u.screen.width));return H}}());this.rotateCamera=(function(){var K=new THREE.Vector3(),M=new THREE.Quaternion(),L=new THREE.Vector3(),I=new THREE.Vector3(),H=new THREE.Vector3(),J=new THREE.Vector3(),N;return function(){J.set(B.x-q.x,B.y-q.y,0);N=J.length();if(N){a.copy(u.object.position).sub(u.target);L.copy(a).normalize();I.copy(u.object.up).normalize();H.crossVectors(I,L).normalize();I.setLength(B.y-q.y);H.setLength(B.x-q.x);J.copy(I.add(H));K.crossVectors(J,a).normalize();N*=u.rotateSpeed;M.setFromAxisAngle(K,N);a.applyQuaternion(M);u.object.up.applyQuaternion(M);E.copy(K);b=N}else{if(!u.staticMoving&&b){b*=Math.sqrt(1-u.dynamicDampingFactor);a.copy(u.object.position).sub(u.target);M.setFromAxisAngle(E,b);a.applyQuaternion(M);u.object.up.applyQuaternion(M)}}q.copy(B)}}());this.zoomCamera=function(){var H;if(w===v.TOUCH_ZOOM_PAN){H=k/d;k=d;a.multiplyScalar(H)}else{H=1+(z.y-n.y)*u.zoomSpeed;if(H!==1&&H>0){a.multiplyScalar(H);if(u.staticMoving){n.copy(z)}else{n.y+=(z.y-n.y)*this.dynamicDampingFactor}}}};this.panCamera=(function(){var I=new THREE.Vector2(),H=new THREE.Vector3(),J=new THREE.Vector3();return function(){I.copy(y).sub(f);if(I.lengthSq()){I.multiplyScalar(a.length()*u.panSpeed);J.copy(a).cross(u.object.up).setLength(I.x);J.add(H.copy(u.object.up).setLength(I.y));u.object.position.add(J);u.target.add(J);if(u.staticMoving){f.copy(y)}else{f.add(I.subVectors(y,f).multiplyScalar(u.dynamicDampingFactor))}}}}());this.checkDistances=function(){if(!u.noZoom||!u.noPan){if(a.lengthSq()>u.maxDistance*u.maxDistance){u.object.position.addVectors(u.target,a.setLength(u.maxDistance))}if(a.lengthSq()<u.minDistance*u.minDistance){u.object.position.addVectors(u.target,a.setLength(u.minDistance))}}};this.update=function(){a.subVectors(u.object.position,u.target);if(!u.noRotate){u.rotateCamera()}if(!u.noZoom){u.zoomCamera()}if(!u.noPan){u.panCamera()}u.object.position.addVectors(u.target,a);u.checkDistances();u.object.lookAt(u.target);if(l.distanceToSquared(u.object.position)>m){u.dispatchEvent(D);l.copy(u.object.position)}};this.reset=function(){w=v.NONE;p=v.NONE;u.target.copy(u.target0);u.object.position.copy(u.position0);u.object.up.copy(u.up0);a.subVectors(u.object.position,u.target);u.object.lookAt(u.target);u.dispatchEvent(D);l.copy(u.object.position)};function i(H){if(u.enabled===false){return}window.removeEventListener("keydown",i);p=w;if(w!==v.NONE){return}else{if(H.keyCode===u.keys[v.ROTATE]&&!u.noRotate){w=v.ROTATE}else{if(H.keyCode===u.keys[v.ZOOM]&&!u.noZoom){w=v.ZOOM}else{if(H.keyCode===u.keys[v.PAN]&&!u.noPan){w=v.PAN}}}}}function g(H){if(u.enabled===false){return}w=p;window.addEventListener("keydown",i,false)}function s(H){if(u.enabled===false){return}H.preventDefault();H.stopPropagation();if(w===v.NONE){w=H.button}if(w===v.ROTATE&&!u.noRotate){B.copy(e(H.pageX,H.pageY));q.copy(B)}else{if(w===v.ZOOM&&!u.noZoom){n.copy(c(H.pageX,H.pageY));z.copy(n)}else{if(w===v.PAN&&!u.noPan){f.copy(c(H.pageX,H.pageY));y.copy(f)}}}document.addEventListener("mousemove",A,false);document.addEventListener("mouseup",t,false);u.dispatchEvent(o)}function A(H){if(u.enabled===false){return}H.preventDefault();H.stopPropagation();if(w===v.ROTATE&&!u.noRotate){q.copy(B);B.copy(e(H.pageX,H.pageY))}else{if(w===v.ZOOM&&!u.noZoom){z.copy(c(H.pageX,H.pageY))}else{if(w===v.PAN&&!u.noPan){y.copy(c(H.pageX,H.pageY))}}}}function t(H){if(u.enabled===false){return}H.preventDefault();H.stopPropagation();w=v.NONE;document.removeEventListener("mousemove",A);document.removeEventListener("mouseup",t);u.dispatchEvent(j)}function r(H){if(u.enabled===false){return}H.preventDefault();H.stopPropagation();var I=0;if(H.wheelDelta){I=H.wheelDelta/40}else{if(H.detail){I=-H.detail/3}}n.y+=I*0.01;u.dispatchEvent(o);u.dispatchEvent(j)}function x(K){if(u.enabled===false){return}switch(K.touches.length){case 1:w=v.TOUCH_ROTATE;B.copy(e(K.touches[0].pageX,K.touches[0].pageY));q.copy(B);break;case 2:w=v.TOUCH_ZOOM_PAN;var J=K.touches[0].pageX-K.touches[1].pageX;var I=K.touches[0].pageY-K.touches[1].pageY;d=k=Math.sqrt(J*J+I*I);var H=(K.touches[0].pageX+K.touches[1].pageX)/2;var L=(K.touches[0].pageY+K.touches[1].pageY)/2;f.copy(c(H,L));y.copy(f);break;default:w=v.NONE}u.dispatchEvent(o)}function h(K){if(u.enabled===false){return}K.preventDefault();K.stopPropagation();switch(K.touches.length){case 1:q.copy(B);B.copy(e(K.touches[0].pageX,K.touches[0].pageY));break;case 2:var J=K.touches[0].pageX-K.touches[1].pageX;var I=K.touches[0].pageY-K.touches[1].pageY;d=Math.sqrt(J*J+I*I);var H=(K.touches[0].pageX+K.touches[1].pageX)/2;var L=(K.touches[0].pageY+K.touches[1].pageY)/2;y.copy(c(H,L));break;default:w=v.NONE}}function C(I){if(u.enabled===false){return}switch(I.touches.length){case 1:q.copy(B);B.copy(e(I.touches[0].pageX,I.touches[0].pageY));break;case 2:k=d=0;var H=(I.touches[0].pageX+I.touches[1].pageX)/2;var J=(I.touches[0].pageY+I.touches[1].pageY)/2;y.copy(c(H,J));f.copy(y);break}w=v.NONE;u.dispatchEvent(j)}this.domElement.addEventListener("contextmenu",function(H){H.preventDefault()},false);this.domElement.addEventListener("mousedown",s,false);this.domElement.addEventListener("mousewheel",r,false);this.domElement.addEventListener("DOMMouseScroll",r,false);this.domElement.addEventListener("touchstart",x,false);this.domElement.addEventListener("touchend",C,false);this.domElement.addEventListener("touchmove",h,false);window.addEventListener("keydown",i,false);window.addEventListener("keyup",g,false);this.handleResize();this.update()};THREE.TrackballControls.prototype=Object.create(THREE.EventDispatcher.prototype);THREE.TrackballControls.prototype.constructor=THREE.TrackballControls;