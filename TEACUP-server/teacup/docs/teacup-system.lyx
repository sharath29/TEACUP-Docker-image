#LyX 2.1 created this file. For more info see http://www.lyx.org/
\lyxformat 474
\begin_document
\begin_header
\textclass IEEEtran
\begin_preamble
\usepackage{fixltx2e}
\usepackage[noadjust]{cite}
%\usepackage[breaklinks=true,colorlinks=true,linkcolor=black,citecolor=black,urlcolor=black]{hyperref}
\usepackage{url}
\usepackage{balance}
\usepackage{textcomp}
%\usepackage{txfonts}

% against orphans/widows
\widowpenalty=10000
\clubpenalty=10000
\raggedbottom

% against overful hboxes
\sloppy

\usepackage{color}
\definecolor{lightgray}{gray}{0.95}

\usepackage[parfill]{parskip}

\usepackage{changepage}

\usepackage{lastpage}

% Change the \footnoterule command to separate footnotes from 
% the main text by a short horizontal rule (borrowed
% from the CAIA style)
\renewcommand{\footnoterule}
{
  \kern-3\p@
  \hrule\@width.4\columnwidth
  \kern2.6\p@
}

%% Mimic CAIA TR use of hyperlinks

% The "xcolor" package allows us to define the colours we will use for links   %
% within the PDF when we later load the "hyperref" package.                    %

\RequirePackage{xcolor}
\xdefinecolor{linkc}{RGB}{33,0,99}
\xdefinecolor{citec}{RGB}{0,0,0}
\xdefinecolor{caiablack}{RGB}{0,0,0}
\xdefinecolor{urlc}{RGB}{33,0,99}

% The "hyperref" package allows us to generate a PDF with associated PDF links %
% and bookmarks and other funky PDF stuff.                                     %

\RequirePackage[colorlinks=true,                  % Links are marked as coloured text, not coloured box.
                linkcolor= linkc,                 % Colour of in-document links (e.g. in the table of contents).
                citecolor= caiablack,             % Colour of bibliographic citations.
                urlcolor= urlc,                   % Colour of hyperlinks to the Net.
                pdfpagelayout=SinglePage,         % Initial view is page-by-page
                pdfstartview=FitV,                % Fit the document to window height.
               ]{hyperref}
\end_preamble
\options 11pt, a4paper, conference
\use_default_options false
\maintain_unincluded_children false
\language english
\language_package default
\inputencoding default
\fontencoding global
\font_roman default
\font_sans default
\font_typewriter default
\font_math auto
\font_default_family default
\use_non_tex_fonts false
\font_sc false
\font_osf false
\font_sf_scale 100
\font_tt_scale 100
\graphics default
\default_output_format default
\output_sync 0
\bibtex_command default
\index_command default
\float_placement tbh
\paperfontsize default
\spacing single
\use_hyperref false
\papersize a4paper
\use_geometry false
\use_package amsmath 0
\use_package amssymb 0
\use_package cancel 1
\use_package esint 0
\use_package mathdots 1
\use_package mathtools 1
\use_package mhchem 1
\use_package stackrel 1
\use_package stmaryrd 1
\use_package undertilde 1
\cite_engine basic
\cite_engine_type default
\biblio_style plain
\use_bibtopic false
\use_indices false
\paperorientation portrait
\suppress_date false
\justification true
\use_refstyle 0
\index Index
\shortcut idx
\color #008000
\end_index
\secnumdepth 3
\tocdepth 2
\paragraph_separation indent
\paragraph_indentation default
\quotes_language english
\papercolumns 2
\papersides 1
\paperpagestyle fancy
\tracking_changes false
\output_changes true
\html_math_output 0
\html_css_as_file 0
\html_be_strict false
\end_header

\begin_body

\begin_layout Standard
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
title{TEACUP v1.0 -- A System for Automated TCP Testbed Experiments}
\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
author{
\backslash
IEEEauthorblockN{Sebastian Zander, Grenville Armitage}
\end_layout

\begin_layout Plain Layout


\backslash
IEEEauthorblockA{Centre for Advanced Internet Architectures
\backslash

\backslash

\end_layout

\begin_layout Plain Layout

Swinburne University of Technology
\backslash

\backslash

\end_layout

\begin_layout Plain Layout

Melbourne, Australia
\backslash

\backslash

\end_layout

\begin_layout Plain Layout


\backslash
url{szander@swin.edu.au}, 
\backslash
url{garmitage@swin.edu.au}}}
\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
IEEEoverridecommandlockouts
\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset ERT
status open

\begin_layout Plain Layout

%This is how to make the abstract/index one column
\end_layout

\begin_layout Plain Layout

%
\backslash
IEEEoverridecommandlockouts
\end_layout

\begin_layout Plain Layout


\backslash
IEEEaftertitletext{
\backslash
vspace{-0.5
\backslash
baselineskip}
\end_layout

\begin_layout Plain Layout


\backslash
begin{adjustwidth*}{2.5cm}{2.5cm}
\end_layout

\begin_layout Plain Layout


\backslash
noindent
\end_layout

\begin_layout Plain Layout


\backslash
begin{abstract} Over the last few decades several TCP congestion control
 algorithms were developed in order to optimise TCP's behaviour in certain
 situations.
 While TCP was traditionally used mainly for file transfers, more recently
 it is also becoming the protocol of choice for streaming applications,
 for example video streaming from YouTube and Netflix is TCP-based 
\backslash
cite{Finamore2011,Rao2011} and there is an ISO standard for Dynamic Adaptive
 Streaming over HTTP (DASH) 
\backslash
cite{dash-standard}.
 However, the impact of different TCP congestion control algorithms on TCP-based
 streaming flows (within a mix of other typical traffic) is not well understood.
 Experiments in a controlled testbed allow shedding more light on this issue.
 This report describes TEACUP (TCP Experiment Automation Controlled Using
 Python) version 1.0 -- a software tool for running automated TCP experiments
 in a testbed.
 Based on a configuration file TEACUP can perform a series of experiments
 with different traffic mixes, different bottleneck configurations (such
 as bandwidths, queue mechanisms), different emulated network delays and/or
 loss rates, and different host settings (e.g.
 used TCP congestion control algorithm).
 For each experiment TEACUP automatically collects relevant information
 that allows analysing TCP behaviour, such as tcpdump files and TCP stack
 information.
\end_layout

\begin_layout Plain Layout


\backslash
end{abstract} 
\end_layout

\begin_layout Plain Layout

%
\backslash
vspace{0.5
\backslash
baselineskip}
\end_layout

\begin_layout Plain Layout


\backslash
noindent
\backslash
begin{keywords} TCP, experiments, automated control
\end_layout

\begin_layout Plain Layout


\backslash
end{keywords} 
\end_layout

\begin_layout Plain Layout


\backslash
end{adjustwidth*}
\end_layout

\begin_layout Plain Layout


\backslash
vspace{1
\backslash
baselineskip}
\end_layout

\begin_layout Plain Layout

}
\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
maketitle
\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
fancypagestyle{firstpage}{% Page style for first page
\end_layout

\begin_layout Plain Layout

  
\backslash
fancyhf{}% Clear header/footer
\end_layout

\begin_layout Plain Layout

  
\backslash
renewcommand{
\backslash
headrulewidth}{0pt}% Header rule
\end_layout

\begin_layout Plain Layout

  
\backslash
renewcommand{
\backslash
footrulewidth}{0pt}% Footer rule
\end_layout

\begin_layout Plain Layout

  
\backslash
fancyfoot[C]{
\backslash
small{
\backslash
copyright~2015 -- 2016 CAIA, Swinburne University of Technology
\backslash

\backslash
Originally published as 
\backslash
url{http://caia.swin.edu.au/reports/150529A/CAIA-TR-150529A.pdf}
\backslash

\backslash
This version released June 2016 under Creative Commons BY-SA 4.0 License
 -- see terms on page~
\backslash
pageref{sec:Copying}}}
\end_layout

\begin_layout Plain Layout

}
\end_layout

\begin_layout Plain Layout


\backslash
thispagestyle{firstpage}
\end_layout

\begin_layout Plain Layout

  
\backslash
pagestyle{fancy}
\end_layout

\begin_layout Plain Layout

  
\backslash
headheight 13.4pt
\end_layout

\begin_layout Plain Layout

  
\backslash
renewcommand{
\backslash
headrulewidth}{0pt}
\end_layout

\begin_layout Plain Layout

  
\backslash
lfoot{
\backslash
small{TEACUP v1.0 -- A System for Automated TCP Testbed Experiments}}
\end_layout

\begin_layout Plain Layout

  
\backslash
cfoot{}
\end_layout

\begin_layout Plain Layout

  
\backslash
rfoot{
\backslash
small{June 9, 2016~~page 
\backslash
thepage ~of 
\backslash
pageref{LastPage}}} 
\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Note Note
status open

\begin_layout Plain Layout
\begin_inset Newpage clearpage
\end_inset


\end_layout

\end_inset


\begin_inset Newpage newpage
\end_inset


\end_layout

\begin_layout Standard

\end_layout

\begin_layout Standard
\begin_inset ERT
status open

\begin_layout Plain Layout

%
\backslash
pdfbookmark{
\backslash
contentsname}{toc}
\end_layout

\begin_layout Plain Layout


\backslash
addtocontents{toc}{
\backslash
protect{
\backslash
pdfbookmark[0]{
\backslash
contentsname}{ToC}}}
\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset CommandInset toc
LatexCommand tableofcontents

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Newpage pagebreak
\end_inset


\end_layout

\begin_layout Section
Introduction
\end_layout

\begin_layout Standard
Over the last few decades several TCP congestion control algorithms were
 developed in order to optimise TCP's behaviour in certain situations.
 While TCP was traditionally used mainly for file transfers, more recently
 it is also becoming the protocol of choice for streaming applications,
 for example video streaming from YouTube and Netflix is TCP-based 
\begin_inset CommandInset citation
LatexCommand cite
key "Finamore2011,Rao2011"

\end_inset

 and there is an ISO standard for Dynamic Adaptive Streaming over HTTP (DASH)
 
\begin_inset CommandInset citation
LatexCommand cite
key "dash-standard"

\end_inset

.
 However, the impact of different TCP congestion control algorithms on TCP-based
 streaming flows (within a mix of other typical traffic) is not well understood.
 Experiments in a controlled testbed allow shedding more light on this issue.
 
\end_layout

\begin_layout Standard
This report describes TEACUP (TCP Experiment Automation Controlled Using
 Python) version 1.0 -- a software tool for running automated TCP experiments
 in a testbed.
 It updates the previous report describing TEACUP version 0.9 
\begin_inset CommandInset citation
LatexCommand cite
key "zander2015tcpperf-0.9"

\end_inset

.
 The TEACUP project originated at Swinburne University of Technology's Centre
 for Advanced Internet Architectures (
\begin_inset Flex URL
status open

\begin_layout Plain Layout

http://caia.swin.edu.au/tools/teacup
\end_layout

\end_inset

), and from version 1.0 the source code is freely available on SourceForge
 at 
\begin_inset Flex URL
status open

\begin_layout Plain Layout

http://sourceforge.net/projects/teacup
\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Note Note
status open

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
IEEEpubidadjcol
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
Based on a configuration file TEACUP can perform a series of experiments
 with different traffic mixes, different bottlenecks (such as bandwidths,
 queue mechanisms), different emulated network delays and/or loss rates,
 and different host settings (e.g.
 TCP congestion control algorithm).
 For each experiment TEACUP automatically collects relevant information
 that allows analysing TCP behaviour, such as tcpdump files, SIFTR 
\begin_inset CommandInset citation
LatexCommand cite
key "siftr"

\end_inset

 and Web10G 
\begin_inset CommandInset citation
LatexCommand cite
key "web10g"

\end_inset

 logs.
 A related technical report 
\begin_inset CommandInset citation
LatexCommand cite
key "zander2014caia_tcp_testbed_v2"

\end_inset

 describes the design and implementation of a specific testbed designed
 to be controlled by TEACUP.
 
\end_layout

\begin_layout Standard
TEACUP also provides a number of tasks for the analysis of data collected
 during experiments.
 The analysis aspect of TEACUP is quite distinct from the tasks that actually
 run experiments and gather testbed data, hence these are described in the
 accompanying technical report 
\begin_inset CommandInset citation
LatexCommand cite
key "zander2015caia_teacup_v1.0_analysis"

\end_inset

.
 
\end_layout

\begin_layout Standard
This report is organised as follows.
 Section 
\begin_inset CommandInset ref
LatexCommand ref
reference "sec:Design"

\end_inset

 describes the overall design of TEACUP -- the testbed network model, process
 flow and use of Fabric.
 Section 
\begin_inset CommandInset ref
LatexCommand ref
reference "sec:Traffic-generation-and"

\end_inset

 outlines the traffic generators and logging available under TEACUP, while
 host and bottleneck router configuration is summarised in Section 
\begin_inset CommandInset ref
LatexCommand ref
reference "sec:Host-and-Router"

\end_inset

.
 Section 
\begin_inset CommandInset ref
LatexCommand ref
reference "sec:Config"

\end_inset

 describes the configuration options available when running experiments
 as described in Section 
\begin_inset CommandInset ref
LatexCommand ref
reference "sec:Running"

\end_inset

.
 Section 
\begin_inset CommandInset ref
LatexCommand ref
reference "sec:Utility"

\end_inset

 describes utility functions that can be used for host maintenance.
 Section 
\begin_inset CommandInset ref
LatexCommand ref
reference "sec:Extending"

\end_inset

 outlines how to extend TEACUP.
 Section 
\begin_inset CommandInset ref
LatexCommand ref
reference "sec:Issues"

\end_inset

 lists known issues.
 Section 
\begin_inset CommandInset ref
LatexCommand ref
reference "sec:Conclusions"

\end_inset

 concludes and outlines future work.
\end_layout

\begin_layout Section
TEACUP Requirements and Design
\end_layout

\begin_layout Standard
\begin_inset CommandInset label
LatexCommand label
name "sec:Design"

\end_inset


\end_layout

\begin_layout Standard
This section describes the design of TEACUP.
 We first list the requirements.
 Then we describe the overall functional block design and the process flow.
 Finally, we describe the naming scheme for log files.
\end_layout

\begin_layout Subsection
Requirements
\end_layout

\begin_layout Standard
The following paragraphs describe the requirements that motivated our design
 of TEACUP.
\end_layout

\begin_layout Subsubsection
General
\end_layout

\begin_layout Standard
Create a system to automate performing a series of TCP experiments with
 varying parameters.
\end_layout

\begin_layout Subsubsection
Topology
\end_layout

\begin_layout Standard
TEACUP runs experiments in a controlled environment like that shown in Figure
 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:Testbed-topology"

\end_inset


\begin_inset space ~
\end_inset


\begin_inset CommandInset citation
LatexCommand cite
key "zander2014caia_tcp_testbed_v2"

\end_inset

, where one bottleneck router interconnects two 
\emph on
experiment networks
\emph default
.
 The experiment networks contain hosts that can act as traffic sources and
 sinks.
 The router, all hosts and TEACUP (on a control server) are also connected
 to a separate 
\emph on
control network
\emph default
.
\begin_inset Foot
status open

\begin_layout Plain Layout
The control server also runs a DHCP+TFTP server for the PXE boot setup described
 in 
\begin_inset CommandInset citation
LatexCommand cite
key "zander2014caia_tcp_testbed_v2"

\end_inset

.
\end_layout

\end_inset

 TEACUP configures hosts before each experiment and collects data from hosts
 after each experiment.
\begin_inset Foot
status open

\begin_layout Plain Layout
If the networks are implemented as VLANs on a suitable Ethernet switch,
 TEACUP can also automate the assignment of hosts to one or the other experiment
 network and associated VLAN (Section 
\begin_inset CommandInset ref
LatexCommand ref
reference "sub:topology_config"

\end_inset

).
 
\end_layout

\end_inset

 Where the control network is a private network, the control server may
 act as a NAT gateway enabling all testbed hosts to access the public Internet
 if necessary.
\end_layout

\begin_layout Standard
\begin_inset Float figure
placement t
wide true
sideways false
status open

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename figures/testbed2.pdf
	scale 50

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "fig:Testbed-topology"

\end_inset

Testbed topology
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Subsubsection
TCP algorithms
\end_layout

\begin_layout Standard
The following TCP congestion control algorithms must be supported: NewReno
 and CUBIC (representing classic loss-based algorithms), CompoundTCP (Microsoft'
s hybrid), CDG (CAIA's hybrid), and HD (Hamilton Institutes' delay-based
 TCP).
 Optionally other TCPs may be supported.
 All the noted TCP algorithms are sender-side variants, so the destination
 can be any standard TCP implementation.
 
\end_layout

\begin_layout Subsubsection
Path characteristics
\end_layout

\begin_layout Standard
The system must be able to create bottleneck bandwidth limits to represent
 likely consumer experience (e.g.
 ADSL) and some data centre scenarios.
 Emulation of constant path delay and loss in either direction is required
 to simulate different conditions between traffic sources and sinks.
 The emulation is implemented by the bottleneck node (router).
\end_layout

\begin_layout Subsubsection
Bottleneck AQM
\end_layout

\begin_layout Standard
The following Active Queuing Management (AQM) mechanisms are required: TailDrop/
FIFO, CoDel, PIE, RED.
 Optionally other AQM mechanisms may be supported.
 Since FreeBSD does not support some of the required AQMs the router must
 run Linux (but to allow comparison TEACUP also has some basic support for
 a FreeBSD router).
 The buffer size must be configurable.
\end_layout

\begin_layout Subsubsection
ECN Support
\end_layout

\begin_layout Standard
It must be possible to enable/disable Explicit Congestion Notification (ECN)
 on hosts and/or router.
\end_layout

\begin_layout Subsubsection
Host OS
\end_layout

\begin_layout Standard
We are OS-agnostic.
 However, to cover the various TCP algorithms 
\emph on
and
\emph default
 their common implementations TEACUP must support scenarios where sources
 and/or destinations are Windows (Compound), Linux (NewReno, CUBIC), FreeBSD
 (NewReno, CUBIC, CDG, HD) or Mac OS X (NewReno).
 Cygwin is used to instrument Windows 
\begin_inset CommandInset citation
LatexCommand cite
key "zander2014caia_tcp_testbed_v2"

\end_inset

.
\end_layout

\begin_layout Subsubsection
Traffic loads
\end_layout

\begin_layout Standard
The following traffic loads must be supported: Streaming media over HTTP/TCP
 (DASH-like), TCP bulk transfer, UDP flows (VoIP-like), and data centre
 query/response patterns (one query to 
\emph on
N
\emph default
 responders, correlated return traffic causing incast congestion).
\end_layout

\begin_layout Subsection
Overall design
\end_layout

\begin_layout Standard
TEACUP is built on Fabric 
\begin_inset CommandInset citation
LatexCommand cite
key "fabric-1.8"

\end_inset

 (Section 
\begin_inset CommandInset ref
LatexCommand ref
reference "sub:FABRIC----Overview"

\end_inset

), a Python (2.5 or higher) library and command-line tool for streamlining
 the remote application deployment or system administration tasks using
 SSH.
 Our design is based on multiple small tasks that are combined to run an
 experiment or a series of experiments (where some may also be executed
 directly from the command line).
 Functions which are not Fabric tasks are ordinary Python functions.
 Currently, we do not make use of the object-oriented capabilities of Python.
\end_layout

\begin_layout Standard
Figure 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:TCPPerf-blocks"

\end_inset

 shows the main functional building blocks.
 All the blocks in the diagram have corresponding Python files.
 However, we have summarised a number of Python files in the helper_functions
 block.
 The fabfile block is the entry point for the user.
 It implements tasks for running a single experiment or a series of similar
 experiments with different parameters.
 The fabfile block also provides access to all other tasks via Python imports.
\end_layout

\begin_layout Standard
The experiment block implements the main function that controls a single
 experiment and uses a number of functions of other blocks.
 The sanity_checks block implements functions to check the config file,
 the presence of tools on the hosts, the connectivity between hosts, and
 a function to kill old processes that are still running.
 The host_setup block implements all functions to setup networking on the
 testbed hosts (including basic setup of the testbed router).
 The router_setup block implements the functions that set up the queues
 on the router and the delay/loss emulation.
 The loggers block implements the start and stop functions of the loggers,
 such as tcpdump and SIFTR/web10g loggers.
 The traffic_gens block implements the start and stop functions of all traffic
 generators.
\end_layout

\begin_layout Standard
The util block contains utility tasks that can be executed from the command
 line, such as executing a command on a number of testbed hosts or copying
 a file to a number of testbed hosts.
 The analysis block contains all the post-processing functions that extract
 measurement metrics from log files and plot graphs.
\end_layout

\begin_layout Standard
\begin_inset Float figure
placement t
wide true
sideways false
status open

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename figures/tcpperf_blocks.pdf
	scale 50

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "fig:TCPPerf-blocks"

\end_inset

TEACUP main functional blocks
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Subsection
Experiment process flow
\end_layout

\begin_layout Standard
The following list explains the main steps that are executed during an experimen
t or a series of experiments.
\end_layout

\begin_layout Standard
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
bgroup
\end_layout

\begin_layout Plain Layout


\backslash
renewcommand
\backslash
theenumi{
\backslash
Roman{enumi})} 
\end_layout

\begin_layout Plain Layout


\backslash
renewcommand
\backslash
labelenumi{
\backslash
theenumi} 
\end_layout

\begin_layout Plain Layout


\backslash
renewcommand
\backslash
theenumii{
\backslash
arabic{enumii})} 
\end_layout

\begin_layout Plain Layout


\backslash
renewcommand
\backslash
labelenumii{
\backslash
theenumii}
\end_layout

\end_inset


\end_layout

\begin_layout Enumerate
Initialise and check config file
\end_layout

\begin_layout Enumerate
Get parameter combination for next experiment
\end_layout

\begin_layout Enumerate
Start experiment based on config and parameter configuration 
\end_layout

\begin_deeper
\begin_layout Enumerate
Log experiment test ID in file 
\family typewriter
\size small
experiments_started.txt
\end_layout

\begin_layout Enumerate
Get host information: OS, NIC names, NIC MAC addresses
\end_layout

\begin_layout Enumerate
Reboot hosts: reboot hosts as required given the configuration 
\end_layout

\begin_layout Enumerate
Topology reconfiguration (assign hosts to subnets)
\end_layout

\begin_layout Enumerate
Get host information again: OS, NIC names, NIC MAC addresses
\end_layout

\begin_layout Enumerate
Run sanity checks 
\end_layout

\begin_deeper
\begin_layout Itemize
Check that tools to be used exist
\end_layout

\begin_layout Itemize
Check connectivity between hosts
\end_layout

\begin_layout Itemize
Kill any leftover processes on hosts 
\end_layout

\end_deeper
\begin_layout Enumerate
Initialise hosts 
\end_layout

\begin_deeper
\begin_layout Itemize
Configure NICs (e.g.
 disable TSO) 
\end_layout

\begin_layout Itemize
Configure ECN use 
\end_layout

\begin_layout Itemize
Configure TCP congestion control
\end_layout

\begin_layout Itemize
Initialise router queues 
\end_layout

\end_deeper
\begin_layout Enumerate
Configure router queues: set router queues based on config 
\end_layout

\begin_layout Enumerate
Log host state: log host information (see Section 
\begin_inset CommandInset ref
LatexCommand ref
reference "sub:Host-info"

\end_inset

) 
\end_layout

\begin_layout Enumerate
Start all logging processes: tcpdump, SIFTR/Web10G etc.
 
\end_layout

\begin_layout Enumerate
Start all traffic generators: start traffic generators based on config 
\end_layout

\begin_layout Enumerate
Wait for experiment to finish 
\end_layout

\begin_layout Enumerate
Stop all running processes on hosts 
\end_layout

\begin_layout Enumerate
Collect all log files from logging and traffic generating processes 
\end_layout

\begin_layout Enumerate
Log experiment test ID in file 
\family typewriter
\size small
experiments_completed.txt
\end_layout

\end_deeper
\begin_layout Enumerate
If we have another parameter combination to run go to step III, otherwise
 finish
\end_layout

\begin_layout Standard
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
egroup{}
\end_layout

\end_inset


\end_layout

\begin_layout Subsection
\begin_inset CommandInset label
LatexCommand label
name "sub:FABRIC----Overview"

\end_inset

Fabric -- overview and installation
\end_layout

\begin_layout Standard
Fabric 
\begin_inset CommandInset citation
LatexCommand cite
key "fabric-1.8"

\end_inset

 provides several basic operations for executing local or remote shell commands
 and uploading/downloading files, as well as auxiliary functions, such as
 prompting the user for input, or aborting execution of the current task.
 Typically, with Fabric one creates a Python module where some functions
 are marked as Fabric tasks (using a Python function decorator).
 
\end_layout

\begin_layout Standard
These tasks can then be executed directly from the command line using the
 Fabric tool 
\family typewriter
\size small
fab
\family default
\size default
.
 The entry point of the module is a file commonly named 
\family typewriter
\size small
fabfile.py
\family default
\size default
, which is typically located in a directory from which we execute Fabric
 tasks (if the file is named differently we must use 
\family typewriter
\size small
fab -f <name>.py
\family default
\size default
).
 The complete list of tasks available in 
\family typewriter
\size small
fabfile.py
\family default
\size default
 can be viewed with the command 
\family typewriter
\size small
fab -l
\family default
\size default
.
 Parameters can be passed to Fabric tasks, however a limitation is that
 all parameter values are passed as strings.
 A Fabric task may also execute another Fabric task with Fabric's 
\family typewriter
\size small
execute()
\family default
\size default
 function.
\end_layout

\begin_layout Standard
Sections 
\begin_inset CommandInset ref
LatexCommand ref
reference "sec:Running"

\end_inset

 and 
\begin_inset CommandInset ref
LatexCommand ref
reference "sec:Utility"

\end_inset

 contain a number of examples of how to run various TEACUP tasks.
\end_layout

\begin_layout Standard
TEACUP was developed with Fabric versions 1.8--1.10, but it should also run
 with newer versions of Fabric.
 The easiest way to install the latest version of Fabric is using the tool
 
\family typewriter
\size small
pip
\family default
\size default
.
 Under FreeBSD 
\family typewriter
\size small
pip
\family default
\size default
 can be installed with 
\family typewriter
\size small
portmaster
\family default
\size default
:
\end_layout

\begin_layout Standard
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
noindent
\backslash
colorbox{lightgray}{
\end_layout

\end_inset


\family typewriter
\size small

\begin_inset Box Frameless
position "t"
hor_pos "c"
has_inner_box 1
inner_pos "t"
use_parbox 0
use_makebox 0
width "98col%"
special "none"
height "1in"
height_special "totalheight"
status open

\begin_layout Plain Layout

\family typewriter
\size footnotesize
> portmaster devel/py-pip
\end_layout

\end_inset


\begin_inset ERT
status open

\begin_layout Plain Layout

}
\end_layout

\end_inset


\end_layout

\begin_layout Standard
On Linux 
\family typewriter
\size small
pip
\family default
\size default
 can be installed with the package manager, for example on openSUSE it can
 be installed as follows:
\end_layout

\begin_layout Standard
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
noindent
\backslash
colorbox{lightgray}{
\end_layout

\end_inset


\family typewriter
\size small

\begin_inset Box Frameless
position "t"
hor_pos "c"
has_inner_box 1
inner_pos "t"
use_parbox 0
use_makebox 0
width "98col%"
special "none"
height "1in"
height_special "totalheight"
status open

\begin_layout Plain Layout

\family typewriter
\size footnotesize
> zypper install python-pip
\end_layout

\end_inset


\begin_inset ERT
status open

\begin_layout Plain Layout

}
\end_layout

\end_inset


\end_layout

\begin_layout Standard
Then to install Fabric execute:
\end_layout

\begin_layout Standard
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
noindent
\backslash
colorbox{lightgray}{
\end_layout

\end_inset


\family typewriter
\size small

\begin_inset Box Frameless
position "t"
hor_pos "c"
has_inner_box 1
inner_pos "t"
use_parbox 0
use_makebox 0
width "98col%"
special "none"
height "1in"
height_special "totalheight"
status open

\begin_layout Plain Layout

\family typewriter
\size footnotesize
> pip install fabric
\end_layout

\end_inset


\begin_inset ERT
status open

\begin_layout Plain Layout

}
\end_layout

\end_inset


\end_layout

\begin_layout Standard
You can test that Fabric is correctly installed:
\end_layout

\begin_layout Standard
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
noindent
\backslash
colorbox{lightgray}{
\backslash
footnotesize
\end_layout

\end_inset


\family typewriter

\begin_inset Box Frameless
position "t"
hor_pos "c"
has_inner_box 1
inner_pos "c"
use_parbox 0
use_makebox 0
width "98col%"
special "none"
height "1in"
height_special "totalheight"
status open

\begin_layout Plain Layout

\family typewriter
> fab --version
\end_layout

\begin_layout Plain Layout

\family typewriter
Fabric 1.8.0 
\end_layout

\begin_layout Plain Layout

\family typewriter
Paramiko 1.12.0
\end_layout

\end_inset


\begin_inset ERT
status open

\begin_layout Plain Layout

}
\end_layout

\end_inset


\end_layout

\begin_layout Standard
The Fabric manual provides more information about installing Fabric 
\begin_inset CommandInset citation
LatexCommand cite
key "fabric-1.8-install"

\end_inset

.
\end_layout

\begin_layout Section
\begin_inset CommandInset label
LatexCommand label
name "sec:Traffic-generation-and"

\end_inset

Traffic Generation and Logging
\end_layout

\begin_layout Standard
This section describes the implemented traffic sources/sinks and loggers,
 the range of information logged and the log file naming schemes.
\end_layout

\begin_layout Subsection
Traffic sources and sinks
\end_layout

\begin_layout Standard
We now describe the available traffic generator functions.
 How these can be used is described in more detail in Section 
\begin_inset CommandInset ref
LatexCommand ref
reference "sub:Config-traffic-generators"

\end_inset

.
\end_layout

\begin_layout Subsubsection
iperf
\end_layout

\begin_layout Standard
The tool iperf 
\begin_inset CommandInset citation
LatexCommand cite
key "iperf-web"

\end_inset

 can be used to generate TCP bulk transfer flows.
 Note that the iperf client pushes data to the iperf server, so the data
 flows in the opposite direction compared to httperf.
 iperf can also be used to generate unidirectional UDP flows with a specified
 bandwidth and two iperfs can be combined to generate bidirectional UDP
 flows.
\end_layout

\begin_layout Subsubsection
ping
\end_layout

\begin_layout Standard
This starts a ping from one host to another (ICMP Echo).
 The rate of pings is configurable for FreeBSD and Linux but limited to
 one ping per second for Windows.
 
\end_layout

\begin_layout Subsubsection
lighttpd
\end_layout

\begin_layout Standard
A lighttpd 
\begin_inset CommandInset citation
LatexCommand cite
key "lighttpd"

\end_inset

 web server is started.
 This can be used as traffic source for httperf-based sinks.
 There are also scripts to setup fake content for DASH-like streaming and
 incast scenario traffic.
 However, for specific experiments one may need to setup web server content
 manually or create new scripts to do this.
 We choose lighttpd as web server because it is leaner than some other popular
 web servers and hence it is easier to configure and provides higher performance.
\end_layout

\begin_layout Subsubsection
httperf
\end_layout

\begin_layout Standard
The tool httperf 
\begin_inset CommandInset citation
LatexCommand cite
key "httperf"

\end_inset

 can be used to simulate an HTTP client.
 It can generate simple request patterns, such as accessing some .html file
 
\begin_inset Formula $n$
\end_inset

 times per second.
 It can also generate complex workloads based on work session log files
 (c.f.
 httperf man page at 
\begin_inset CommandInset citation
LatexCommand cite
key "httperf"

\end_inset

).
\end_layout

\begin_layout Subsubsection
httperf_dash
\end_layout

\begin_layout Standard
This starts a TCP video streaming httperf client 
\begin_inset CommandInset citation
LatexCommand cite
key "modified-httperf"

\end_inset

 that emulates the behaviour of DASH or other similar TCP streaming algorithms
 
\begin_inset CommandInset citation
LatexCommand cite
key "Finamore2011,Rao2011"

\end_inset

.
 In the initial buffering phase the client will download the first part
 of the content as fast as possible.
 Then the client will fetch another block of content every 
\begin_inset Formula $t$
\end_inset

 seconds.
 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
mbox{
\end_layout

\end_inset

Figure 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:TCP-video-streaming"

\end_inset


\begin_inset ERT
status open

\begin_layout Plain Layout

}
\end_layout

\end_inset

 shows an illustration of this behaviour.
 The video rate and the cycle length are configurable (and the size of the
 data blocks depends on these).
\end_layout

\begin_layout Standard
\begin_inset Float figure
placement t
wide false
sideways false
status open

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename figures/dash_streaming.pdf
	scale 50

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "fig:TCP-video-streaming"

\end_inset

TCP video streaming (DASH) behaviour
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Subsubsection
httperf_incast
\end_layout

\begin_layout Standard
This starts an httperf client for the incast scenario.
 The client will request a block of content from 
\begin_inset Formula $n$
\end_inset

 servers every 
\begin_inset Formula $t$
\end_inset

 seconds.
 The requests are sent as close together as possible to make sure the servers
 respond simultaneously.
 The size of the data blocks is configurable.
 Note that emulating the incast problem in a physical testbed is difficult,
 if the number of hosts (number of responders) is relatively small.
\end_layout

\begin_layout Subsubsection
nttcp
\end_layout

\begin_layout Standard
This starts an nttcp 
\begin_inset CommandInset citation
LatexCommand cite
key "nttcp-web"

\end_inset

 client and an nttcp server for simple unidirectional UDP VoIP flow emulation.
 The fixed packet size and inter-packet time can be configured.
 Note, nttcp also opens a TCP control connection between client and server.
 However, on this connection only a few packets are exchanged before and
 after the data flow.
 
\end_layout

\begin_layout Subsection
Loggers
\end_layout

\begin_layout Standard
Currently, there are two types of loggers that log information on all hosts.
 All traffic is logged with tcpdump and TCP state information is logged
 with different tools.
\end_layout

\begin_layout Subsubsection
Traffic logger
\end_layout

\begin_layout Standard
tcpdump is used to capture the traffic on all testbed NICs on all hosts.
 All traffic is captured, but the snap size is limited to 68 bytes by default.
\end_layout

\begin_layout Subsubsection
TCP statistics logger
\end_layout

\begin_layout Standard
Different tools are used to log TCP state information on all hosts except
 the router.
 On FreeBSD we use SIFTR 
\begin_inset CommandInset citation
LatexCommand cite
key "siftr"

\end_inset

.
 On Linux we use Web10G 
\begin_inset CommandInset citation
LatexCommand cite
key "web10g"

\end_inset

, which implements the TCP EStats MIB 
\begin_inset CommandInset citation
LatexCommand cite
key "rfc4898"

\end_inset

 inside the Linux kernel, with our own logging tool based on the Web10G
 library.
 For Windows 7 we implemented our own logging tool, which can access the
 TCP EStats MIB inside the Windows 7 kernel.
 SIFTR has not been ported to Mac OS X, so for Mac OS X we implemented our
 own logging tool that outputs TCP statistics logs in SIFTR format based
 on DTrace 
\begin_inset CommandInset citation
LatexCommand cite
key "dtrace"

\end_inset

.
 Note that the DTrace tool collects most but not all statistics collected
 by SIFTR (the tool's documentation describes the limitations).
\end_layout

\begin_layout Standard
The statistics collected by SIFTR are described in the SIFTR README 
\begin_inset CommandInset citation
LatexCommand cite
key "siftr-readme"

\end_inset

.
 The statistics collected by our Web10G client and the Windows 7 EStats
 logger are described as part of the web100 (the predecessor of Web10G)
 documentation 
\begin_inset CommandInset citation
LatexCommand cite
key "web10g-stats"

\end_inset

.
\end_layout

\begin_layout Subsection
Host information logged
\end_layout

\begin_layout Standard
\begin_inset CommandInset label
LatexCommand label
name "sub:Host-info"

\end_inset


\end_layout

\begin_layout Standard
TEACUP does not only log the output of traffic generators and loggers, but
 also collects per-host information.
 This section describes the information collected for each host participating
 in an experiment.
 The following information is gathered 
\emph on
before
\emph default
 an experiment is started (where <test_id_prefix> is a test ID prefix and
 <test_id> is a test ID):
\end_layout

\begin_layout Itemize
<test_id>_ifconfig.log.gz: This file contains the output of 
\family typewriter
\size small
ifconfig
\family default
\size default
 (FreeBSD, Linux or MacOSX) or 
\family typewriter
\size small
ipconfig
\family default
\size default
 (Windows).
 
\end_layout

\begin_layout Itemize
<test_id>_uname.log.gz: This file contains the output of 
\family typewriter
\size small
uname -a
\family default
\size default
.
 
\end_layout

\begin_layout Itemize
<test_id>_netstat.log.gz: This file contains information about routing obtained
 with 
\family typewriter
\size small
netstat -r
\family default
\size default
.
 
\end_layout

\begin_layout Itemize
<test_id>_ntp.log.gz: This file contains information about the NTP status
 based on 
\family typewriter
\size small
ntpq -p
\family default
\size default
 (FreeBSD, Linux, MacOSX or Windows with NTP daemon installed) or 
\family typewriter
\size small
w32tm
\family default
\size default
 (Windows).
 
\end_layout

\begin_layout Itemize
<test_id>_procs.log.gz: This file contains the list of all running processes
 (output of 
\family typewriter
\size small
ps
\family default
\size default
).
 
\end_layout

\begin_layout Itemize
<test_id>_sysctl.log.gz: This file contains the output of 
\family typewriter
\size small
sysctl -a
\family default
\size default
 (FreeBSD, Linux or MacOSX) and various information for Windows.
 
\end_layout

\begin_layout Itemize
<test_id>_config_vars.log.gz: This file contains information about all the
 V_ parameters in config.py (see Section 
\begin_inset CommandInset ref
LatexCommand ref
reference "sec:Config"

\end_inset

).
 It logs the actual parameter values for each experiment.
 It also provides an indication of whether a variable was actually used
 or not (caveat: this does not work properly with variables used for TCP
 parameter configuration, they are always shown as used).
 
\end_layout

\begin_layout Itemize
<test_id>_host_tcp.log.gz: This file contains information about the TCP congestion
 control algorithm used on each host, and any TCP parameters specified.
\end_layout

\begin_layout Itemize
<test_id>_tcpmod.log.gz: This file contains the TCP congestion control kernel
 module parameter settings (Linux only).
\end_layout

\begin_layout Itemize
<test_id>_ethtool.log.gz: This file contains the network interface configuration
 information provided by 
\family typewriter
ethtool
\family default
 (Linux only).
\end_layout

\begin_layout Itemize
<test_id_prefix>_nameip_map.log.gz: This file logs host names and IP addresses
 (control interface IP addresses) of all hosts and routers participating
 in the series of experiments.
\end_layout

\begin_layout Standard
The following information is gathered 
\emph on
after
\emph default
 an experiment:
\end_layout

\begin_layout Itemize
<test_id>_queue_stats.log.gz: Information about the router queue setup (including
 all queue discipline parameters) as well as router queue and filtering
 statistics based on the output of 
\family typewriter
\size small
tc
\family default
\size default
 (Linux) or
\family typewriter
\size footnotesize
 
\size small
ipfw
\family default
\size default
 (FreeBSD).
 Of course this information is collected 
\emph on
only
\emph default
 for the router.
 
\end_layout

\begin_layout Subsection
Config information logged
\end_layout

\begin_layout Standard
TEACUP also logs information about the configuration of each series of experimen
ts and variables set for each experiment.
 The following information is gathered 
\emph on
before
\emph default
 an experiment is started (where <test_id_prefix> is a test ID prefix and
 <test_id> is a test ID):
\end_layout

\begin_layout Itemize
<test_id>_config_vars.log.gz: This file logs the values of all V_ variables
 for each experiment (see Section 
\begin_inset CommandInset ref
LatexCommand ref
reference "sub:variables_logged"

\end_inset

).
\end_layout

\begin_layout Itemize
<test_id_prefix>_config.tar.gz: This file contains copies of the config file(s)
 -- there can be multiple files if Python's execfile() is used to separate
 the configuration into multiple files.
\end_layout

\begin_layout Itemize
<test_id_prefix>_tpconf_vars.log.gz: This file lists all TPCONF_ parameters
 specified in the config file(s) in a format that can be imported into Python.
\end_layout

\begin_layout Itemize
<test_id_pfx>_varying_params.log.gz: This file contains a list of all V_ variables
 varied during the experiment(s) and their short names used in file names
 (see Section 
\begin_inset CommandInset ref
LatexCommand ref
reference "sub:variables_logged"

\end_inset

).
\end_layout

\begin_layout Subsection
Log file naming
\end_layout

\begin_layout Standard
The log file names of TEACUP follow a naming scheme that has the following
 format:
\end_layout

\begin_layout Standard

\family typewriter
\size small
\begin_inset Box Frameless
position "t"
hor_pos "c"
has_inner_box 1
inner_pos "t"
use_parbox 0
use_makebox 0
width "98col%"
special "none"
height "1in"
height_special "totalheight"
status open

\begin_layout Plain Layout

\family typewriter
\size footnotesize
<test_ID_pfx>_[<par_name>_<par_val>_]*_<host>_ [<traffgen_ID>_]_<file_name>.<exte
nsion>.gz
\end_layout

\end_inset


\end_layout

\begin_layout Standard
The 
\series bold
test ID prefix
\series default
 
\family typewriter
\size small
<test_ID_pfx>
\family default
\size default
 is the start of the file name and either specified in the config file (TPCONF_t
est_id) or on the command line (as described in Section 
\begin_inset CommandInset ref
LatexCommand ref
reference "sec:Running"

\end_inset

).
\end_layout

\begin_layout Standard
The
\family typewriter
\size footnotesize
 
\size small
[<par_name>_<par_val>_]*
\family default
\size default
 is the zero to 
\begin_inset Formula $n$
\end_inset

 parameter names and parameter values (separated by an underscore).
 Parameter names (
\family typewriter
\size small
<par_name>
\family default
\size default
) should not contain underscores by definition and all underscores in parameter
 values (
\family typewriter
\size small
<par_val>
\family default
\size default
) are changed to hyphens (this allows later parsing of the names and values
 using the underscores as separators).
 If an experiment was started with
\family typewriter
\size footnotesize
 
\size small
run_experiment_single
\family default
\size default
 there are zero parameter names and values.
 If an experiment was started with
\family typewriter
\size footnotesize
 
\size small
run_experiment_multiple
\size footnotesize
 
\family default
\size default
there are as many parameters names and values as specified in TPCONF_vary_parame
ters.
 We also refer to the part 
\family typewriter
\size small
<test_ID_pfx>_[<par_name>_<par_val>_]*
\family default
\size default
 (the part before the 
\family typewriter
\size small
<host>
\family default
\size default
) as 
\series bold
test ID
\series default
.
\end_layout

\begin_layout Standard
The 
\family typewriter
\size small
<host>
\family default
\size default
 part specifies the IP or name of the testbed host a log file was collected
 from.
 This corresponds to an entry in TPCONF_router or TPCONF_hosts.
\end_layout

\begin_layout Standard
If the log file is from a traffic generator specified in TPCONF_traffic_gens,
 the traffic generator number follows the host identifier (
\family typewriter
\size small
[<traffgen_ID>]
\family default
\size default
).
 Otherwise, 
\family typewriter
\size small
<traffgen_ID>
\family default
\size default
 does not exist.
\end_layout

\begin_layout Standard
The 
\family typewriter
\size small
<file_name>
\size footnotesize
 
\family default
\size default
depends on the process which logged the data, for example it set to `uname'
 for uname information collected, it is set to `httperf_dash' for an httperf
 client emulating DASH, or it set to `web10g' for a Web10G log file.
 tcpdump files are special in that they have an empty file name for tcpdumps
 collected on hosts (assuming they only have one testbed NIC), or the file
 name is <int_name>_router for tcpdumps collected on the router, where <int_name
> is the name of the NIC (e.g.
 eth1).
\end_layout

\begin_layout Standard
The 
\family typewriter
\size small
<extension>
\family default
\size default
 is either `dmp' indicating a tcpdump file or `log' for all other log files.
 All log files are usually compressed with gzip, hence their file names
 end with `.gz'.
\end_layout

\begin_layout Standard
Figure 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:Example-file-names-1"

\end_inset

 shows an example name for a tcpdump file collected on host testhost2 for
 an experiment where two parameters (dash, tcp) where varied, and an example
 name for the output of one httperf traffic generator (traffic generator
 number 3) executed on host testhost2 for the same experiment.
\end_layout

\begin_layout Standard
\begin_inset Float figure
placement t
wide true
sideways false
status open

\begin_layout Plain Layout
\begin_inset listings
lstparams "basicstyle={\footnotesize\ttfamily}"
inline false
status open

\begin_layout Plain Layout

# tcpdump file collected on testhost2 for an experiment where two parameters
 where varied
\end_layout

\begin_layout Plain Layout

20131206-170846_windows_dash_1000_tcp_compound_testhost2.dmp.gz
\end_layout

\begin_layout Plain Layout

# output of httperf traffic generator (traffic generator 3) executed on
 testhost2
\end_layout

\begin_layout Plain Layout

20131206-170846_windows_dash_1000_tcp_compound_testhost2_3_httperf_dash.log.gz
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "fig:Example-file-names-1"

\end_inset

Example file names
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
All log files for one experiment (e.g.
 fab run_experiment_single) or a series of experiments (e.g.
 fab run_experiments_multiple) are stored under a sub directory named 
\family typewriter
\size small
<test_ID_pfx>
\family default
\size default
 created inside the directory where fabfile.py is located.
\begin_inset Foot
status open

\begin_layout Plain Layout
Prior to version 0.4.7 TEACUP stored all log files in the directory where
 fabfile.py was located.
\end_layout

\end_inset


\end_layout

\begin_layout Section
\begin_inset CommandInset label
LatexCommand label
name "sec:Host-and-Router"

\end_inset

Host and Router Configuration
\end_layout

\begin_layout Standard
This section provides a general description of how the hosts and router
 are configured for each experiment and test within an experiment.
 The router implements a bottleneck with configurable one-way delays, rate
 limits and AQM (active queue management).
\end_layout

\begin_layout Subsection
Host setup
\end_layout

\begin_layout Standard
The setup of hosts other than the router is relatively straight-forward.
 First, each host is booted into the selected OS.
 Then, hardware offloading, such as TCP segmentation offloading (TSO), is
 disabled on testbed interfaces (all OS), the TCP host cache is disabled
 (Linux) or configured with a very short timeout and purged (FreeBSD), and
 TCP receive and send buffers are set to 2
\begin_inset space \thinspace{}
\end_inset

MB or more (FreeBSD, Linux).
\end_layout

\begin_layout Standard
Next ECN is enabled or disabled depending on the configuration.
 Then the TCP congestion control algorithm is configured for FreeBSD and
 Linux (including loading any necessary kernel modules).
 Then the parameters for the current TCP congestion control algorithm are
 configured if specified by the user (FreeBSD, Linux).
 Finally, custom user-specified commands are executed on hosts as specified
 in the configuration (these can overrule the general setup).
\end_layout

\begin_layout Subsection
Linux router setup
\end_layout

\begin_layout Standard
The router setup differs between FreeBSD (where ipfw and Dummynet is used)
 and Linux (where tc and netem is used).
 Our main focus is Linux, because Linux supports more AQM mechanisms than
 FreeBSD and some of the required AQM mechanisms are only implemented on
 Linux.
\end_layout

\begin_layout Standard
First, hardware offloading, such as TCP segmentation offloading (TSO) is
 disabled on the two testbed interfaces.
 Then, the queuing is configured.
 In the following two sub sections we first describe our overall approach
 to setup rate limiting, AQM and delay/loss emulation for the Linux router.
 Then, we describe an example setup to illustrate the approach in practice.
\end_layout

\begin_layout Subsubsection
Approach
\end_layout

\begin_layout Standard
We use the following approach.
 Shaping, AQM and delay/loss emulation is done on the egress NIC (as usual).
 To filter packets and direct them into the `pipes' we use netfilter 
\begin_inset CommandInset citation
LatexCommand cite
key "netfilter"

\end_inset

.
 The hierarchical token bucket (HTB) queuing discipline is used for rate
 limiting with the desired AQM queuing discipline (e.g.
 pfifo, codel) as leaf node (this is similar to a setup mentioned at 
\begin_inset CommandInset citation
LatexCommand cite
key "bufferbloat-bcp"

\end_inset

).
 After rate shaping and AQM, constant loss and delay is emulated with netem
 
\begin_inset CommandInset citation
LatexCommand cite
key "netem"

\end_inset

.
 For each pipe we set up a new tc class on the two testbed NICs of the router.
 If pipes are unidirectional, a class is only used on one of the two interfaces.
 Otherwise it is used on both interfaces.
 In future work we could optimise the unidirectional case and omit the creation
 of unused classes.
 
\end_layout

\begin_layout Standard
The traffic flow is as follows (also see Figure 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:Flow-of-packets"

\end_inset

): 
\end_layout

\begin_layout Enumerate
Arriving packets are marked at the netfilter mangle table's POSTROUTING
 hook depending on source and destination IP address with a unique mark
 for each pipe.
\begin_inset Foot
status open

\begin_layout Plain Layout
There also is a dummy rule "MARK and 0x0" inserted first, which is used
 to count all packets going through the POSTROUTING hook.
 Note that since this dummy rule has `anywhere' specified for source and
 destination, it also counts packets going through the router's control
 interface.
\end_layout

\end_inset


\end_layout

\begin_layout Enumerate
Marked packets are classified into the appropriate class based on the mark
 (a one-to-one mapping between marks and classes) and redirected to a pseudo
 interface.
 With pseudo device we refer to the so-called intermediate function block
 (IFB) device 
\begin_inset CommandInset citation
LatexCommand cite
key "ifb-device"

\end_inset

.
 
\end_layout

\begin_layout Enumerate
The traffic control rules on the pseudo interface do the shaping with HTB
 (bandwidth as per config) and the chosen AQM (as a leaf queuing discipline).
 
\end_layout

\begin_layout Enumerate
Packets go back to the actual outgoing interface.
 
\end_layout

\begin_layout Enumerate
The traffic control rules on the actual interface do network delay/loss
 emulation with netem.
 We still need classes here to allow for pipe specific delay/loss settings.
 Hence we use a HTB again, but with the bandwidth set to the maximum possible
 rate (so there is effectively no rate shaping or AQM here) and netem plus
 pfifo are used as leaf queuing discipline.
\begin_inset Foot
status open

\begin_layout Plain Layout
The netem queue has a hard-coded size of 1000 packets, which should be large
 enough for our targeted experimental parameter space.
\end_layout

\end_inset


\end_layout

\begin_layout Enumerate
Packets leave the router via the stack and network card driver.
\end_layout

\begin_layout Standard
The main reason for this setup with pseudo interfaces is to cleanly separate
 the rate limiting and AQM from the netem delay/loss emulation.
 One could combine both on the same interface, but then there are certain
 limitation, such as netem must be before the AQM and 
\begin_inset CommandInset citation
LatexCommand cite
key "bufferbloat-bcp"

\end_inset

 reported that in such a setup netem causes problems.
 Also, a big advantage with our setup is that it is possible to emulate
 different delay or loss for different flows that share the same bottleneck/AQM.
 
\end_layout

\begin_layout Subsubsection
Example
\end_layout

\begin_layout Standard
We now show an example of the setup based on partial (and for convenience
 reordered) output of a queue_stats.log.gz file for a scenario with two unidirecti
onal pipes: 8
\begin_inset space \thinspace{}
\end_inset

Mbps downstream and 1
\begin_inset space \thinspace{}
\end_inset

Mbps upstream, both with 30
\begin_inset space \thinspace{}
\end_inset

ms delay and 0% loss.
\end_layout

\begin_layout Standard
First, Figure 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:Netfilter-marking-rules"

\end_inset

 shows the netfilter marking rules.
 Our upstream direction is 172.16.10.0/24 to 172.16.11.0/24 and all packets are
 given the mark 0x1.
 Our downstream direction is 172.16.11.0/24 to 172.16.10.0/24 and all packets
 are given the mark 0x2.
\end_layout

\begin_layout Standard
\begin_inset Float figure
placement t
wide true
sideways false
status open

\begin_layout Plain Layout
\align center
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
noindent 
\backslash
colorbox{lightgray}{
\backslash
footnotesize
\end_layout

\end_inset


\family typewriter
\size small

\begin_inset Box Frameless
position "t"
hor_pos "c"
has_inner_box 1
inner_pos "t"
use_parbox 0
use_makebox 0
width "98text%"
special "none"
height "1in"
height_special "totalheight"
status open

\begin_layout Plain Layout

\family typewriter
> iptables -t mangle -vL 
\end_layout

\begin_layout Plain Layout

\family typewriter
Chain POSTROUTING (policy ACCEPT 52829 packets, 69M bytes) pkts bytes target
 prot opt in out source destination 
\end_layout

\begin_layout Plain Layout

\family typewriter
52988 69M MARK all -- any any anywhere anywhere MARK and 0x0 
\end_layout

\begin_layout Plain Layout

\family typewriter
22774 1202K MARK all -- any any 172.16.10.0/24 172.16.11.0/24 MARK set 0x1 
\end_layout

\begin_layout Plain Layout

\family typewriter
28936 66M MARK all -- any any 172.16.11.0/24 172.16.10.0/24 MARK set 0x2
\end_layout

\end_inset


\begin_inset ERT
status open

\begin_layout Plain Layout

}
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "fig:Netfilter-marking-rules"

\end_inset

Netfilter marking rules
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
In the upstream direction our outgoing interface is eth3 and we have the
 tc filters shown in Figure 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:tc-filter-outgoing"

\end_inset

, which put each packet with mark 0x1 in class 1:1 and redirect it to pseudo
 interface ifb1.
\end_layout

\begin_layout Standard
\begin_inset Float figure
placement t
wide true
sideways false
status open

\begin_layout Plain Layout
\align center
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
noindent 
\backslash
colorbox{lightgray}{
\backslash
footnotesize
\end_layout

\end_inset


\family typewriter
\size small

\begin_inset Box Frameless
position "t"
hor_pos "c"
has_inner_box 1
inner_pos "t"
use_parbox 0
use_makebox 0
width "98text%"
special "none"
height "1in"
height_special "totalheight"
status open

\begin_layout Plain Layout

\family typewriter
> tc -s filter show dev eth3 
\end_layout

\begin_layout Plain Layout

\family typewriter
filter parent 1: protocol ip pref 49152 fw 
\end_layout

\begin_layout Plain Layout

\family typewriter
filter parent 1: protocol ip pref 49152 fw handle 0x1 classid 1:1 
\end_layout

\begin_layout Plain Layout

\family typewriter
action order 33: mirred (Egress Redirect to device ifb1) stolen 
\end_layout

\begin_layout Plain Layout

\family typewriter
index 3266 ref 1 bind 1 installed 99 sec used 12 sec 
\end_layout

\begin_layout Plain Layout

\family typewriter
Action statistics: 
\end_layout

\begin_layout Plain Layout

\family typewriter
Sent 1520865 bytes 22774 pkt (dropped 0, overlimits 0 requeues 0) 
\end_layout

\begin_layout Plain Layout

\family typewriter
backlog 0b 0p requeues 0 
\end_layout

\end_inset


\begin_inset ERT
status open

\begin_layout Plain Layout

}
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "fig:tc-filter-outgoing"

\end_inset

tc filter on outgoing network interface
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
Note that the class setting is effective for eth3, but it will not `stick'
 across interfaces.
 Hence we need to set the class again on ifb1 as shown in Figure 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:tc-filter-pseudo"

\end_inset

 (again class 1:1 is set if the mark is 0x1).
\end_layout

\begin_layout Standard
\begin_inset Float figure
placement t
wide true
sideways false
status open

\begin_layout Plain Layout
\align center
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
noindent 
\backslash
colorbox{lightgray}{
\backslash
footnotesize
\end_layout

\end_inset


\family typewriter
\size small

\begin_inset Box Frameless
position "t"
hor_pos "c"
has_inner_box 1
inner_pos "t"
use_parbox 0
use_makebox 0
width "98text%"
special "none"
height "1in"
height_special "totalheight"
status open

\begin_layout Plain Layout

\family typewriter
> tc -d -s filter show dev ifb1 
\end_layout

\begin_layout Plain Layout

\family typewriter
filter parent 1: protocol ip pref 49152 fw 
\end_layout

\begin_layout Plain Layout

\family typewriter
filter parent 1: protocol ip pref 49152 fw handle 0x1 classid 1:1 
\end_layout

\end_inset


\begin_inset ERT
status open

\begin_layout Plain Layout

}
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "fig:tc-filter-pseudo"

\end_inset

tc filter on pseudo interface
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
On ifb1 we use the queuing discipline setup as shown in Figure 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:queue-disc-pseudo"

\end_inset

.
 The HTB does the rate limiting to 1
\begin_inset space \thinspace{}
\end_inset

Mbps.
 Here he leaf queuing discipline is a bfifo (byte FIFO) with a buffer size
 of 18.75
\begin_inset space \thinspace{}
\end_inset

kB.
 
\end_layout

\begin_layout Standard
\begin_inset Float figure
placement t
wide true
sideways false
status open

\begin_layout Plain Layout
\align center
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
noindent 
\backslash
colorbox{lightgray}{
\backslash
footnotesize
\end_layout

\end_inset


\family typewriter
\size small

\begin_inset Box Frameless
position "t"
hor_pos "c"
has_inner_box 1
inner_pos "t"
use_parbox 0
use_makebox 0
width "98text%"
special "none"
height "1in"
height_special "totalheight"
status open

\begin_layout Plain Layout

\family typewriter
> tc -d -s class show dev ifb1 
\end_layout

\begin_layout Plain Layout

\family typewriter
class htb 1:1 root leaf 1001: prio 0 quantum 12500 rate 1000Kbit ceil 1000Kbit
 burst 1600b/1 mpu 0b overhead 0b cburst 1600b/1 mpu 0b overhead 0b level
 0 
\end_layout

\begin_layout Plain Layout

\family typewriter
Sent 1520865 bytes 22774 pkt (dropped 0, overlimits 0 requeues 0) 
\end_layout

\begin_layout Plain Layout

\family typewriter
rate 62112bit 117pps backlog 0b 0p requeues 0 
\end_layout

\begin_layout Plain Layout

\family typewriter
lended: 22774 borrowed: 0 giants: 0 
\end_layout

\begin_layout Plain Layout

\family typewriter
tokens: 191750 ctokens: 191750
\end_layout

\begin_layout Plain Layout

\family typewriter
> tc -d -s qdisc show ifb1 
\end_layout

\begin_layout Plain Layout

\family typewriter
qdisc htb 1: dev ifb1 root refcnt 2 r2q 10 default 0 direct_packets_stat
 0 ver 3.17 
\end_layout

\begin_layout Plain Layout

\family typewriter
Sent 1520865 bytes 22774 pkt (dropped 0, overlimits 0 requeues 0) 
\end_layout

\begin_layout Plain Layout

\family typewriter
backlog 0b 0p requeues 0 
\end_layout

\begin_layout Plain Layout

\family typewriter
qdisc bfifo 1001: dev ifb1 parent 1:1 limit 18750b 
\end_layout

\begin_layout Plain Layout

\family typewriter
Sent 1520865 bytes 22774 pkt (dropped 0, overlimits 0 requeues 0) 
\end_layout

\begin_layout Plain Layout

\family typewriter
backlog 0b 0p requeues 0 
\end_layout

\end_inset


\begin_inset ERT
status open

\begin_layout Plain Layout

}
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "fig:queue-disc-pseudo"

\end_inset

Queuing discipline setup on pseudo interface
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
After packets are through the bfifo, they are passed back to eth3 where
 we have an HTB with maximum rate and netem as leaf queuing discipline (here
 netem emulates 30
\begin_inset space \thinspace{}
\end_inset

ms constant delay) as shown in Figure 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:queue-disc-outgoing"

\end_inset

.
\end_layout

\begin_layout Standard
\begin_inset Float figure
placement t
wide true
sideways false
status open

\begin_layout Plain Layout
\align center
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
noindent 
\backslash
colorbox{lightgray}{
\backslash
footnotesize
\end_layout

\end_inset


\family typewriter
\size small

\begin_inset Box Frameless
position "t"
hor_pos "c"
has_inner_box 1
inner_pos "t"
use_parbox 0
use_makebox 0
width "98text%"
special "none"
height "1in"
height_special "totalheight"
status open

\begin_layout Plain Layout

\family typewriter
> tc -d -s class show dev eth3 
\end_layout

\begin_layout Plain Layout

\family typewriter
class htb 1:1 root leaf 1001: prio 0 rate 1000Mbit ceil 1000Mbit burst 1375b
 cburst 1375b 
\end_layout

\begin_layout Plain Layout

\family typewriter
Sent 1520865 bytes 22774 pkt (dropped 0, overlimits 0 requeues 0) 
\end_layout

\begin_layout Plain Layout

\family typewriter
rate 62184bit 117pps backlog 0b 0p requeues 0 
\end_layout

\begin_layout Plain Layout

\family typewriter
lended: 22774 borrowed: 0 giants: 0 
\end_layout

\begin_layout Plain Layout

\family typewriter
tokens: 178 ctokens: 178
\end_layout

\begin_layout Plain Layout

\family typewriter
> tc -d -s qdisc show eth3 
\end_layout

\begin_layout Plain Layout

\family typewriter
qdisc htb 1: dev eth3 root refcnt 9 r2q 10 default 0 direct_packets_stat
 3 ver 3.17 
\end_layout

\begin_layout Plain Layout

\family typewriter
Sent 1520991 bytes 22777 pkt (dropped 0, overlimits 66602 requeues 0) 
\end_layout

\begin_layout Plain Layout

\family typewriter
backlog 0b 0p requeues 0 
\end_layout

\begin_layout Plain Layout

\family typewriter
qdisc netem 1001: dev eth3 parent 1:1 limit 1000 delay 30.0ms 
\end_layout

\begin_layout Plain Layout

\family typewriter
Sent 1520865 bytes 22774 pkt (dropped 0, overlimits 0 requeues 0) 
\end_layout

\begin_layout Plain Layout

\family typewriter
backlog 0b 0p requeues 0
\end_layout

\end_inset


\begin_inset ERT
status open

\begin_layout Plain Layout

}
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "fig:queue-disc-outgoing"

\end_inset

Queuing discipline setup on outgoing interface (netem)
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
After leaving netem the packets are passed to the stack which then passes
 them to the NIC driver.
 For the sake of brevity we are not describing the downstream direction
 here, but the principle is exactly the same.
 The only differences are the interfaces used (eth2 and ifb0 instead of
 eth3 and ifb1) and the different HTB, AQM and netem parameters.
 
\end_layout

\begin_layout Standard
Figure 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:Flow-of-packets"

\end_inset

 shows the flow of packets with the different steps carried out in the order
 of the numbers in parenthesis.
 The marking/classifying is not shown explicitly, it takes place between
 step 1 and 2 (netfilter and class on actual interface) and between step
 2 and 3 (class on pseudo interface).
\end_layout

\begin_layout Standard
\begin_inset Float figure
placement t
wide false
sideways false
status open

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename figures/linux_router_setup_example_packet_flow.pdf
	scale 50

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "fig:Flow-of-packets"

\end_inset

Flow of packets through our queue setup
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
We can see that with our setup it is possible to emulate different delay
 or loss for different flows that share the same bottleneck/AQM.
 Multiple tc filters on the ifb interface can classify different flows as
 the same class so they share the same bottleneck.
 However, on the eth interface we can have one class and one netem queue
 per flow and the tc filters classify each flow into a different class.
\end_layout

\begin_layout Subsubsection
Notes
\end_layout

\begin_layout Standard
Note that in addition to the buffers mentioned earlier, according to 
\begin_inset CommandInset citation
LatexCommand cite
key "bufferbloat-bcp"

\end_inset

 the HTB queuing discipline has a built-in buffer of one packet (that cannot
 be changed) and the device drivers also have separate buffers.
\end_layout

\begin_layout Subsection
FreeBSD router setup
\end_layout

\begin_layout Standard
While a Linux router is our main focus, we also implemented a basic router
 queue setup for FreeBSD.
\end_layout

\begin_layout Standard
On FreeBSD each pipe is realised as one Dummynet pipe, which does the rate
 shaping, loss/delay emulation and queuing (FIFO or RED only).
 ipfw rules are used to redirect packets to the pipes based on the specified
 source and destination IP parameters.
 If a pipe is unidirectional then there is a single "pipe <num> ip from
 <source> to <dest> out" rule.
 If a pipe is bidirectional there is an additional "pipe <num> ip from <dest>
 to <source> out" rule.
 The pipe number <num> is automatically determined by TEACUP.
 A more sophisticated setup for FreeBSD remains future work.
 
\end_layout

\begin_layout Section
Config File
\end_layout

\begin_layout Standard
\begin_inset CommandInset label
LatexCommand label
name "sec:Config"

\end_inset


\end_layout

\begin_layout Standard
This section describes TEACUP's top-level config.py file that controls the
 experiments.
\end_layout

\begin_layout Subsection
Config file location
\end_layout

\begin_layout Standard
By default TEACUP will load the config.py file that is in the directory where
 fabfile.py is located -- the directory from which experiments are started.
 Since TEACUP version 0.9, alternative config files can be specified using
 fab's 
\family typewriter
\size footnotesize
--set
\family default
\size default
 parameter.
 For example, if we want to run a series of experiments with the configuration
 in myconfig.py, we simple need to run TEACUP as follows:
\end_layout

\begin_layout Standard
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
noindent 
\backslash
colorbox{lightgray}{
\end_layout

\end_inset


\family typewriter
\size small

\begin_inset Box Frameless
position "t"
hor_pos "c"
has_inner_box 1
inner_pos "t"
use_parbox 0
use_makebox 0
width "97col%"
special "none"
height "1in"
height_special "totalheight"
status open

\begin_layout Plain Layout

\family typewriter
\size footnotesize
> fab --set teacup_config=myconfig.py run_experiment_multiple
\end_layout

\end_inset


\begin_inset ERT
status open

\begin_layout Plain Layout

}
\end_layout

\end_inset


\end_layout

\begin_layout Subsection
V_variables
\end_layout

\begin_layout Standard
To iterate over parameter settings for each experiment TEACUP uses 
\emph on
V_variables
\emph default
.
 These are identifiers of the form V_<name>, where <name> must consist of
 only letters, numbers, hyphens (-) or underscores (_).
 V_variables can be used in router queue settings (see Section 
\begin_inset CommandInset ref
LatexCommand ref
reference "sub:Config-router-queues"

\end_inset

), traffic generator settings (see Section 
\begin_inset CommandInset ref
LatexCommand ref
reference "sub:Config-traffic-generators"

\end_inset

), TCP algorithm settings (see Section 
\begin_inset CommandInset ref
LatexCommand ref
reference "sub:Config-mandatory-vars"

\end_inset

) or host setup commands (see Section 
\begin_inset CommandInset ref
LatexCommand ref
reference "sub:Config-custom-host-setup"

\end_inset

).
 Section 
\begin_inset CommandInset ref
LatexCommand ref
reference "sub:Config-defining-vars"

\end_inset

 describes how to define V_variables.
\end_layout

\begin_layout Subsection
Fabric configuration
\end_layout

\begin_layout Standard
The following settings in the config file are Fabric settings.
 For a more in-depth description refer to the Fabric documentation 
\begin_inset CommandInset citation
LatexCommand cite
key "fabric-1.8"

\end_inset

.
 All Fabric settings are part of the Fabric 
\family typewriter
\size small
env
\family default
\size default
 dictionary and hence are Python variables (and must adhere to the Python
 syntax).
\end_layout

\begin_layout Standard
The user used for the SSH login is specified with env.user.
 For example:
\end_layout

\begin_layout Standard

\family typewriter
\size small
\begin_inset Box Frameless
position "t"
hor_pos "c"
has_inner_box 1
inner_pos "t"
use_parbox 0
use_makebox 0
width "98col%"
special "none"
height "1in"
height_special "totalheight"
status open

\begin_layout Plain Layout

\family typewriter
\size footnotesize
env.user = 'root'
\end_layout

\end_inset


\end_layout

\begin_layout Standard
The password used for the SSH login is specified with env.password.
 The password can be empty if public-key authorisation is set up properly,
 e.g.
 the public SSH key of the control PC running TEACUP has been added to all
 hosts <user>/.ssh/authorized_keys files (and the corresponding private key
 on the control host is ~/.ssh/id_rsa or a file <key_file> specified with
 fab -i <key_file> or the env.key_filename configuration parameter 
\begin_inset CommandInset citation
LatexCommand cite
key "fabric-1.8"

\end_inset

).
\end_layout

\begin_layout Standard

\family typewriter
\size small
\begin_inset Box Frameless
position "t"
hor_pos "c"
has_inner_box 1
inner_pos "t"
use_parbox 0
use_makebox 0
width "98col%"
special "none"
height "1in"
height_special "totalheight"
status open

\begin_layout Plain Layout

\family typewriter
\size footnotesize
env.password = 'testroot'
\end_layout

\end_inset


\end_layout

\begin_layout Standard
The shell used to execute commands is specified with env.shell.
 By default Fabric uses Bash, but Bash is not standard on FreeBSD.
 So TEACUP's default setting is:
\end_layout

\begin_layout Standard

\family typewriter
\size small
\begin_inset Box Frameless
position "t"
hor_pos "c"
has_inner_box 1
inner_pos "t"
use_parbox 0
use_makebox 0
width "98col%"
special "none"
height "1in"
height_special "totalheight"
status open

\begin_layout Plain Layout

\family typewriter
\size footnotesize
env.shell = '/bin/sh -c'
\end_layout

\end_inset


\end_layout

\begin_layout Standard
The timeout for an SSH connection is specified with env.timeout.
\end_layout

\begin_layout Standard

\family typewriter
\size small
\begin_inset Box Frameless
position "t"
hor_pos "c"
has_inner_box 1
inner_pos "t"
use_parbox 0
use_makebox 0
width "98col%"
special "none"
height "1in"
height_special "totalheight"
status open

\begin_layout Plain Layout

\family typewriter
\size footnotesize
env.timeout = 5
\end_layout

\end_inset


\end_layout

\begin_layout Standard
The number of concurrent processes used for parallel execution is specified
 with env.pool_size.
 The number should be at least as high as the number of hosts, unless the
 number of hosts is large in which case we may want to limit the number
 of concurrent processes.
\end_layout

\begin_layout Standard

\family typewriter
\size small
\begin_inset Box Frameless
position "t"
hor_pos "c"
has_inner_box 1
inner_pos "t"
use_parbox 0
use_makebox 0
width "98col%"
special "none"
height "1in"
height_special "totalheight"
status open

\begin_layout Plain Layout

\family typewriter
\size footnotesize
env.pool_size = 10
\end_layout

\end_inset


\end_layout

\begin_layout Subsection
Testbed configuration
\end_layout

\begin_layout Standard
All TEACUP settings start with the 
\size small
\emph on
TPCONF_
\size default
\emph default
 prefix and are Python variables (and must adhere to the Python syntax).
\end_layout

\begin_layout Standard
TPCONF_script_path specifies the path to the TEACUP scripts, and is appended
 to the Python path.
\end_layout

\begin_layout Standard

\family typewriter
\size small
\begin_inset Box Frameless
position "t"
hor_pos "c"
has_inner_box 1
inner_pos "t"
use_parbox 0
use_makebox 0
width "98col%"
special "none"
height "1in"
height_special "totalheight"
status open

\begin_layout Plain Layout

\family typewriter
\size footnotesize
TPCONF_script_path = '/home/test/src/teacup'
\end_layout

\end_inset


\end_layout

\begin_layout Standard
Two lists specify the testbed hosts.
 TPCONF_router specifies the list of routers.
 Note that prior to TEACUP version 0.9 the 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
mbox{
\end_layout

\end_inset

TPCONF_router
\begin_inset ERT
status open

\begin_layout Plain Layout

}
\end_layout

\end_inset

 list was limited to only 
\emph on
one
\emph default
 router.
 Since version 0.9 a list of routers can be specified.
 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
mbox{
\end_layout

\end_inset

TPCONF_hosts
\begin_inset ERT
status open

\begin_layout Plain Layout

}
\end_layout

\end_inset

 specifies the list of hosts.
 Router and hosts can be specified as IP addresses or host names (typically
 for convenience just the name without the domain part).
\end_layout

\begin_layout Standard
\begin_inset listings
lstparams "basicstyle={\footnotesize\ttfamily}"
inline false
status open

\begin_layout Plain Layout

TPCONF_router = [ 'testhost1', ] 
\end_layout

\begin_layout Plain Layout

TPCONF_hosts = [ 'testhost2', 'testhost3' ]
\end_layout

\end_inset


\end_layout

\begin_layout Standard
The dictionary TPCONF_host_internal_ip specifies the testbed IP addresses
 for each host.
 The hosts (keys) specified must match the entries in the TPCONF_router
 and TPCONF_hosts lists exactly.
 The current code does simple string matching, it does 
\emph on
not
\emph default
 attempt to resolve host identifiers into some canonical form
\size small
.
\end_layout

\begin_layout Standard
\begin_inset listings
lstparams "basicstyle={\footnotesize\ttfamily}"
inline false
status open

\begin_layout Plain Layout

TPCONF_host_internal_ip = { 
\end_layout

\begin_layout Plain Layout

'testhost1' : ['172.16.10.1','172.16.11.1'], 
\end_layout

\begin_layout Plain Layout

'testhost2' : ['172.16.10.2'], 
\end_layout

\begin_layout Plain Layout

'testhost3' : ['172.16.10.3'], 
\end_layout

\begin_layout Plain Layout

}
\end_layout

\end_inset


\end_layout

\begin_layout Subsection
Sanity checks settings
\end_layout

\begin_layout Standard
By default TEACUP checks the connectivity between testbed hosts by performing
 a ping from each host to each other host that should be reachable (according
 to the router configuration and IP address configuration of the hosts).
 This check is carried out before each experiment.
 During a series of experiments the testbed is likely in a stable condition
 and the repeated connectivity check may be unnecessary.
 It can be turned off by setting the variable TPCONF_check_connectivity
 to `0', i.e.
 adding the following line to the config file:
\end_layout

\begin_layout Standard
\begin_inset listings
lstparams "basicstyle={\footnotesize\ttfamily}"
inline false
status open

\begin_layout Plain Layout

TPCONF_check_connectivity = '0' 
\end_layout

\end_inset


\end_layout

\begin_layout Subsection
General experiment settings
\end_layout

\begin_layout Standard
\begin_inset CommandInset label
LatexCommand label
name "sub:Experiment-general-settings"

\end_inset


\end_layout

\begin_layout Standard
TPCONF_test_id specifies the default test ID prefix.
 Note that if the test ID prefix is specified on the command line, the command
 line overrules this setting.
\end_layout

\begin_layout Standard
\begin_inset listings
lstparams "basicstyle={\footnotesize\ttfamily}"
inline false
status open

\begin_layout Plain Layout

now = datetime.datetime.today() 
\end_layout

\begin_layout Plain Layout

TPCONF_test_id = now.strftime("%Y%m%d-%H%M%S")
\end_layout

\end_inset


\end_layout

\begin_layout Standard
TPCONF_remote_dir specifies the directory on the remote host where the log
 files (e.g.
 tcpdump, SIFTR) are stored during an experiment.
 Files are deleted automatically at the end of an experiment, but if an
 experiment is interrupted files can remain.
 Currently, there is no automatic cleanup of the directory to remove left-over
 files.
\end_layout

\begin_layout Standard

\family typewriter
\size small
\begin_inset Box Frameless
position "t"
hor_pos "c"
has_inner_box 1
inner_pos "t"
use_parbox 0
use_makebox 0
width "97col%"
special "none"
height "1in"
height_special "totalheight"
status open

\begin_layout Plain Layout

\family typewriter
\size footnotesize
TPCONF_remote_dir = '/tmp/'
\end_layout

\end_inset


\end_layout

\begin_layout Standard
TEACUP performs a very simple time synchronisation check at the start (after
 waiting for more than 30 seconds after the hosts were rebooted).
 It checks the time offset between the control host (the host that executes
 TEACUP) and each testbed host listed in the config file.
 TPCONF_max_time_diff specifies the maximum tolerable clock offset, i.e.
 the maximum allowed time difference in seconds.
 If the clock offset for one of the testbed hosts is too large, TEACUP will
 abort the experiment or series of experiments.
\end_layout

\begin_layout Standard
\begin_inset listings
lstparams "basicstyle={\footnotesize\ttfamily}"
inline false
status open

\begin_layout Plain Layout

TPCONF_max_time_diff = 1
\end_layout

\end_inset


\end_layout

\begin_layout Standard
TPCONF_debug_level specifies the debug level for experiments.
 At the default level of 0, no debug information is generated.
 If the variable is set to a higher value debug information is generated,
 for example at a debug level of 1 .Rout files are generated when plotting
 graphs.
\end_layout

\begin_layout Standard
\begin_inset listings
lstparams "basicstyle={\footnotesize\ttfamily}"
inline false
status open

\begin_layout Plain Layout

TPCONF_debug_level = 0
\end_layout

\end_inset


\end_layout

\begin_layout Standard
The parameter TPCONF_web10g_poll_interval allows to specify the poll interval
 in milliseconds for web10g loggers on Linux or Windows.
 The minimum value is 1
\begin_inset space \thinspace{}
\end_inset

ms and the maximum value is 1000
\begin_inset space \thinspace{}
\end_inset

ms.
 The default value is 10
\begin_inset space \thinspace{}
\end_inset

ms.
 Note that the control of the interval length is not very accurate and with
 small intervals less then 10
\begin_inset space \thinspace{}
\end_inset

ms, the actual interval will likely be larger than the specified interval.
\end_layout

\begin_layout Standard
\begin_inset listings
lstparams "basicstyle={\footnotesize\ttfamily}"
inline false
status open

\begin_layout Plain Layout

TPCONF_web10g_poll_interval = 10
\end_layout

\end_inset


\end_layout

\begin_layout Subsection
tcpdump/pcap configuration
\end_layout

\begin_layout Standard
The variable TPCONF_pcap_snaplen sets the 
\shape italic
snap length
\shape default
 (number of bytes captured by tcpdump per Ethernet frame).
 If not specified the default is 80 bytes.
 Setting TPCONF_pcap_snaplen=0 means `capture all bytes'.
 The following shows an example where we set the snap length to 128 bytes.
\begin_inset listings
lstparams "basicstyle={\footnotesize\ttfamily}"
inline false
status open

\begin_layout Plain Layout

TPCONF_pcap_snaplen = 128
\end_layout

\end_inset


\end_layout

\begin_layout Subsection
Topology configuration
\end_layout

\begin_layout Standard
\begin_inset CommandInset label
LatexCommand label
name "sub:topology_config"

\end_inset


\end_layout

\begin_layout Standard
Since version 0.8 TEACUP can automate the assignment of each host into one
 of the two subnets.
 The topology configuration is 
\emph on
EXPERIMENTAL
\emph default
 and based on a number of assumptions around the network setup.
\begin_inset Foot
status open

\begin_layout Plain Layout
The most critical restriction is that switch reconfiguration has only been
 tested with Dell 5324 and Dell N3000 series switches.
\end_layout

\end_inset

 For an experiment or a series of experiment the topology (re)configuration
 is (optionally) carried out after the machines haven been rebooted and
 before any sanity checks are done.
\end_layout

\begin_layout Standard
Automatic topology configuration is enabled by setting the variable TPCONF_confi
g_topology to `1'.
 (If this variable is undefined or set to `0' there is no topology configuration.
)
\end_layout

\begin_layout Standard
\begin_inset listings
lstparams "basicstyle={\footnotesize\ttfamily}"
inline false
status open

\begin_layout Plain Layout

TPCONF_config_topology = '1'
\end_layout

\end_inset


\end_layout

\begin_layout Standard
When topology configuration is enabled TEACUP actively 
\emph on
(re)configures
\emph default
 each host's test subnet IP address to that specified in 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
mbox{
\end_layout

\end_inset

TPCONF_host_internal_ip
\begin_inset ERT
status open

\begin_layout Plain Layout

}
\end_layout

\end_inset

, then 
\emph on
changes
\emph default
 the VLAN configuration of the testbed switch's ports so all hosts are connected
 to the right subnets.
\end_layout

\begin_layout Standard
Automated VLAN (re)configuration requires SSH access to the switch, with
 the same SSH user name and password as used on all other hosts.
 As many switches limit the number of concurrent SSH sessions allowed, TEACUP
 currently performs the configuration of the ports on switch sequentially
 (host by host).
 However, after the switch has been configured TEACUP carries out the setup
 of each host (network interface and routing configuration) in parallel
 to reduce the overall time for topology configuration.
 
\end_layout

\begin_layout Standard
When mapping switch ports to VLANs, TEACUP assumes we are using /24 subnets
 and that the third octet of the IP address is identical to the VLAN name
 configured on the switch.
 For example, a host being configured with address 172.16.10.2 is mapped to
 a corresponding VLAN named `10' on the switch.
\end_layout

\begin_layout Standard
TEACUP also assumes that all hosts are differentiated by appending consecutive
 numbers to their hostnames.
 The lowest number, 
\begin_inset Formula $h$
\end_inset

, can be chosen arbitrarily.
 For example, if we have two hosts they could be named 'testhost1' and 'testhost
2'.
 TEACUP further assumes that hosts are connected to consecutive ports of
 the switch in the same order as their hostname numbering.
 For example, if we have testhost1 and testhost2, and testhost1 is connected
 to switch port 
\begin_inset Formula $n$
\end_inset

 then testhost2 must be connected to switch port 
\begin_inset Formula $n+1$
\end_inset

.
\end_layout

\begin_layout Standard
The address or host name of the switch can be configured with the variable
 TPCONF_topology_switch.
 To map a host to the corresponding port the variables TPCONF_topology_switch_po
rt_prefix and TPCONF_topology_switch_port_offset (also called 
\begin_inset Formula $o$
\end_inset

) can be defined.
 The name of the switch port used will be the string specified in TPCONF_topolog
y_switch_port_prefix concatenated with the the number 
\begin_inset Formula $h+o$
\end_inset

.
 The following shows the default configuration.
\end_layout

\begin_layout Standard
\begin_inset listings
lstparams "basicstyle={\footnotesize\ttfamily}"
inline false
status open

\begin_layout Plain Layout

TPCONF_topology_switch = 'switch2'
\end_layout

\begin_layout Plain Layout

TPCONF_topology_switch_port_prefix = 'Gi1/0/'
\end_layout

\begin_layout Plain Layout

TPCONF_topology_switch_port_offset = 5
\end_layout

\end_inset


\end_layout

\begin_layout Standard
The above configuration assumes that testhost1 is connected to switch port
 `Gi1/0/6' and testhost2 is connected to switch port `Gi1/0/7' on a switch
 with the host name `switch2' (which has SSH configuration enabled).
\end_layout

\begin_layout Standard
Topology configuration works with all supported OS (Linux, FreeBSD, Windows/Cygw
in and Mac OS X).
 However, the switch reconfiguration code has only been tested with Dell
 5324 and Dell N3000 series switches.
\end_layout

\begin_layout Standard
Note that the network interfaces on the hosts are currently hard-coded inside
 TEACUP.
 For example, for FreeBSD hosts the topology setup method assumes that em1
 is the testbed interface.
 The interface names can only be changed by modifying the Python code.
\end_layout

\begin_layout Subsubsection
Link speed selection
\end_layout

\begin_layout Standard
As of version 0.9, TEACUP can set the link speed of the Ethernet links between
 the switch and testbed NICs.
 There are four settings for the speed: `10' (10
\begin_inset space \thinspace{}
\end_inset

Mbps, 10baseT), `100' (100
\begin_inset space \thinspace{}
\end_inset

Mpbs, 100baseT), `1000' (1000
\begin_inset space \thinspace{}
\end_inset

Mbps, 1000baseT), and `auto' (default, which should result in 1000baseT).
 The variable TPCONF_linkspeed allows to configure the link speed for all
 hosts.
 For example, if all hosts should use a link speed of 100 Mbps (100baseT)
 we can specify
\begin_inset listings
lstparams "basicstyle={\footnotesize\ttfamily}"
inline false
status open

\begin_layout Plain Layout

TPCONF_linkspeed = '100'
\end_layout

\end_inset


\end_layout

\begin_layout Standard
However, we can also configure host-specific link speeds with the dictionary
 TPCONF_host_linkspeed.
 Each entry must have as index a host name (as defined in TPCONF_router
 or TPCONF_hosts) and as value one of the possible speed settings explained
 above.
 For example, if testhost1 should be set 100 Mbps and testhost2 to 1000
 Mbps we can define
\begin_inset listings
lstparams "basicstyle={\footnotesize\ttfamily}"
inline false
status open

\begin_layout Plain Layout

TPCONF_host_linkspeed = {
\end_layout

\begin_layout Plain Layout

	'testhost1' : '100',
\end_layout

\begin_layout Plain Layout

	'testhost2' : '1000'
\end_layout

\begin_layout Plain Layout

}
\end_layout

\end_inset


\end_layout

\begin_layout Standard
TPCONF_host_linkspeed entries always overrule TPCONF_linkspeed.
 If neither variable is specified the default link speed setting is `auto',
 which should result in 1000baseT assuming Gigabit Ethernet NICs.
\end_layout

\begin_layout Standard
Note that the link speed setting is persistent for Linux, FreeBSD and Windows.
 However, for Mac OS X the speed will reset to 1000baseT after a reboot
 (normally this should not be an issue as hosts are only rebooted before
 experiments).
\end_layout

\begin_layout Subsection
Rebooting, OS selection and power cycling
\end_layout

\begin_layout Standard
With suitable external support, TEACUP enables automated rebooting of testbed
 hosts into different operating systems and forced power cycling of hosts
 that have become unresponsive.
\end_layout

\begin_layout Subsubsection
PXE-based rebooting
\end_layout

\begin_layout Standard
TEACUP's PXE-based rebooting process is explained in 
\begin_inset CommandInset citation
LatexCommand cite
key "zander2014caia_tcp_testbed_v2"

\end_inset

.
\end_layout

\begin_layout Standard
The IP address and port of the TFTP or HTTP server that serves the .ipxe
 configuration files during the PXE boot process is specified with the parameter
 TPCONF_tftpserver.
 Both IP address and port number must be specified separated by a colon.
 For example:
\end_layout

\begin_layout Standard
\begin_inset listings
lstparams "basicstyle={\footnotesize\ttfamily}"
inline false
status open

\begin_layout Plain Layout

TPCONF_tftpserver = '10.1.1.11:8080'
\end_layout

\end_inset


\end_layout

\begin_layout Standard
The path to the directory that is served by the TFTP or HTTP server is specified
 with TPCONF_tftpboot_dir.
\end_layout

\begin_layout Standard

\family typewriter
\size small
\begin_inset Box Frameless
position "t"
hor_pos "c"
has_inner_box 1
inner_pos "t"
use_parbox 0
use_makebox 0
width "98col%"
special "none"
height "1in"
height_special "totalheight"
status open

\begin_layout Plain Layout

\family typewriter
\size footnotesize
TPCONF_tftpboot_dir = '/tftpboot'
\end_layout

\end_inset


\end_layout

\begin_layout Standard
Omitting TPCONF_tftpboot_dir, or setting it to an empty string, disables
 PXE booting.
 TPCONF_host_os and TPCONF_force_reboot (see below) are then ignored.
\end_layout

\begin_layout Subsubsection
OS and kernel selection
\end_layout

\begin_layout Standard
\begin_inset CommandInset label
LatexCommand label
name "sub:os_kernel_selection"

\end_inset


\end_layout

\begin_layout Standard
The TPCONF_host_os dictionary specifies which OS are booted on the different
 hosts.
 The hosts (keys) specified must match the entries in the TPCONF_router
 and TPCONF_hosts lists exactly (any host specified in TPCONF_host_os must
 be specified in either TPCONF_router or TPCONF_hosts).
 The current code does simple string matching, it does 
\emph on
not
\emph default
 attempt to resolve host identifiers in some canonical form.
\end_layout

\begin_layout Standard
TEACUP currently supports selecting from four different types of OS: `Linux',
 `FreeBSD', `CYGWIN' (Windows) and `Darwin' (Mac OS X).
 Selecting the specific Linux kernels to boot is supported with the TPCONF_linux
_kern_router and TPCONF_linux_kern_hosts parameters (see below).
 The OS selection occurs once during reboot, and cannot subsequently be
 varied during a given experiment.
 
\end_layout

\begin_layout Standard
\begin_inset listings
lstparams "basicstyle={\footnotesize\ttfamily}"
inline false
status open

\begin_layout Plain Layout

TPCONF_host_os = { 
\end_layout

\begin_layout Plain Layout

'testhost1' : 'Linux', 
\end_layout

\begin_layout Plain Layout

'testhost2' : 'FreeBSD', 
\end_layout

\begin_layout Plain Layout

'testhost3' : 'Linux', 
\end_layout

\begin_layout Plain Layout

}
\end_layout

\end_inset


\end_layout

\begin_layout Standard
TPCONF_linux_kern_router specifies the Linux kernel booted on the router,
 and TPCONF_linux_kern_hosts specifies the Linux kernel booted on all other
 hosts.
 The name is the kernel image name minus the starting `vmlinuz-', so the
 name starts with the version number.
 It is also possible to specify the keywords `running' or `current' to tell
 TEACUP to use the same kernel that is currently running on the host (this
 
\emph on
requires
\emph default
 that the host is already running Linux).
\end_layout

\begin_layout Standard
\begin_inset listings
lstparams "basicstyle={\footnotesize\ttfamily}"
inline false
status open

\begin_layout Plain Layout

TPCONF_linux_kern_router = '3.14.18-10000hz'
\end_layout

\begin_layout Plain Layout

TPCONF_linux_kern_hosts = '3.9.8-web10g'
\end_layout

\end_inset


\end_layout

\begin_layout Standard
The parameter TPCONF_os_partition allows us to specify the partitions for
 the different operating systems on the hosts (in GRUB4DOS format since
 our TEACUP-based testbed uses GRUB4DOS to reboot into the desired OS).
 For example, if we have the configuration below then TEACUP will attempt
 to boot from the first partition of the first disk if Windows/Cygwin is
 selected, boot from the second partition of the first disk if Linux is
 selected, and boot from the third partition of the first disk if FreeBSD
 is selected.
\end_layout

\begin_layout Standard
\begin_inset listings
lstparams "basicstyle={\footnotesize\ttfamily}"
inline false
status open

\begin_layout Plain Layout

TPCONF_os_partition = { 
\end_layout

\begin_layout Plain Layout

'CYGWIN'  : '(hd0,0)',
\end_layout

\begin_layout Plain Layout

'Linux'   : '(hd0,1)', 
\end_layout

\begin_layout Plain Layout

'FreeBSD' : '(hd0,2)', 
\end_layout

\begin_layout Plain Layout

}
\end_layout

\end_inset


\end_layout

\begin_layout Subsubsection
Boot behaviour and timeout
\end_layout

\begin_layout Standard
If TPCONF_force_reboot is set to `1' 
\emph on
all
\emph default
 hosts will be rebooted.
 If TPCONF_force_reboot is set to `0' only hosts where the currently running
 OS (or kernel in case of Linux) is 
\emph on
not
\emph default
 the desired OS (or kernel in case of Linux), as specified in TPCONF_host_os
 (and TPCONF_linux_kern_router or TPCONF_linux_kern_hosts), will be rebooted.
\end_layout

\begin_layout Standard

\family typewriter
\size small
\begin_inset Box Frameless
position "t"
hor_pos "c"
has_inner_box 1
inner_pos "t"
use_parbox 0
use_makebox 0
width "97col%"
special "none"
height "1in"
height_special "totalheight"
status open

\begin_layout Plain Layout

\family typewriter
\size footnotesize
TPCONF_force_reboot = '1'
\end_layout

\end_inset


\end_layout

\begin_layout Standard
TPCONF_boot_timeout specifies the maximum time in seconds (as integer) a
 reboot can take.
 If the rebooted machine is not up and running the chosen OS after this
 time, the reboot is deemed a failure and the script aborts, unless TPCONF_do_po
wer_cycle is set to `1' (see below).
\end_layout

\begin_layout Standard

\family typewriter
\size small
\begin_inset Box Frameless
position "t"
hor_pos "c"
has_inner_box 1
inner_pos "t"
use_parbox 0
use_makebox 0
width "97col%"
special "none"
height "1in"
height_special "totalheight"
status open

\begin_layout Plain Layout

\family typewriter
\size footnotesize
TPCONF_boot_timeout = 100
\end_layout

\end_inset


\end_layout

\begin_layout Subsubsection
Forced power cycling
\end_layout

\begin_layout Standard
If TEACUP-supported power controllers are installed and TPCONF_do_power_cycle
 is set to `1', a host is power cycled if it does not reboot within TPCONF_boot_
timeout seconds.
 If TPCONF_do_power_cycle is omitted or set to `0' there is no power cycling.
\end_layout

\begin_layout Standard

\family typewriter
\size small
\begin_inset Box Frameless
position "t"
hor_pos "c"
has_inner_box 1
inner_pos "t"
use_parbox 0
use_makebox 0
width "97col%"
special "none"
height "1in"
height_special "totalheight"
status open

\begin_layout Plain Layout

\family typewriter
\size footnotesize
TPCONF_do_power_cycle = '0'
\end_layout

\end_inset


\end_layout

\begin_layout Standard
If TPCONF_do_power_cycle=1 then parameters TPCONF_power_ctrl_type, TPCONF_host_p
ower_ctrlport, TPCONF_power_admin_name and TPCONF_power_admin_pw must also
 be set.
\end_layout

\begin_layout Standard
TPCONF_power_ctrl_type must be used to specify the type of power controller
 -- `9258HP' (for an 
\begin_inset Quotes eld
\end_inset

IP Power 9258HP
\begin_inset Quotes erd
\end_inset

) or `SLP-SPP1008' (for a 
\begin_inset Quotes eld
\end_inset

Serverlink SLP-SPP1008-H
\begin_inset Quotes erd
\end_inset

).
 The default is '9258HP'.
 A mix of different types of power controllers is currently not supported.
\end_layout

\begin_layout Standard
\begin_inset listings
lstparams "basicstyle={\footnotesize\ttfamily}"
inline false
status open

\begin_layout Plain Layout

TPCONF_power_ctrl_type = '9258HP'
\end_layout

\end_inset


\end_layout

\begin_layout Standard
TPCONF_host_power_ctrlport is a dictionary that for each host specifies
 the IP (or host name) of the responsible power controller and the number
 of the controller's port the host is connected to (as integer starting
 from 1).
\end_layout

\begin_layout Standard
\begin_inset listings
lstparams "basicstyle={\footnotesize\ttfamily}"
inline false
status open

\begin_layout Plain Layout

TPCONF_host_power_ctrlport = { 
\end_layout

\begin_layout Plain Layout

'testhost1' : ( '192.168.1.178', '1' ), 
\end_layout

\begin_layout Plain Layout

'testhost2' : ( '192.168.1.178', '2' ), 
\end_layout

\begin_layout Plain Layout

'testhost3' : ( '192.168.1.178', '3' ), 
\end_layout

\begin_layout Plain Layout

} 
\end_layout

\end_inset


\end_layout

\begin_layout Standard
TPCONF_power_admin_name specifies the name of the power controller's admin
 user.
\end_layout

\begin_layout Standard

\family typewriter
\size small
\begin_inset Box Frameless
position "t"
hor_pos "c"
has_inner_box 1
inner_pos "t"
use_parbox 0
use_makebox 0
width "97col%"
special "none"
height "1in"
height_special "totalheight"
status open

\begin_layout Plain Layout

\family typewriter
\size footnotesize
TPCONF_power_admin_name = 'admin'
\end_layout

\end_inset


\end_layout

\begin_layout Standard
TPCONF_power_admin_pw specifies the password of the power controller's admin
 user (which in the below example is identical to the SSH password used
 by Fabric, but in general it can be different).
 
\end_layout

\begin_layout Standard

\family typewriter
\size small
\begin_inset Box Frameless
position "t"
hor_pos "c"
has_inner_box 1
inner_pos "t"
use_parbox 0
use_makebox 0
width "97col%"
special "none"
height "1in"
height_special "totalheight"
status open

\begin_layout Plain Layout

\family typewriter
\size footnotesize
TPCONF_power_admin_pw = env.password
\end_layout

\end_inset


\end_layout

\begin_layout Subsection
Clock offset measurement (broadcast pings)
\end_layout

\begin_layout Standard
\begin_inset CommandInset label
LatexCommand label
name "sub:broadcast-pings"

\end_inset


\end_layout

\begin_layout Standard
All the participating machines should have synchronised clocks (for example
 by running NTP) so we can accurately compare data measured on different
 hosts.
 However, clocks on consumer-grade PC hardware drift even while using NTP.
 TEACUP provides an additional mechanism to evaluate the quality of the
 time synchronisation and (optionally) correct for clock offsets in the
 post-analysis.
\end_layout

\begin_layout Standard
When TPCONF_bc_ping_enable is set to `1', TEACUP configures the router host
 to send a broadcast or multicast ping over the control network.
 These ping packets will be multicasted or broadcasted to the control interfaces
 of all other hosts (almost) simultaneously.
 
\end_layout

\begin_layout Standard
During experiments there is no other traffic on the control network and
 typically network jitter introduced by the sender (router), the network
 switch or the receiver is small.
 Thus one can estimate the offsets of the clocks of different hosts with
 relatively high accuracy by comparing the arrival times of the broadcast
 or multicast ping packets.
 Here we explain how to enable and configure the broadcast pings.
\end_layout

\begin_layout Standard
TPCONF_bc_ping_enable must be set to `1' to enable the broadcast/multicast
 ping (default is `0').
 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
mbox{
\end_layout

\end_inset

TPCONF_bc_ping_rate
\begin_inset ERT
status open

\begin_layout Plain Layout

}
\end_layout

\end_inset

 controls the rate in ping packets per second (default is one packet per
 second).
 TPCONF_bc_ping_address is the address the ping is sent to.
 This must be either a multicast address (e.g.
 224.0.1.199) or a broadcast address (e.g.
 192.168.0.255 if the control interfaces are in the 192.168.0.0/24 subnet).
 The following shows an example configuration for enabled multicast pings.
 
\end_layout

\begin_layout Standard

\family typewriter
\size small
\begin_inset Box Frameless
position "t"
hor_pos "c"
has_inner_box 1
inner_pos "t"
use_parbox 0
use_makebox 0
width "97col%"
special "none"
height "1in"
height_special "totalheight"
status open

\begin_layout Plain Layout

\family typewriter
\size footnotesize
TPCONF_bc_ping_enable = '1'
\end_layout

\begin_layout Plain Layout

\family typewriter
\size footnotesize
TPCONF_bc_ping_rate = 1
\end_layout

\begin_layout Plain Layout

\family typewriter
\size footnotesize
TPCONF_bc_ping_address = '224.0.1.199'
\end_layout

\end_inset


\end_layout

\begin_layout Standard
In technical report 
\begin_inset CommandInset citation
LatexCommand cite
key "zander2015caia_teacup_v1.0_analysis"

\end_inset

 we explain TEACUP's functions to analyse the clock offsets and use them
 for the correction of timestamps.
\end_layout

\begin_layout Subsection
Custom host init commands
\end_layout

\begin_layout Standard
\begin_inset CommandInset label
LatexCommand label
name "sub:Config-custom-host-setup"

\end_inset


\end_layout

\begin_layout Standard
TPCONF_host_init_custom_cmds allows to execute custom per-host init commands.
 This allows to change the host configuration, for example with sysctls.
 TPCONF_host_init_custom_cmds is a dictionary, where the key specifies the
 host name and the value is a list of commands.
 The commands are executed in exactly the order specified, after all default
 build-in host initialisation has been carried out.
 This means TPCONF_host_init_custom_cmds makes it possible to overrule default
 initialisation.
 The commands are specified as strings and are executed on the host exactly
 as specified (with the exception that V_variables, if present, are substituted
 with values).
 V_variables can be used in commands, but the current 
\emph on
limitation
\emph default
 is there can only be 
\emph on
one
\emph default
 V_variable per command.
\end_layout

\begin_layout Standard
The custom commands are executed before the router configuration.
 So when using for example a FreeBSD router we can use TPCONF_host_init_custom_c
mds to increase the maximum allowable Dummynet queue length (using sysctl)
 before Dummynet is actually configured.
 
\end_layout

\begin_layout Standard
Note that the commands are executed in the foreground, which means that
 for each command TEACUP will wait until it has been executed on the remote
 host before executing the next command for the 
\emph on
same
\emph default
 host.
 It is currently not possible to execute background commands.
 However, commands on different hosts are executed in parallel, i.e.
 waiting for a command to finish on host testhost1 does not block executing
 the next command on host testhost2.
 In summary, commands on different host are executed in parallel, but commands
 on the same host are executed sequentially.
 
\end_layout

\begin_layout Standard
The following config file part shows an example where we simply execute
 the command `echo TEST' on host testhost1.
\end_layout

\begin_layout Standard
\begin_inset listings
lstparams "basicstyle={\footnotesize\ttfamily}"
inline false
status open

\begin_layout Plain Layout

TPCONF_host_init_custom_cmds = { 
\end_layout

\begin_layout Plain Layout

'testhost1' : [ 'echo TEST', ], 
\end_layout

\begin_layout Plain Layout

}
\end_layout

\end_inset


\end_layout

\begin_layout Subsection
Router queue setup
\end_layout

\begin_layout Standard
\begin_inset CommandInset label
LatexCommand label
name "sub:Config-router-queues"

\end_inset


\end_layout

\begin_layout Standard
The variable TPCONF_router_queues specifies the router pipes (also referred
 to as queues here).
 Each entry is a 2-tuple.
 The first value specifies a unique integer ID for each queue.
 The second value is a comma-separated string specifying the queue parameters.
 The queues do not necessarily need to be defined in the order of queue
 ID, but it is recommended to do so.
 The following queue parameters exist:
\end_layout

\begin_layout Itemize

\series bold
source
\series default
: Specifies the source IP/hostname or source network (<ip>[/<prefix>]) of
 traffic that is queued in this queue.
 If a host name is specified there can be no prefix.
 One can specify an internal/testbed or external/control IP/hostname.
 If an external IP/hostname is specified this will be automatically translated
 into the first internal IP specified for the host in TPCONF_host_internal_ip.
\end_layout

\begin_layout Itemize

\series bold
dest
\series default
: Specifies the destination IP/hostname or source network (<ip>[/<prefix>])
 of traffic that is queued in this queue.
 If a host name is specified there can be no prefix.
 One can specify an internal/testbed or external/control IP/hostname.
 If an external IP/hostname is specified this will be automatically translated
 into the first internal IP specified for the host in TPCONF_host_internal_ip.
\end_layout

\begin_layout Itemize

\series bold
delay
\series default
: Specifies the emulated constant delay in milliseconds.
 For example, delay=50 sets the delay to 50
\begin_inset space \thinspace{}
\end_inset

ms.
\end_layout

\begin_layout Itemize

\series bold
loss
\series default
: Specifies the emulated constant loss rate.
 For example, loss=0.01 sets the loss rate to 1%.
\end_layout

\begin_layout Itemize

\series bold
rate
\series default
: Specifies the rate limit of the queue.
 On Linux we can use units such as `kbit' or `mbit'.
 For example, queue_size=`1mbit' sets the rate limit to 1 Mbit/second.
 
\end_layout

\begin_layout Itemize

\series bold
queue_size
\series default
: Specifies the size of the queue.
 On Linux queue size is defined in packets for most queuing disciplines,
 but for some queuing disciplines it needs to be specified in bytes.
 For example, if we have a Linux queue with size specified in packets, queue_siz
e=1000 sets the queue size to 1000 packets.
 On FreeBSD the queue size is also specified in packets typically, but one
 can specify the size in bytes by adding a `bytes' or `kbytes', for example
 queue_size=`100kbytes' specifies a queue of size 100
\begin_inset space \thinspace{}
\end_inset

kbytes.
 If `bdp' is specified the queue size will be set to the nominal bandwidth-delay
-product (BDP) (this does 
\emph on
only
\emph default
 work for queuing disciplines where TEACUP knows whether the queue size
 is specified in bytes or packets).
 The minimum queue size is one packet (if the size is specified in packets)
 or 2048
\begin_inset space \thinspace{}
\end_inset

bytes (if the size is specified in bytes).
\end_layout

\begin_layout Itemize

\series bold
queue_size_mult
\series default
: The actual queue size is the queue size multiplied with this factor.
 This should only be used if queue_size if set to `bdp'.
 This allows to vary the queue size in multiples of the nominal BDP.
\end_layout

\begin_layout Itemize

\series bold
queue_disc
\series default
: Specifies the queuing discipline.
 This can be the name of any of the queuing disciplines supported by Linux,
 such as `fq_codel', `codel', `red', `choke', `pfifo', `pie' etc.
 On FreeBSD the only queuing disciplines available are `fifo' and `red'.
 For example, queue_disc=`fq_codel' sets the queuing discipline to the fair-queu
ing+codel model.
 For compatibility, with FreeBSD one can specify `fifo' on Linux, which
 is mapped to `pfifo' (`pfifo' is the default for HTB classes, which we
 use for rate limiting).
 The queue_disc parameter must be specified explicitly.
 
\end_layout

\begin_layout Itemize

\series bold
queue_disc_params
\series default
: This parameter allows to pass parameters to queuing disciplines.
 For example, if we wanted to turn ECN on for fq_codel we would specify
 queue_disc_params=`ecn' (c.f.
 fq_codel man page).
\end_layout

\begin_layout Itemize

\series bold
bidir
\series default
: This allows to specify whether a queue is unidirectional (set to `0')
 or bidirectional (set to `1').
 A unidirectional queue will only get the traffic from source to destination,
 whereas a bidirectional queue will get the traffic from source to dest
 
\emph on
and
\emph default
 from destination to source.
\end_layout

\begin_layout Itemize

\series bold
attach_to_queue
\series default
: This parameter works on Linux 
\emph on
only.

\emph default
 It allows to direct matching packets into an existing queue referenced
 by the specified queue ID, but to emulate flow-specific delay/loss (different
 from the delay and loss of other traffic).
 If attach_to_queue is specified the matching traffic will go through the
 already existing queue, but the emulated delay or loss is set according
 to the current queue specification.
 This means we can omit the rate, queue_disc and queue_size parameters,
 because they do not have any effect.
\end_layout

\begin_layout Itemize

\series bold
rtt
\series default
: This parameter allows to explicitly specify the emulated RTT in milliseconds.
 This parameter only needs to be specified if queue_size is set to `bdp'
 and the RTT is not twice the delay of the current TEACUP queue (e.g.
 if we set up asymmetric delay with attach_to_queue).
\end_layout

\begin_layout Standard
All parameters must be assigned with either a constant value or a TEACUP
 V_variable.
 V_variable names must be defined in TPCONF_parameter_list and TPCONF_variable_d
efaults (see below).
 V_variables are replaced with either the default value specified in TPCONF_vari
able_defaults or the current value from TPCONF_parameter_list if we iterate
 through multiple values for the parameter.
\end_layout

\begin_layout Standard
Figure 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:Router-queue-definition"

\end_inset

 shows an example queue setup with the same delay and loss for every host
 and the same delay and loss in both directions (all the parameters are
 variables here).
\end_layout

\begin_layout Standard
\begin_inset Float figure
placement t
wide true
sideways false
status open

\begin_layout Plain Layout
\align center
\begin_inset listings
lstparams "basicstyle={\scriptsize\ttfamily}"
inline false
status open

\begin_layout Plain Layout

TPCONF_router_queues = [ 
\end_layout

\begin_layout Plain Layout

( '1', "source='172.16.10.0/24', dest='172.16.11.0/24', delay=V_delay, loss=V_loss,
 rate=V_urate, 
\end_layout

\begin_layout Plain Layout

        queue_disc=V_aqm, queue_size=V_bsize" ), 
\end_layout

\begin_layout Plain Layout

( '2', "source='172.16.11.0/24', dest='172.16.10.0/24', delay=V_delay, loss=V_loss,
 rate=V_drate, 
\end_layout

\begin_layout Plain Layout

        queue_disc=V_aqm, queue_size=V_bsize" ), 
\end_layout

\begin_layout Plain Layout

]
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "fig:Router-queue-definition"

\end_inset

Router queue definition example
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
Figure 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:Router-queue-definition-2"

\end_inset

 shows an example that illustrates the attach_to_queue parameter.
 Traffic between 172.16.10.3 and 172.16.11.3 goes through the same queues as traffic
 between 172.16.10.2 and 172.16.11.2, but in both directions it experiences twice
 the delay.
\end_layout

\begin_layout Standard
\begin_inset Float figure
placement t
wide true
sideways false
status open

\begin_layout Plain Layout
\align center
\begin_inset listings
lstparams "basicstyle={\scriptsize\ttfamily}"
inline false
status open

\begin_layout Plain Layout

TPCONF_router_queues = [ 
\end_layout

\begin_layout Plain Layout

( '1', "source='172.16.10.2', dest='172.16.11.2', delay=V_delay, loss=V_loss,
 rate=V_up_rate, 
\end_layout

\begin_layout Plain Layout

        queue_disc=V_aqm, queue_size=V_bsize" ), 
\end_layout

\begin_layout Plain Layout

( '2', "source='172.16.11.2', dest='172.16.10.2', delay=V_delay, loss=V_loss,
 rate=V_down_rate, 
\end_layout

\begin_layout Plain Layout

        queue_disc=V_aqm, queue_size=V_bsize" ), 
\end_layout

\begin_layout Plain Layout

( '3', "source='172.16.10.3', dest='172.16.11.3', delay=2*V_delay, loss=V_loss,
 attach_to_queue='1'" ), 
\end_layout

\begin_layout Plain Layout

( '4', "source='172.16.11.3', dest='172.16.10.3', delay=2*V_delay, loss=V_loss,
 attach_to_queue='2'" ), 
\end_layout

\begin_layout Plain Layout

]
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "fig:Router-queue-definition-2"

\end_inset

Router queue definition with attach_to_queue example
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
Since version 0.9 TEACUP supports multiple routers.
 If multiple routers are specified in TPCONF_router, but there is only one
 TPCONF_router_queues specification (for example the one shown above), TEACUP
 will apply the single TPCONF_router_queues specification to all routers.
 However, in many cases with multiple routers we want to specify router-specific
 queue setups.
 This can be done by making TPCONF_router_queues a dictionary with the keys
 being router names (as specified in TPCONF_router) and the values being
 TPCONF_router_queues specifications.
\end_layout

\begin_layout Standard
As an example let us assume there are two routers: testrouter1 and testrouter2.
 For each of the routers we need to specify the queue setup (for brevity
 we use a placeholder here instead of showing the actual queue specifications:
\begin_inset listings
lstparams "basicstyle={\footnotesize\ttfamily}"
inline false
status open

\begin_layout Plain Layout

testrouter1_queues = [<queue_spec1>]
\end_layout

\begin_layout Plain Layout

testrouter2_queues = [<queue_spec2>]
\end_layout

\end_inset


\end_layout

\begin_layout Standard
Then we need to define TPCONF_router_queues as explained above:
\begin_inset listings
lstparams "basicstyle={\footnotesize\ttfamily}"
inline false
status open

\begin_layout Plain Layout

TPCONF_router_queues = {}
\end_layout

\begin_layout Plain Layout

TPCONF_router_queues['testrouter1'] = 
\end_layout

\begin_layout Plain Layout

	testrouter1_queues
\end_layout

\begin_layout Plain Layout

TPCONF_router_queues['testrouter2'] = 
\end_layout

\begin_layout Plain Layout

	testrouter2_queues
\end_layout

\end_inset


\end_layout

\begin_layout Subsection
Traffic generator setup
\end_layout

\begin_layout Standard
Traffic generators are defined with the variable 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
mbox{
\end_layout

\end_inset

TPCONF_traffic_gens
\begin_inset ERT
status open

\begin_layout Plain Layout

}
\end_layout

\end_inset

.
 This is a list of 3-tuples.
 The first value of a tuple is the start time relative to the start time
 of the experiment.
 The second value of the tuple is a unique ID.
 The third value of the tuple is a list of strings with the function name
 of the start function of the traffic generator as first entry followed
 by the parameters.
 The name of the functions and the parameters for each function are described
 in Section 
\begin_inset CommandInset ref
LatexCommand ref
reference "sub:Config-traffic-generators"

\end_inset

.
\end_layout

\begin_layout Standard
Client and server parameters can be external (control network) addresses
 or host names.
 An external address or host name is replaced by the first internal address
 specified for a host in TPCONF_host_internal_ip.
 Client and server parameters can also be internal (testbed network) addresses,
 which allows to specify any internal address.
\end_layout

\begin_layout Standard
Each parameter is defined as <parameter_name>=<parameter_value>.
 Parameter names must be the parameter names of traffic generator functions
 (and as such be valid Python variable names).
 Parameter values can be either constants (string or numeric) or TEACUP
 V_variables that are replaced by the actual values depending on the current
 experiment.
 The V_variables must be defined in TPCONF_parameter_list and TPCONF_variable_de
faults.
 Numeric V_variables can be modified using mathematical operations, such
 as addition or multiplication, with constants.
 For example, if a variable `V_delay' exists one can specify `2
\begin_inset Formula $\cdot$
\end_inset

V_delay' as parameter value.
\end_layout

\begin_layout Standard
Figure 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:Traffic-generator-example"

\end_inset

 shows a simple example.
 At time zero a web server is started and fake DASH content is created.
 0.5 seconds later a httperf DASH-like client is started.
 The duration and rate of the DASH-like flow are specified by variables
 that can change for each experiment.
 In contrast the cycle length and prefetch time are set to fixed values.
 
\end_layout

\begin_layout Standard
\begin_inset Float figure
placement t
wide true
sideways false
status open

\begin_layout Plain Layout
\align center
\begin_inset listings
lstparams "basicstyle={\scriptsize\ttfamily}"
inline false
status open

\begin_layout Plain Layout

TPCONF_traffic_gens = [ 
\end_layout

\begin_layout Plain Layout

( '0.0', '1', "start_http_server, server='testhost3', port=80" ), 
\end_layout

\begin_layout Plain Layout

( '0.0', '2', "create_http_dash_content, server='testhost3', duration=2*V_duratio
n, 
\end_layout

\begin_layout Plain Layout

               rates=V_dash_rates, cycles='5, 10'" ), 
\end_layout

\begin_layout Plain Layout

( '0.5', '3', "start_httperf_dash, client='testhost2', server='testhost3',
 port=80, 
\end_layout

\begin_layout Plain Layout

               duration=V_duration, rate=V_dash_rate, cycle=5, prefetch=2"
 ),
\end_layout

\begin_layout Plain Layout

]
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "fig:Traffic-generator-example"

\end_inset

Traffic generator example
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
The example config files in the source code distribution contain more examples
 of setting up traffic generators.
\end_layout

\begin_layout Subsection
Available traffic generators
\end_layout

\begin_layout Standard
\begin_inset CommandInset label
LatexCommand label
name "sub:Config-traffic-generators"

\end_inset


\end_layout

\begin_layout Standard
This section describes the traffic generators (listed by their start function
 names) that can be used in TPCONF_traffic_gens.
\end_layout

\begin_layout Subsubsection
start_iperf
\end_layout

\begin_layout Standard
This starts an iperf client and server.
 Note that the client sends data to the server.
 It has the following parameters: 
\end_layout

\begin_layout Itemize

\series bold
port
\series default
: port number to use for client and server (passed to iperf -p option) 
\end_layout

\begin_layout Itemize

\series bold
client
\series default
: IP or name of client (passed to iperf -c option)
\end_layout

\begin_layout Itemize

\series bold
server
\series default
: IP or name of server (passed to iperf -B option)
\end_layout

\begin_layout Itemize

\series bold
duration
\series default
: time in seconds the client transmits (passed to iperf -t option)
\end_layout

\begin_layout Itemize

\series bold
congestion_algo
\series default
: TCP congestion algorithm to use (works only on Linux) 
\end_layout

\begin_layout Itemize

\series bold
kill
\series default
: By default this is `0' and the iperf client will terminate after duration
 seconds.
 If this is set to `1', the iperf client will be killed approximately 1
 second after duration.
 This is a work-around for a 
\begin_inset Quotes eld
\end_inset

feature
\begin_inset Quotes erd
\end_inset

 in iperf that prevents it from stopping after the specified duration.
 (If set to `1', the iperf server is also killed approximately 2 seconds
 after duration.)
\end_layout

\begin_layout Itemize

\series bold
mss
\series default
: TCP maximum segment size (passed to iperf -M option)
\end_layout

\begin_layout Itemize

\series bold
buf_size
\series default
: Send and receive buffer size in bytes (passed to iperf -j and -k, which
 only exist for iperf with the CAIA patch 
\begin_inset CommandInset citation
LatexCommand cite
key "zander2014caia_tcp_testbed_v2"

\end_inset

) 
\end_layout

\begin_layout Itemize

\series bold
proto
\series default
: Protocol to use, `tcp' (default) or `udp' (sets iperf -u option for `udp')
 
\end_layout

\begin_layout Itemize

\series bold
rate
\series default
: The bandwidth used for TCP (passed to iperf -a option) or UDP (passed
 to iperf -b option).
 Can end in `K' or `M' to indicate kilo bytes or mega bytes.
 
\end_layout

\begin_layout Itemize

\series bold
extra_params_client
\series default
: Command line parameters passed to iperf client 
\end_layout

\begin_layout Itemize

\series bold
extra_params_server
\series default
: Command line parameters passed to iperf server
\end_layout

\begin_layout Subsubsection
start_ping
\end_layout

\begin_layout Standard
This starts a ping and has the following parameters: 
\end_layout

\begin_layout Itemize

\series bold
client
\series default
: IP or name of machine to run ping on 
\end_layout

\begin_layout Itemize

\series bold
dest
\series default
: IP or name of machine to ping 
\end_layout

\begin_layout Itemize

\series bold
rate
\series default
: number of pings per second (Windows ping only supports 1 ping/second)
 (default = 1) 
\end_layout

\begin_layout Itemize

\series bold
extra_params
\series default
: Command line parameters passed to ping
\end_layout

\begin_layout Subsubsection
start_http_server
\end_layout

\begin_layout Standard
This starts an HTTP server (lighttpd) and has the following parameters:
 
\end_layout

\begin_layout Itemize

\series bold
port
\series default
: port to listen on (currently one server can listen on only one port) 
\end_layout

\begin_layout Itemize

\series bold
config_dir
\series default
: directory where the config file (lighttpd.conf) should be copied to 
\end_layout

\begin_layout Itemize

\series bold
config_in
\series default
: local template for config file 
\end_layout

\begin_layout Itemize

\series bold
docroot
\series default
: document root on server (FreeBSD default: /usr/local/www/data, MacOSX
 default: /opt/local/www/htdocs, Linux/CYGWIN default: 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
mbox{
\end_layout

\end_inset

/srv/www/htdocs
\begin_inset ERT
status open

\begin_layout Plain Layout

}
\end_layout

\end_inset

)
\end_layout

\begin_layout Subsubsection
create_http_dash_content
\end_layout

\begin_layout Standard
This creates fake content for the DASH-like client.
 It has the following parameters: 
\end_layout

\begin_layout Itemize

\series bold
server
\series default
: IP or name of HTTP server 
\end_layout

\begin_layout Itemize

\series bold
docroot
\series default
: document root of HTTP server (FreeBSD default: 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
mbox{
\end_layout

\end_inset

/usr/local/www/data
\begin_inset ERT
status open

\begin_layout Plain Layout

}
\end_layout

\end_inset

, MacOSX default: 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
mbox{
\end_layout

\end_inset

/opt/local/www/htdocs
\begin_inset ERT
status open

\begin_layout Plain Layout

}
\end_layout

\end_inset

, Linux/CYGWIN default: /srv/www/htdocs) 
\end_layout

\begin_layout Itemize

\series bold
duration
\series default
: number of seconds of fake content 
\end_layout

\begin_layout Itemize

\series bold
rates
\series default
: comma-separated list of DASH rates in kB 
\end_layout

\begin_layout Itemize

\series bold
cycles
\series default
: comma-separated list of cycle lengths in seconds
\end_layout

\begin_layout Subsubsection
create_http_incast_content
\end_layout

\begin_layout Standard
This creates fake content for incast experiments.
 It has the following parameters: 
\end_layout

\begin_layout Itemize

\series bold
server
\series default
: IP or name of HTTP server 
\end_layout

\begin_layout Itemize

\series bold
docroot
\series default
: document root of HTTP server (FreeBSD default: 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
mbox{
\end_layout

\end_inset

/usr/local/www/data
\begin_inset ERT
status open

\begin_layout Plain Layout

}
\end_layout

\end_inset

, MacOSX default: 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
mbox{
\end_layout

\end_inset

/opt/local/www/htdocs
\begin_inset ERT
status open

\begin_layout Plain Layout

}
\end_layout

\end_inset

, Linux/CYGWIN default: /srv/www/htdocs) 
\end_layout

\begin_layout Itemize

\series bold
sizes
\series default
: comma-separated list of content file sizes 
\end_layout

\begin_layout Subsubsection
start_httperf
\end_layout

\begin_layout Standard
This starts an httperf HTTP client.
 It has the following parameters: 
\end_layout

\begin_layout Itemize

\series bold
client
\series default
: IP or name of client 
\end_layout

\begin_layout Itemize

\series bold
server
\series default
: IP or name of HTTP server (passed to httperf -
\begin_inset ERT
status open

\begin_layout Plain Layout

{}
\end_layout

\end_inset

-server)
\end_layout

\begin_layout Itemize

\series bold
port
\series default
: port server is listening on (passed to httperf -
\begin_inset ERT
status open

\begin_layout Plain Layout

{}
\end_layout

\end_inset

-port)
\end_layout

\begin_layout Itemize

\series bold
conns
\series default
: total number of connections (passed to httperf -
\begin_inset ERT
status open

\begin_layout Plain Layout

{}
\end_layout

\end_inset

-num-conns)
\end_layout

\begin_layout Itemize

\series bold
rate
\series default
: rate at which connections are created (passed to httperf -
\begin_inset ERT
status open

\begin_layout Plain Layout

{}
\end_layout

\end_inset

-rate)
\end_layout

\begin_layout Itemize

\series bold
timeout
\series default
: timeout for each connection; httperf will give up if a HTTP request does
 not complete within the timeout (passed to httperf -
\begin_inset ERT
status open

\begin_layout Plain Layout

{}
\end_layout

\end_inset

-timeout) 
\end_layout

\begin_layout Itemize

\series bold
calls
\series default
: number of requests in each connection (passed to httperf -
\begin_inset ERT
status open

\begin_layout Plain Layout

{}
\end_layout

\end_inset

-num-calls, default = 1) 
\end_layout

\begin_layout Itemize

\series bold
burst
\series default
: length of burst (passed to httperf -
\begin_inset ERT
status open

\begin_layout Plain Layout

{}
\end_layout

\end_inset

-burst-length)
\end_layout

\begin_layout Itemize

\series bold
wsesslog
\series default
: session description file (passed to third parameter of httperf -
\begin_inset ERT
status open

\begin_layout Plain Layout

{}
\end_layout

\end_inset

-wsesslog)
\end_layout

\begin_layout Itemize

\series bold
wsesslog_timeout
\series default
: default timeout for each wsesslog connection (passed to second parameter
 of httperf -
\begin_inset ERT
status open

\begin_layout Plain Layout

{}
\end_layout

\end_inset

-wsesslog) 
\end_layout

\begin_layout Itemize

\series bold
period
\series default
: time between creation of connections; equivalent to 1/rate if period is
 a number, but period can also specify inter-arrival time distributions
 (see httperf man page) 
\end_layout

\begin_layout Itemize

\series bold
sessions
\series default
: number of sessions (passed to first parameter of httperf -
\begin_inset ERT
status open

\begin_layout Plain Layout

{}
\end_layout

\end_inset

-wsesslog, default = 1) 
\end_layout

\begin_layout Itemize

\series bold
call_stats
\series default
: number of entries in call statistics array (passed to httperf -
\begin_inset ERT
status open

\begin_layout Plain Layout

{}
\end_layout

\end_inset

-call-stats, default = 1000) 
\end_layout

\begin_layout Itemize

\series bold
extra_params
\series default
: Command line parameters passed to httperf
\end_layout

\begin_layout Subsubsection
start_httperf_dash
\end_layout

\begin_layout Standard
This starts a DASH-like httperf client.
 It has the following parameters: 
\end_layout

\begin_layout Itemize

\series bold
client
\series default
: IP or name of client 
\end_layout

\begin_layout Itemize

\series bold
server
\series default
: IP or name of HTTP server (passed to httperf -
\begin_inset ERT
status open

\begin_layout Plain Layout

{}
\end_layout

\end_inset

-server)
\end_layout

\begin_layout Itemize

\series bold
port
\series default
: port server is listening on (passed to httperf -
\begin_inset ERT
status open

\begin_layout Plain Layout

{}
\end_layout

\end_inset

-port)
\end_layout

\begin_layout Itemize

\series bold
duration
\series default
: duration of DASH flow in seconds 
\end_layout

\begin_layout Itemize

\series bold
rate
\series default
: data rate of DASH-like flow in kbps 
\end_layout

\begin_layout Itemize

\series bold
cycle
\series default
: interval between requests in seconds 
\end_layout

\begin_layout Itemize

\series bold
prefetch
\series default
: prefetch time in seconds of content to prefetch (can be fractional number)
 (default = 0.0) 
\end_layout

\begin_layout Itemize

\series bold
prefetch_timeout
\series default
: like timeout for start_httperf but only for the prefetch (by default this
 is set to cycle) 
\end_layout

\begin_layout Itemize

\series bold
with_timeout
\series default
: if set to `0' there is no timeout for requests (a request may take longer
 to complete than cycle); if set to `1' httperf will close the connection
 and terminate the session if the download of a chunk takes longer than
 cycle
\end_layout

\begin_layout Itemize

\series bold
extra_params
\series default
: Command line parameters passed to httperf
\end_layout

\begin_layout Standard
The behaviour is as follows: 
\end_layout

\begin_layout Enumerate
The client opens a persistent TCP connection to the server.
\end_layout

\begin_layout Enumerate
If prefetch is > 0.0 the client will fetch the specified number of seconds
 of content and right after that send a request for the next block (step
 3).
 
\end_layout

\begin_layout Enumerate
The client will request a block of content, wait for some time (cycle minus
 download time) and then request the next block.
 The size of one block is cycle
\begin_inset Formula $\cdot$
\end_inset

rate
\begin_inset Formula $\cdot$
\end_inset

1000
\begin_inset Formula $/$
\end_inset

8 bytes.
 
\end_layout

\begin_layout Standard
If prefetch_timeout is set, the prefetch must be completed within the timeout,
 or otherwise httperf will close the connection and terminate the session.
 Similarly, if with_timeout=`1', httperf will close the connection and terminate
 the session if the download of a chunk takes longer than cycle seconds.
\end_layout

\begin_layout Standard
Note that the number of chunks requested by the httperf client is set to
 floor((duration - prefetch_timeout) / cycle).
 This number guarantees that httperf can complete and generate the statistics
 output within the specified duration, even if the downloading takes the
 maximum amount of time (downloading always just finishes within the timeouts).
 However, this also means that if the prefetch is much faster than prefetch_time
out and/or the download of the last chunk is much faster than cycle seconds,
 httperf will finish well before duration seconds.
\end_layout

\begin_layout Subsubsection
start_httperf_incast
\end_layout

\begin_layout Standard
This starts an httperf client for the incast scenario.
 It has the following parameters: 
\end_layout

\begin_layout Itemize

\series bold
client
\series default
: IP or name of client 
\end_layout

\begin_layout Itemize

\series bold
servers
\series default
: comma-separated list where each entry specifies one server in the form
 of `[IP|name]:port'.
 IP or name is a server's IP address or name and port is the port the server
 is listening on (a separate session for each server is created via httperf's
 session log).
\end_layout

\begin_layout Itemize

\series bold
duration
\series default
: duration of incast session in seconds 
\end_layout

\begin_layout Itemize

\series bold
period
\series default
: period between requests in seconds (floating point number)
\end_layout

\begin_layout Itemize

\series bold
burst_size
\series default
: number of queries sent at each period start (this is to increase the number
 of queries in a testbed that only has a few physical responder machines)
 
\end_layout

\begin_layout Itemize

\series bold
response_size
\series default
: size of response from each responder in kB 
\end_layout

\begin_layout Itemize

\series bold
extra_params
\series default
: Command line parameters passed to httperf
\end_layout

\begin_layout Standard
Note that if httperf can not complete a request within period time, if will
 close the connection and terminate the session with the responder (sessions
 with other responders are unaffected).
\end_layout

\begin_layout Subsubsection
start_nttcp
\end_layout

\begin_layout Standard
This starts an nttcp client and an nttcp server for some simple unidirectional
 UDP VoIP flow emulation.
 It has the following parameters: 
\end_layout

\begin_layout Itemize

\series bold
client
\series default
: IP or name of client 
\end_layout

\begin_layout Itemize

\series bold
server
\series default
: IP or name of HTTP server 
\end_layout

\begin_layout Itemize

\series bold
port
\series default
: control port server is listening on (passed to nttcp -p)
\end_layout

\begin_layout Itemize

\series bold
duration
\series default
: duration of the flow (based on this and the interval TEACUP computes the
 number of buffers to send, passed to nttcp -n)
\end_layout

\begin_layout Itemize

\series bold
interval
\series default
: interval between UDP packets in milliseconds (passed to nttcp -g)
\end_layout

\begin_layout Itemize

\series bold
psize
\series default
: UDP payload size (excluding UDP/IP header) (passed to nttcp -l)
\end_layout

\begin_layout Itemize

\series bold
buf_size
\series default
: send buffer size (passed to nttcp -w)
\end_layout

\begin_layout Itemize

\series bold
extra_params_client
\series default
: Command line parameters passed to nttcp client 
\end_layout

\begin_layout Itemize

\series bold
extra_params_server
\series default
: Command line parameters passed to nttcp server
\end_layout

\begin_layout Standard
Note that nttcp also opens a TCP control connection between client and server.
 However, on this connection only a few packets are exchanged before and
 after the data flow.
 
\end_layout

\begin_layout Subsubsection
start_httperf_incast_n
\end_layout

\begin_layout Standard
This starts an httperf client (querier) and 
\begin_inset Formula $n$
\end_inset

 HTTP servers (responders) for an incast scenario.
 It also generates the fake content for all 
\begin_inset Formula $n$
\end_inset

 servers.
 Basically this generator is a shortcut to setting up 
\begin_inset Formula $n$
\end_inset

 servers with 
\begin_inset Formula $n$
\end_inset

 start_http_server and create_http_incast_content.
 It has the following parameters: 
\end_layout

\begin_layout Itemize

\series bold
client
\series default
: IP or name of client 
\end_layout

\begin_layout Itemize

\series bold
servers
\series default
: comma-separated list of servers, where each entry is either the IP or
 the host name of an HTTP server (a separate session for each server is
 created via httperf's session log)
\end_layout

\begin_layout Itemize

\series bold
server_port_start
\series default
: the port the first server is listening on.
 All further servers will be started on consecutive port numbers in the
 order they are specified in servers
\end_layout

\begin_layout Itemize

\series bold
duration
\series default
: duration of incast session in seconds 
\end_layout

\begin_layout Itemize

\series bold
period
\series default
: period between requests in seconds (floating point number)
\end_layout

\begin_layout Itemize

\series bold
burst_size
\series default
: number of queries sent at each period start (this is to increase the number
 of queries in a testbed that only has a few physical responder machines)
 
\end_layout

\begin_layout Itemize

\series bold
response_size
\series default
: size of response from each responder in kB 
\end_layout

\begin_layout Itemize

\series bold
config_dir
\series default
: directory where the config file (lighttpd.conf) should be copied to 
\end_layout

\begin_layout Itemize

\series bold
config_in
\series default
: local template for config file 
\end_layout

\begin_layout Itemize

\series bold
docroot
\series default
: document root on server (FreeBSD default: /usr/local/www/data, MacOSX
 default: /opt/local/www/htdocs, Linux/CYGWIN default: 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
mbox{
\end_layout

\end_inset

/srv/www/htdocs
\begin_inset ERT
status open

\begin_layout Plain Layout

}
\end_layout

\end_inset

)
\end_layout

\begin_layout Itemize

\series bold
sizes
\series default
: comma-separated list of content file sizes on the servers
\end_layout

\begin_layout Itemize

\series bold
num_responders
\series default
: The querier will only send queries to the first num_responders servers.
 This can be used to vary the number of responders in a series of experiments
\end_layout

\begin_layout Itemize

\series bold
extra_params
\series default
: Command line parameters passed to httperf
\end_layout

\begin_layout Standard
Note that for this method the unique ID is the first ID used.
 The total number of IDs used is one plus the number of server/responders.
 Each server will be assigned a consecutive ID number starting with the
 first ID.
 The client will have an ID one higher than the highest server ID.
 If further traffic generators are specified after this generator, the user
 has to make sure there is no ID number clash.
\end_layout

\begin_layout Subsubsection
start_fps_game
\end_layout

\begin_layout Standard
This starts an emulated FPS game traffic session.
 From a logical viewpoint this starts several game clients and one game
 server.
 However, since the pktgen tool from 
\begin_inset CommandInset citation
LatexCommand cite
key "bitss-web"

\end_inset

 we use to generate the game traffic can only generate a single unidirectional
 traffic flow, this task starts pktgen twice as many times as there are
 clients (half of these processes generate the client-to-server traffic
 and half of these processes generate the server-to-client traffic).
 The task has the following parameters:
\end_layout

\begin_layout Itemize

\series bold
clients
\series default
: comma-separated list of clients where each client is specified as name/IP
 followed by a colon and the port number (e.g.
 client1:10000,client2:10001)
\end_layout

\begin_layout Itemize

\series bold
server
\series default
: server name/IP followed by a colon and the server port number (e.g.
 server1:27960)
\end_layout

\begin_layout Itemize

\series bold
game_type
\series default
: the type of game (can be `q3', `hl2cs', `hl2dm', `hlcs', `hldm', `et2pro',
 `q4')
\end_layout

\begin_layout Itemize

\series bold
c2s_interval
\series default
: time interval between packets send by client (in seconds)
\end_layout

\begin_layout Itemize

\series bold
c2s_psize
\series default
: base packet size of packets send by clients (number of bytes of UDP payload);
 note that pktgen randomly varies the size of packets within a few bytes
 above the base size)
\end_layout

\begin_layout Itemize

\series bold
s2c_interval
\series default
: time interval between packets send by server (in seconds)
\end_layout

\begin_layout Itemize

\series bold
duration
\series default
: duration of the game session (in seconds)
\end_layout

\begin_layout Itemize

\series bold
client_start_delay
\series default
: delay between the last server-to-client pktgen process started and the
 first client-to-server pktgen process started (in seconds) 
\end_layout

\begin_layout Itemize

\series bold
extra_params_client
\series default
: extra parameters passed to client pktgen processes
\end_layout

\begin_layout Itemize

\series bold
extra_params_server
\series default
: extra parameters passed to server pktgen processes 
\end_layout

\begin_layout Standard
Note that a pktgen server process will wait for packets from its corresponding
 client process before starting to send packets.
 In contrast, a client process will send packets to a corresponding server
 process immediately.
 If a client process is started, but the corresponding server process is
 not listening for packets yet, the server machine will return ICMP port
 unreachable messages to the client machine, which in turn will terminate
 the client process.
 The parameter client_start_delay must be set large enough so that all server
 processes are started and listen for packets before any client processes
 are started.
 The delay must be chosen based on the number of game clients (as each game
 client results in one pktgen process started on the server).
 By default client_start_delay is set to three seconds, which is sufficient
 for up 8 game clients.
\end_layout

\begin_layout Standard
Note that pktgen does only support games with 4--32 clients.
 The smallest allowed number of clients is 4 and the largest allowed number
 of clients is 32.
\end_layout

\begin_layout Standard
Also note that for this method the unique ID is the first ID used.
 In total the number of IDs used is twice the number of clients.
 Each server-to-client pktgen will be assigned a consecutive ID number starting
 with the first ID.
 Each client-to-server pktgen will be assigned a consecutive ID number starting
 with an ID one higher than the highest server-to-client pktgen ID.
 If further traffic generators are specified after this generator, the user
 has to make sure there is no ID number clash.
\end_layout

\begin_layout Subsection
Mandatory experiment variables
\end_layout

\begin_layout Standard
\begin_inset CommandInset label
LatexCommand label
name "sub:Config-mandatory-vars"

\end_inset


\end_layout

\begin_layout Standard
We now describe the mandatory experiment variables that must be in every
 config file.
 There are two types: singulars and lists.
 Singulars are fixed parameters while lists specify the different values
 used in subsequent experiments based on the definitions of TPCONF_parameter_lis
t and TPCONF_vary_parameters (see below).
\end_layout

\begin_layout Subsubsection
Traffic duration
\end_layout

\begin_layout Standard
The duration of the traffic in seconds (must be an integer) is specified
 with TPCONF_duration.
 Note that currently the actual duration of an experiment is the number
 of seconds specified by TPCONF_duration 
\emph on
plus
\emph default
 the number of seconds until the last traffic generator is started (based
 on TPCONF_traffic_gens) plus some warmup time.
 TPCONF_duration is specified as follows:
\end_layout

\begin_layout Standard

\family typewriter
\size small
\begin_inset Box Frameless
position "t"
hor_pos "c"
has_inner_box 1
inner_pos "t"
use_parbox 0
use_makebox 0
width "97col%"
special "none"
height "1in"
height_special "totalheight"
status open

\begin_layout Plain Layout

\family typewriter
\size footnotesize
TPCONF_duration = 30
\end_layout

\end_inset


\end_layout

\begin_layout Subsubsection
Number of repeats (runs)
\end_layout

\begin_layout Standard
The number of repetitions (runs) carried out for each unique parameter combinati
on is specified with TPCONF_runs:
\end_layout

\begin_layout Standard

\family typewriter
\size small
\begin_inset Box Frameless
position "t"
hor_pos "c"
has_inner_box 1
inner_pos "t"
use_parbox 0
use_makebox 0
width "97col%"
special "none"
height "1in"
height_special "totalheight"
status open

\begin_layout Plain Layout

\family typewriter
\size footnotesize
TPCONF_runs = 1
\end_layout

\end_inset


\end_layout

\begin_layout Subsubsection
Enabling ECN on hosts
\end_layout

\begin_layout Standard
TPCONF_ECN specifies whether ECN is used on the hosts that are the traffic
 sources/sinks.
 If set to `1' ECN is enabled for all hosts.
 If set to `0' ECN is disabled for all hosts.
 Currently per-host configuration is only possible with custom commands.
\end_layout

\begin_layout Standard

\family typewriter
\size small
\begin_inset Box Frameless
position "t"
hor_pos "c"
has_inner_box 1
inner_pos "t"
use_parbox 0
use_makebox 0
width "97col%"
special "none"
height "1in"
height_special "totalheight"
status open

\begin_layout Plain Layout

\family typewriter
\size footnotesize
TPCONF_ECN = [ '0', '1' ]
\end_layout

\end_inset


\end_layout

\begin_layout Standard
(Note that TPCONF_ECN only enables ECN on the hosts.
 For full ECN support, the AQM mechanism on the router must also be configured
 to use ECN.)
\end_layout

\begin_layout Subsubsection
Congestion control algorithms
\end_layout

\begin_layout Standard
TPCONF_TCP_algos specifies the TCP congestion algorithms used.
 The following algorithms can be selected: `newreno', `cubic', `hd', `htcp',
 `cdg', `compound'.
 
\end_layout

\begin_layout Standard

\family typewriter
\size small
\begin_inset Box Frameless
position "t"
hor_pos "c"
has_inner_box 1
inner_pos "t"
use_parbox 0
use_makebox 0
width "97col%"
special "none"
height "1in"
height_special "totalheight"
status open

\begin_layout Plain Layout

\family typewriter
\size footnotesize
TPCONF_TCP_algos = [ 'newreno', 'cubic', ]
\end_layout

\end_inset


\end_layout

\begin_layout Standard
However, only some of these are supported depending on the OS a host is
 running: 
\end_layout

\begin_layout Itemize
Windows: newreno (default), compound;
\end_layout

\begin_layout Itemize
FreeBSD: newreno (default), cubic, hd, htcp, cdg;
\end_layout

\begin_layout Itemize
Linux: cubic (default), newreno, htcp;
\end_layout

\begin_layout Itemize
Mac OS X: newreno (default)
\end_layout

\begin_layout Standard
Instead of specifying a particular TCP algorithm one can specify `default'.
 This will set the algorithm to the default algorithm depending on the OS
 the host is running.
 
\end_layout

\begin_layout Standard
Using only TPCONF_TCP_algos one is limited to either using the same algorithm
 on all hosts or the defaults.
 To run different algorithms on different hosts, one can specify `host<N>'
 where <N> is an integer number starting from 0.
 The <N> refers to the Nth entry for each host in TPCONF_host_TCP_algos.
\end_layout

\begin_layout Standard
TPCONF_host_TCP_algos defines the TCP congestion control algorithms used
 for each host if the `host<N>' definitions are used in TPCONF_TCP_algos.
 In the following example a `host0' entry in TPCONF_TCP_algos will lead
 to each host using its default.
 A `host1' entry will configure testhost2 to use `newreno' and testhost3
 to use `cdg'.
 
\end_layout

\begin_layout Standard
\begin_inset listings
lstparams "basicstyle={\footnotesize\ttfamily}"
inline false
status open

\begin_layout Plain Layout

TPCONF_host_TCP_algos = { 
\end_layout

\begin_layout Plain Layout

'testhost2' : [ 'default', 'newreno', ], 
\end_layout

\begin_layout Plain Layout

'testhost3' : [ 'default', 'cdg', ], 
\end_layout

\begin_layout Plain Layout

}
\end_layout

\end_inset


\end_layout

\begin_layout Standard
With TPCONF_host_TCP_algo_params we can specify parameter settings for each
 host and TCP congestion control algorithm.
 The settings are passed directly to sysctl on the remote host.
 We can use V_variables to iterate over different settings (similar as for
 pipes and traffic generators) and these are replaced with the actual current
 value before passing the string to sysctl.
 For example, we can specify settings for CDG for host testhost2:
\end_layout

\begin_layout Standard
\begin_inset listings
lstparams "basicstyle={\footnotesize\ttfamily}"
inline false
status open

\begin_layout Plain Layout

TPCONF_host_TCP_algo_params = { 
\end_layout

\begin_layout Plain Layout

'testhost2' : { 'cdg' : [ 
\end_layout

\begin_layout Plain Layout

'net.inet.tcp.cc.cdg.beta_delay = V_cdgbdel', 
\end_layout

\begin_layout Plain Layout

'net.inet.tcp.cc.cdg.beta_loss = V_cdgbloss', 
\end_layout

\begin_layout Plain Layout

'net.inet.tcp.cc.cdg.exp_backoff_scale = 3', 
\end_layout

\begin_layout Plain Layout

'net.inet.tcp.cc.cdg.smoothing_factor = 8' ] 
\end_layout

\begin_layout Plain Layout

}}
\end_layout

\end_inset


\end_layout

\begin_layout Subsubsection
Emulated delays, loss rates and bottleneck bandwidths
\end_layout

\begin_layout Standard
TPCONF_delays specifies the emulated network delays in milliseconds.
 The numbers must be chosen from [0, max_delay).
 For most practical purposes the maximum delay max_delay is 10 seconds,
 although it could be more (if supported by the emulator).
 The following shows an example:
\end_layout

\begin_layout Standard

\family typewriter
\size small
\begin_inset Box Frameless
position "t"
hor_pos "c"
has_inner_box 1
inner_pos "t"
use_parbox 0
use_makebox 0
width "97col%"
special "none"
height "1in"
height_special "totalheight"
status open

\begin_layout Plain Layout

\family typewriter
\size footnotesize
TPCONF_delays = [ 0, 25, 50, 100 ]
\end_layout

\end_inset


\end_layout

\begin_layout Standard
TPCONF_loss_rates specifies the emulated network loss rates.
 The numbers must be between 0.0 and 1.0.
 The following shows an example:
\end_layout

\begin_layout Standard

\family typewriter
\size small
\begin_inset Box Frameless
position "t"
hor_pos "c"
has_inner_box 1
inner_pos "t"
use_parbox 0
use_makebox 0
width "97col%"
special "none"
height "1in"
height_special "totalheight"
status open

\begin_layout Plain Layout

\family typewriter
\size footnotesize
TPCONF_loss_rates = [ 0, 0.001, 0.01 ]
\end_layout

\end_inset


\end_layout

\begin_layout Standard
TPCONF_bandwidths specifies the emulated bandwidths as 2-tuples.
 The first value in each tuple is the downstream rate and the second value
 in each tuple is the upstream rate.
 Note that the values are passed through to the router queues and are not
 checked by TEACUP.
 Units can be used if the queue setup allows this, e.g.
 in the following example we use `mbit' to specify Mbit/second which Linux
 tc understands:
\end_layout

\begin_layout Standard
\begin_inset listings
lstparams "basicstyle={\footnotesize\ttfamily}"
inline false
status open

\begin_layout Plain Layout

TPCONF_bandwidths = [ 
\end_layout

\begin_layout Plain Layout

( '8mbit', '1mbit' ), 
\end_layout

\begin_layout Plain Layout

( '20mbit', '1.4mbit' ), 
\end_layout

\begin_layout Plain Layout

]
\end_layout

\end_inset


\end_layout

\begin_layout Subsubsection
Selection of bottleneck AQM and buffer sizes
\end_layout

\begin_layout Standard
TPCONF_aqms specifies the list of AQM/queuing techniques.
 This is completely dependent on the router OS.
 Linux supports `fifo' (mapped to `pfifo'), `pfifo', `bfifo', `fq_codel',
 `codel', `pie', `red' etc.
 (refer to the tc man page for the full list).
 FreeBSD support only `fifo' and `red'.
 Default on Linux and FreeBSD are FIFOs (with size in packets).
 The following shows an example:
\end_layout

\begin_layout Standard

\family typewriter
\size small
\begin_inset Box Frameless
position "t"
hor_pos "c"
has_inner_box 1
inner_pos "t"
use_parbox 0
use_makebox 0
width "97col%"
special "none"
height "1in"
height_special "totalheight"
status open

\begin_layout Plain Layout

\family typewriter
\size footnotesize
TPCONF_aqms = [ 'pfifo', 'fq_codel', 'pie' ]
\end_layout

\end_inset


\end_layout

\begin_layout Standard
Note that all underscores in parameter values used in log file names are
 changed to hyphens to allow for easier parsing of log file names.
 For example, `fq_codel' will become `fq-codel' in the file name.
\end_layout

\begin_layout Standard
TPCONF_buffer_sizes specifies the bottleneck buffer sizes.
 If the router is Linux this is mostly in packets/slots, but it depends
 on the AQM technique (e.g.
 for bfifo it is bytes).
 If the router is FreeBSD this would be in slots by default, but we can
 specify byte sizes (e.g.
 we can specify 4Kbytes).
 The following example for a Linux router would result in buffers of 100,
 200 and 600 packets long:
\end_layout

\begin_layout Standard

\family typewriter
\size small
\begin_inset Box Frameless
position "t"
hor_pos "c"
has_inner_box 1
inner_pos "t"
use_parbox 0
use_makebox 0
width "97col%"
special "none"
height "1in"
height_special "totalheight"
status open

\begin_layout Plain Layout

\family typewriter
\size footnotesize
TPCONF_buffer_sizes = [ 100, 200, 600 ]
\end_layout

\end_inset


\end_layout

\begin_layout Subsubsection
Specifying which parameters to vary
\end_layout

\begin_layout Standard
TPCONF_vary_parameters specifies a list of parameters to vary over a series
 of experiments, i.e.
 parameters that will take on multiple values.
 The listed parameters must be defined in 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
mbox{
\end_layout

\end_inset

TPCONF_parameter_list
\begin_inset ERT
status open

\begin_layout Plain Layout

}
\end_layout

\end_inset

 (see Section
\begin_inset space ~
\end_inset


\begin_inset CommandInset ref
LatexCommand ref
reference "sub:Config-defining-vars"

\end_inset

).
 The total number of experiments carried out is the number of unique parameter
 combinations (multiplied by the number of TPCONF_runs if `runs' is also
 specified in TPCONF_vary_parameters).
\end_layout

\begin_layout Standard
The TPCONF_vary_parameters specification also defines the order of the parameter
s in the log file names.
 While not strictly necessary, if used `runs' should be last in the list.
 If `runs' is not specified, there is a single experiment for each parameter
 combination.
 TPCONF_vary_parameters is only used for multiple experiments.
 When we run a single experiment (run_experiment_single) all the variables
 are set to fixed values based on TPCONF_variable_defaults.
 The following shows an example for parameters included in TPCONF_parameter_list
 in the example config files:
\end_layout

\begin_layout Standard
\begin_inset listings
lstparams "basicstyle={\footnotesize\ttfamily}"
inline false
status open

\begin_layout Plain Layout

TPCONF_vary_parameters = [ 
\end_layout

\begin_layout Plain Layout

	'tcpalgos', 'delays', 'loss', 
\end_layout

\begin_layout Plain Layout

	'bandwidths', 'aqms', 'bsizes', 
\end_layout

\begin_layout Plain Layout

	'runs', 
\end_layout

\begin_layout Plain Layout

]
\end_layout

\end_inset


\end_layout

\begin_layout Subsection
Experiment-specific variables
\end_layout

\begin_layout Standard
Some variables defined in the example config file(s) are only used with
 certain traffic generators.
\end_layout

\begin_layout Standard
TPCONF_dash_rates specifies the DASH content rates in kbit/second and TPCONF_das
h_rates_str is a string with a comma-separated list of rates (the latter
 is used by the content creation function create_http_dash_content).
 DASH rates must be integers.
 The following shows an example:
\end_layout

\begin_layout Standard
\begin_inset listings
lstparams "basicstyle={\footnotesize\ttfamily}"
inline false
status open

\begin_layout Plain Layout

TPCONF_dash_rates = [ 500, 1000, 2000 ] 
\end_layout

\begin_layout Plain Layout

TPCONF_dash_rates_str = ','.join(map(str, 
\end_layout

\begin_layout Plain Layout

		TPCONF_dash_rates))
\end_layout

\end_inset


\end_layout

\begin_layout Standard
TPCONF_inc_content_sizes specifies the content sizes in kB (as integer)
 for the replies sent in an incast scenario.
 TPCONF_inc_periods specifies the length of a period between requests by
 the querier in seconds (as floating point).
 The following shows an example:
\end_layout

\begin_layout Standard
\begin_inset listings
lstparams "basicstyle={\footnotesize\ttfamily}"
inline false
status open

\begin_layout Plain Layout

TPCONF_inc_content_sizes= '64, 512, 1024' 
\end_layout

\begin_layout Plain Layout

TPCONF_inc_periods = [ 10 ]
\end_layout

\end_inset


\end_layout

\begin_layout Subsection
Defining parameters to vary
\end_layout

\begin_layout Standard
\begin_inset CommandInset label
LatexCommand label
name "sub:Config-defining-vars"

\end_inset


\end_layout

\begin_layout Standard
TEACUP provides a flexible mechanism for defining what parameters are varied
 during experiments, what values (or ranges of values) those parameters
 may take, and how those parameters are then used to drive host, traffic
 generator and bottleneck configuration.
 TPCONF_parameter_list is a Python dictionary at the core of this mechanism.
\end_layout

\begin_layout Standard
The keys are names that can be used in TPCONF_vary_parameters.
 The values are 4-tuples.
 The first parameter of each tuple is a list of V_variables that can be
 used, for example in the queue configuration or traffic generator configuration.
 The second parameter of each tuple is a list of `short names' used in the
 file names of created log files.
 The third parameter of each tuple is the list of parameter values, these
 are usually references to the lists defined in the previous section.
 The last parameter is a dictionary of extra V_variables to set (this can
 be empty), where the keys are variable names and the values are the variable
 values.
 The length of the first three tuple parameters (V_variable identifiers,
 short names and V_variable values) must be equal.
\end_layout

\begin_layout Standard
When a series of experiments is started with `fab run_experiment_multiple'
 the following happens: For each parameter combination of the parameters
 defined in TPCONF_vary_parameters one experiment is run where the parameter
 settings are logged in the file name using the short names, and the V_
 variables are set to the parameter combination given by the value lists.
 
\end_layout

\begin_layout Standard
TPCONF_parameter_list can handle grouped V_variables, where in each experiment
 a specific combination of the grouped V_variables is used.
 An example of this is the parameter bandwidths which uses TPCONF_bandwidths
 as values.
\end_layout

\begin_layout Standard
TPCONF_variable_defaults is a dictionary that specifies the defaults for
 V_ variables.
 The keys are V_ variable names and the values are the default values (often
 the first value of the parameter lists).
 For each parameter that is not varied, the default value specified in TPCONF_va
riable_defaults is used.
 
\end_layout

\begin_layout Standard
We now discuss a simple example where we focus on the variables to vary
 delay and TCP algorithms.
 Assume we want to experiment with two delay settings and two different
 TCP CC algorithms.
 So we have:
\end_layout

\begin_layout Standard
\begin_inset listings
lstparams "basicstyle={\footnotesize\ttfamily}"
inline false
status open

\begin_layout Plain Layout

TPCONF_delays = [ 0, 50 ] 
\end_layout

\begin_layout Plain Layout

TPCONF_TCP_algos = [ 'newreno', 'cubic' ]
\end_layout

\end_inset


\end_layout

\begin_layout Standard
We also need to specify the two parameters to be varied and the default
 parameters for the variables as shown in Figure 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:Specify-vary-parameters"

\end_inset

.
\end_layout

\begin_layout Standard
\begin_inset Float figure
placement t
wide true
sideways false
status open

\begin_layout Plain Layout
\align center
\begin_inset listings
lstparams "basicstyle={\scriptsize\ttfamily}"
inline false
status open

\begin_layout Plain Layout

TPCONF_parameter_list = { 
\end_layout

\begin_layout Plain Layout

'delays'   : ( [ 'V_delay' ],       [ 'del' ], TPCONF_delays,    {} ), 
\end_layout

\begin_layout Plain Layout

'tcpalgos' : ( [ 'V_tcp_cc_algo' ], [ 'tcp' ], TPCONF_TCP_algos, {} ), 
\end_layout

\begin_layout Plain Layout

}
\end_layout

\begin_layout Plain Layout

TPCONF_variable_defaults {
\end_layout

\begin_layout Plain Layout

'V_delay'    : TPCONF_delays[0]',
\end_layout

\begin_layout Plain Layout

'V_tcp_algo' : TPCONF_TCP_algos[0],
\end_layout

\begin_layout Plain Layout

}
\end_layout

\begin_layout Plain Layout

TPCONF_vary_parameters = [ 'delays', 'tcpalgos' ]
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "fig:Specify-vary-parameters"

\end_inset

Specifying the parameters to be varied
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
V_delay can then be used in the router queue settings.
 V_tcp_cc_algo is passed to the host setup function.
 When we run `fab run_experiment_multiple' this will run the following experimen
ts, here represented by the start of the log file names (we assume the test
 ID prefix is the default from Section 
\begin_inset CommandInset ref
LatexCommand ref
reference "sub:Experiment-general-settings"

\end_inset

):
\end_layout

\begin_layout Standard
\begin_inset listings
lstparams "basicstyle={\footnotesize\ttfamily}"
inline false
status open

\begin_layout Plain Layout

20131206-170846_del_0_tcp_newreno 
\end_layout

\begin_layout Plain Layout

20131206-170846_del_0_tcp_cubic 
\end_layout

\begin_layout Plain Layout

20131206-170846_del_50_tcp_newreno 
\end_layout

\begin_layout Plain Layout

20131206-170846_del_50_tcp_cubic
\end_layout

\end_inset


\end_layout

\begin_layout Subsection
Adding new V_ variables
\end_layout

\begin_layout Standard
New V_variables are easy to add.
 Say we want to create a new V_variable called V_varx.
 We need to do the following:
\end_layout

\begin_layout Enumerate
Add a new list with parameter values, let's say TPCONF_varx = [ x, y ] 
\end_layout

\begin_layout Enumerate
Add one line in TPCONF_parameters_list: the key is the identifier that can
 be used in TPCONF_vary_parameters (let's call it varx_vals), and the value
 is a 4-tuple: variable name as string `V_varx', variable name used in file
 name (say `varx'), pointer to value list (here TPCONF_varx), and optionally
 a dictionary with related variables (here empty).
\end_layout

\begin_layout Enumerate
Add one line in TPCONF_variable_defaults specifying the default value used
 (when not iterating over the variable): the key is the V_variable name
 as string (here `V_varx') and the value is the default value from TPCONF_varx
 (say 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
mbox{
\end_layout

\end_inset

TPCONF_varx[0]
\begin_inset ERT
status open

\begin_layout Plain Layout

}
\end_layout

\end_inset

).
\end_layout

\begin_layout Standard
Technically, step 1 is not necessary as the list of values can be put directly
 in TPCONF_parameters_list and the default value can be put directly in
 TPCONF_variable_defaults.
 However, defining a separate list improves the readability.
\end_layout

\begin_layout Section
Running Experiments
\end_layout

\begin_layout Standard
\begin_inset CommandInset label
LatexCommand label
name "sec:Running"

\end_inset


\end_layout

\begin_layout Standard
This section describes how to run experiments.
 First, we describe the initial steps needed.
 Then we outline a simple example config file.
 Finally, we describe how to run the experiments.
\end_layout

\begin_layout Subsection
Initial steps
\end_layout

\begin_layout Standard
First you should create a new directory for the experiment or series of
 experiments.
 Copy the files fabfile.py and run.sh (and run_resume.sh) from the TEACUP distribut
ion into that new directory.
 Then create a config.py file in the directory.
 An easy way to get a config.py file is to start with one of the provided
 example config files as basis and modify it as necessary.
\end_layout

\begin_layout Subsection
Example config
\end_layout

\begin_layout Standard
Listing 
\begin_inset CommandInset ref
LatexCommand ref
reference "lis:Example-config"

\end_inset

 shows a minimal but complete config.py file.
 The testbed consists of three machines, two hosts (192.168.1.2, 192.168.1.3)
 connected by a router (192.168.1.4).
 The two hosts will run FreeBSD for the experiment, while the router will
 run Linux.
 On the router we configure two pipes, one in each direction, with different
 rates but the same AQM mechanism, buffer size, and emulated delay and loss.
 The test traffic consists of two parallel TCP sessions generated with iperf,
 both start at the start of the experiment (time 0.0).
 With iperf the client sends data to the server, so the data is sent from
 192.168.1.2 to 192.168.1.3.
 Each experiment lasts 30 seconds and we run a series of experiments varying
 the TCP congestion control algorithm, network delay and loss, upstream
 and downstream bandwidths, AQM technique, and buffer size.
 There is one experiment for each combination of parameters (one run).
\end_layout

\begin_layout Standard
\begin_inset listings
lstparams "basicstyle={\tiny\ttfamily},captionpos=b,float={*p}"
inline false
status open

\begin_layout Plain Layout

import sys 
\end_layout

\begin_layout Plain Layout

import datetime 
\end_layout

\begin_layout Plain Layout

from fabric.api import env
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

env.user = 'root' 
\end_layout

\begin_layout Plain Layout

env.password = 'password'
\end_layout

\begin_layout Plain Layout

env.shell = '/bin/sh -c'
\end_layout

\begin_layout Plain Layout

env.timeout = 5
\end_layout

\begin_layout Plain Layout

env.pool_size = 10 
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

TPCONF_script_path = '/home/test/src/teacup'
\end_layout

\begin_layout Plain Layout

sys.path.append(TPCONF_script_path)
\end_layout

\begin_layout Plain Layout

TPCONF_tftpboot_dir = '/tftpboot'
\end_layout

\begin_layout Plain Layout

TPCONF_router = [ '192.168.1.4', ] 
\end_layout

\begin_layout Plain Layout

TPCONF_hosts = [ '192.168.1.2', '192.168.1.3', ]
\end_layout

\begin_layout Plain Layout

TPCONF_host_internal_ip = { 
\end_layout

\begin_layout Plain Layout

'192.168.1.4' : [ '172.16.10.1', '172.16.11.1' ], 
\end_layout

\begin_layout Plain Layout

'192.168.1.2' : [ '172.16.10.2' ], 
\end_layout

\begin_layout Plain Layout

'192.168.1.3' : [ '172.16.11.2' ], }
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

now = datetime.datetime.today() 
\end_layout

\begin_layout Plain Layout

TPCONF_test_id = now.strftime("%Y%m%d-%H%M%S") + '_experiment' 
\end_layout

\begin_layout Plain Layout

TPCONF_remote_dir = '/tmp/'
\end_layout

\begin_layout Plain Layout

TPCONF_host_os = { 
\end_layout

\begin_layout Plain Layout

'192.168.1.4' : 'Linux', 
\end_layout

\begin_layout Plain Layout

'192.168.1.2' : 'FreeBSD', 
\end_layout

\begin_layout Plain Layout

'192.168.1.3' : 'FreeBSD', }
\end_layout

\begin_layout Plain Layout

TPCONF_linux_kern_router = '3.14.18-10000hz'
\end_layout

\begin_layout Plain Layout

TPCONF_force_reboot = '1' 
\end_layout

\begin_layout Plain Layout

TPCONF_boot_timeout = 100
\end_layout

\begin_layout Plain Layout

TPCONF_do_power_cycle = '0'
\end_layout

\begin_layout Plain Layout

TPCONF_host_power_ctrlport = {}
\end_layout

\begin_layout Plain Layout

TPCONF_power_admin_name = ''
\end_layout

\begin_layout Plain Layout

TPCONF_power_admin_pw = '' 
\end_layout

\begin_layout Plain Layout

TPCONF_max_time_diff = 1
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

TPCONF_router_queues = [ 
\end_layout

\begin_layout Plain Layout

( '1', "source='172.16.10.0/24', dest='172.16.11.0/24', delay=V_delay, loss=V_loss,
 rate=V_urate, queue_disc=V_aqm, queue_size=V_bsize" ), 
\end_layout

\begin_layout Plain Layout

( '2', "source='172.16.11.0/24', dest='172.16.10.0/24', delay=V_delay, loss=V_loss,
 rate=V_drate, queue_disc=V_aqm, queue_size=V_bsize" ), ]
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

traffic_iperf = [ 
\end_layout

\begin_layout Plain Layout

( '0.0', '1', "start_iperf, client='192.168.1.2', server='192.168.1.3', port=5000,
 duration=V_duration" ), 
\end_layout

\begin_layout Plain Layout

( '0.0', '2', "start_iperf, client='192.168.1.2', server='192.168.1.3', port=5001,
 duration=V_duration" ), ]
\end_layout

\begin_layout Plain Layout

TPCONF_traffic_gens = traffic_iperf;
\end_layout

\begin_layout Plain Layout

 
\end_layout

\begin_layout Plain Layout

TPCONF_duration = 30
\end_layout

\begin_layout Plain Layout

TPCONF_runs = 1
\end_layout

\begin_layout Plain Layout

TPCONF_ECN = [ '0', '1' ]
\end_layout

\begin_layout Plain Layout

TPCONF_TCP_algos = [ 'newreno', 'cubic', 'htcp', ]
\end_layout

\begin_layout Plain Layout

TPCONF_host_TCP_algos = { }
\end_layout

\begin_layout Plain Layout

TPCONF_host_TCP_algo_params = { }
\end_layout

\begin_layout Plain Layout

TPCONF_host_init_custom_cmds = { }
\end_layout

\begin_layout Plain Layout

TPCONF_delays = [ 0, 25, 50, 100 ]
\end_layout

\begin_layout Plain Layout

TPCONF_loss_rates = [ 0, 0.001, 0.01 ] 
\end_layout

\begin_layout Plain Layout

TPCONF_bandwidths = [ ( '8mbit', '1mbit' ), ( '20mbit', '1.4mbit' ), ]
\end_layout

\begin_layout Plain Layout

TPCONF_aqms = [ 'pfifo', 'codel', 'pie' ]
\end_layout

\begin_layout Plain Layout

TPCONF_buffer_sizes = [ 1000, 1 ]
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

TPCONF_parameter_list = { 
\end_layout

\begin_layout Plain Layout

'delays' : ( [ 'V_delay' ], [ 'del' ], TPCONF_delays, {} ), 
\end_layout

\begin_layout Plain Layout

'loss' : ( [ 'V_loss' ], [ 'loss' ], TPCONF_loss_rates, {} ), 
\end_layout

\begin_layout Plain Layout

'tcpalgos' : ( [ 'V_tcp_cc_algo' ], [ 'tcp' ], TPCONF_TCP_algos, {} ), 
\end_layout

\begin_layout Plain Layout

'aqms' : ( [ 'V_aqm' ], [ 'aqm' ], TPCONF_aqms, {} ), 
\end_layout

\begin_layout Plain Layout

'bsizes' : ( [ 'V_bsize' ], [ 'bs' ], TPCONF_buffer_sizes, {} ), 
\end_layout

\begin_layout Plain Layout

'runs' : ( [ 'V_runs' ], [ 'run' ], range(TPCONF_runs), {} ), 
\end_layout

\begin_layout Plain Layout

'bandwidths' : ( [ 'V_drate', 'V_urate' ], [ 'down', 'up' ], TPCONF_bandwidths,
 {} ), }
\end_layout

\begin_layout Plain Layout

TPCONF_variable_defaults = { 
\end_layout

\begin_layout Plain Layout

'V_ecn' : TPCONF_ECN[0], 
\end_layout

\begin_layout Plain Layout

'V_duration' : TPCONF_duration, 
\end_layout

\begin_layout Plain Layout

'V_delay' : TPCONF_delays[0], 
\end_layout

\begin_layout Plain Layout

'V_loss' : TPCONF_loss_rates[0], 
\end_layout

\begin_layout Plain Layout

'V_tcp_cc_algo' : TPCONF_TCP_algos[0], 
\end_layout

\begin_layout Plain Layout

'V_drate' : TPCONF_bandwidths[0][0], 
\end_layout

\begin_layout Plain Layout

'V_urate' : TPCONF_bandwidths[0][1], 
\end_layout

\begin_layout Plain Layout

'V_aqm' : TPCONF_aqms[0], 
\end_layout

\begin_layout Plain Layout

'V_bsize' : TPCONF_buffer_sizes[0], }
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

TPCONF_variable_defaults TPCONF_vary_parameters = [ 'tcpalgos', 'delays',
 'loss', 'bandwidths', 'aqms', 'bsizes', 'runs', ] 
\end_layout

\begin_layout Plain Layout

\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "lis:Example-config"

\end_inset

Example config.py file
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Subsection
Running experiments
\end_layout

\begin_layout Standard
There are two Fabric tasks to start experiments: 
\emph on
run_experiment_single
\emph default
 and 
\emph on
run_experiment_multiple
\emph default
.
\end_layout

\begin_layout Standard
To run a single experiment with the default test ID prefix TPCONF_test_id,
 type:
\end_layout

\begin_layout Standard
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
noindent 
\backslash
colorbox{lightgray}{
\end_layout

\end_inset


\family typewriter
\size small

\begin_inset Box Frameless
position "t"
hor_pos "c"
has_inner_box 1
inner_pos "t"
use_parbox 0
use_makebox 0
width "97col%"
special "none"
height "1in"
height_special "totalheight"
status open

\begin_layout Plain Layout

\family typewriter
\size footnotesize
> fab run_experiment_single
\end_layout

\end_inset


\begin_inset ERT
status open

\begin_layout Plain Layout

}
\end_layout

\end_inset


\end_layout

\begin_layout Standard
To run a series of experiment based on the TPCONF_vary_parameters settings
 with the default test ID prefix TPCONF_test_id, type:
\end_layout

\begin_layout Standard
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
noindent 
\backslash
colorbox{lightgray}{
\end_layout

\end_inset


\family typewriter
\size small

\begin_inset Box Frameless
position "t"
hor_pos "c"
has_inner_box 1
inner_pos "t"
use_parbox 0
use_makebox 0
width "97col%"
special "none"
height "1in"
height_special "totalheight"
status open

\begin_layout Plain Layout

\family typewriter
\size footnotesize
> fab run_experiment_multiple
\end_layout

\end_inset


\begin_inset ERT
status open

\begin_layout Plain Layout

}
\end_layout

\end_inset


\end_layout

\begin_layout Standard
In both cases the Fabric log output will be printed out on the current terminal
 (stdout) and can be redirected with the usual means.
 The default test ID prefix (TPCONF_test_id) is specified in the config
 file.
 However, the test ID prefix can also be specified on the command line (overruli
ng the config setting):
\end_layout

\begin_layout Standard
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
noindent 
\backslash
colorbox{lightgray}{
\end_layout

\end_inset


\family typewriter
\size small

\begin_inset Box Frameless
position "t"
hor_pos "c"
has_inner_box 1
inner_pos "t"
use_parbox 0
use_makebox 0
width "97col%"
special "none"
height "1in"
height_special "totalheight"
status open

\begin_layout Plain Layout

\family typewriter
\size footnotesize
> fab run_experiment_multiple:test_id=`date +"%Y%m%d-%H%M%S"`
\end_layout

\end_inset


\begin_inset ERT
status open

\begin_layout Plain Layout

}
\end_layout

\end_inset


\end_layout

\begin_layout Standard
The last command will run a series of experiments where the test ID prefix
 is YYYYMMDD-HHMMSS, using the actual date when the fab command is run.
 For convenience TEACUP provides a shell script (
\family typewriter
\size small
run.sh
\family default
\size default
) that logs the Fabric output in a <test_ID_prefix>.log file inside the <test_ID_
prefix> sub directory, and is started with:
\end_layout

\begin_layout Standard
\align left
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
noindent 
\backslash
colorbox{lightgray}{
\end_layout

\end_inset


\family typewriter
\size small

\begin_inset Box Frameless
position "t"
hor_pos "c"
has_inner_box 1
inner_pos "t"
use_parbox 0
use_makebox 0
width "97col%"
special "none"
height "1in"
height_special "totalheight"
status open

\begin_layout Plain Layout

\family typewriter
\size footnotesize
> run.sh
\end_layout

\end_inset


\begin_inset ERT
status open

\begin_layout Plain Layout

}
\end_layout

\end_inset


\end_layout

\begin_layout Standard
The shell script generates a test ID prefix and then executes the command:
\end_layout

\begin_layout Standard
\align left
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
noindent 
\backslash
colorbox{lightgray}{
\end_layout

\end_inset


\family typewriter
\size small

\begin_inset Box Frameless
position "t"
hor_pos "c"
has_inner_box 1
inner_pos "t"
use_parbox 0
use_makebox 0
width "97col%"
special "none"
height "1in"
height_special "totalheight"
status open

\begin_layout Plain Layout

\family typewriter
\size footnotesize
> fab run_experiment_multiple:test_id= <test_ID_pfx> > <test_ID_pfx>.log
 2>&1
\end_layout

\end_inset


\begin_inset ERT
status open

\begin_layout Plain Layout

}
\end_layout

\end_inset


\end_layout

\begin_layout Standard
The test ID prefix is set to 
\family typewriter
\size small
`date +"%Y%m%d-%H%M%S"`_experiment
\family default
\size default
.
 The output is unbuffered, so one can use 
\family typewriter
\size small
tail -f
\family default
\size default
 on the log file and get timely output.
 The fabfile to be used can be specified, i.e.
 to use the fabfile 
\family typewriter
\size small
myfabfile.py
\family default
\size default
 instead of 
\family typewriter
\size small
fabfile.py
\family default
\size default
 run:
\end_layout

\begin_layout Standard
\align left
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
noindent 
\backslash
colorbox{lightgray}{
\end_layout

\end_inset


\family typewriter
\size small

\begin_inset Box Frameless
position "t"
hor_pos "c"
has_inner_box 1
inner_pos "t"
use_parbox 0
use_makebox 0
width "97col%"
special "none"
height "1in"
height_special "totalheight"
status open

\begin_layout Plain Layout

\family typewriter
\size footnotesize
> run.sh myfabfile.py
\end_layout

\end_inset


\begin_inset ERT
status open

\begin_layout Plain Layout

}
\end_layout

\end_inset


\end_layout

\begin_layout Standard
TEACUP keeps track of experiments using two files in the current directory:
\end_layout

\begin_layout Itemize
The file 
\family typewriter
\size small
experiment_started.txt
\family default
\size default
 logs the test IDs of all experiments started.
\end_layout

\begin_layout Itemize
The file 
\family typewriter
\size small
experiment_completed.txt
\family default
\size default
 logs the test IDs of all experiments 
\emph on
successfully completed
\emph default
.
\end_layout

\begin_layout Standard
Note that TEACUP never resets either of these files -- new test IDs are
 simply appended to the files (which are created if they don't already exist).
\begin_inset Foot
status open

\begin_layout Plain Layout
The user must manually delete or edit these files if actual experiment results
 are later deleted.
\end_layout

\end_inset


\end_layout

\begin_layout Standard
A run_experiment_multiple task that was interrupted part-way through may
 be restarted with the 
\family typewriter
\size small
resume
\family default
\size default
 parameter.
 TEACUP will perform all experiments of the series that were not previously
 completed (not logged in 
\family typewriter
\size small
experiments_completed.txt
\family default
\size default
).
 
\end_layout

\begin_layout Standard
For example, the following command resumes a series of experiments with
 test ID prefix 
\family typewriter
\size small
20131218-113431_windows
\family default
\size default
 (and appends the log output to the existing log file):
\end_layout

\begin_layout Standard
\align left
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
noindent 
\backslash
colorbox{lightgray}{
\end_layout

\end_inset


\family typewriter
\size small

\begin_inset Box Frameless
position "t"
hor_pos "c"
has_inner_box 1
inner_pos "t"
use_parbox 0
use_makebox 0
width "97col%"
special "none"
height "1in"
height_special "totalheight"
status open

\begin_layout Plain Layout

\family typewriter
\size footnotesize
> fab run_experiment_multiple: test_id=20131218-113431_windows,resume=1
 >> 20131218-113431_windows.log 2>&1
\end_layout

\end_inset


\begin_inset ERT
status open

\begin_layout Plain Layout

}
\end_layout

\end_inset


\end_layout

\begin_layout Standard
The 
\family typewriter
\size small
resume
\family default
\size default
 parameter also enables redoing of previously completed experiments, by
 first editing them out of 
\family typewriter
\size small
experiments_completed.txt.
\end_layout

\begin_layout Standard
If a series of experiments is interrupted by non-deterministic errors, i.e.
 each experiment may fail with some small probability, the 
\family typewriter
\size small
run_resume.sh
\family default
\size default
 shell script can be used to ensure the whole series of experiments is completed.
 The script runs the experiments using the run_experiment_multiple task
 and uses the
\family typewriter
\size small
 resume
\family default
\size default
 option to automatically restart and continue each time an experiment was
 not successfully completed.
 The script is used by executing:
\end_layout

\begin_layout Standard
\align left
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
noindent 
\backslash
colorbox{lightgray}{
\end_layout

\end_inset


\family typewriter
\size small

\begin_inset Box Frameless
position "t"
hor_pos "c"
has_inner_box 1
inner_pos "t"
use_parbox 0
use_makebox 0
width "97col%"
special "none"
height "1in"
height_special "totalheight"
status open

\begin_layout Plain Layout

\family typewriter
\size footnotesize
> run_resume.sh
\end_layout

\end_inset


\begin_inset ERT
status open

\begin_layout Plain Layout

}
\end_layout

\end_inset


\end_layout

\begin_layout Subsection
TEACUP variable information logged
\end_layout

\begin_layout Standard
\begin_inset CommandInset label
LatexCommand label
name "sub:variables_logged"

\end_inset


\end_layout

\begin_layout Standard
TEACUP logs configuration information for conducted experiments in two files.
 In the following <test_id> is a test ID and <test_id_pfx> is the corresponding
 test ID prefix.
 For each experiment, TEACUP logs all V_ variables and their values (in
 alphabetical order of variable names) in a file <test_id>_config_vars.log.gz.
 The following is an example (with header and legend lines omitted for brevity):
\begin_inset listings
lstparams "basicstyle={\footnotesize\ttfamily}"
inline false
status open

\begin_layout Plain Layout

U V_aqm: pfifo
\end_layout

\begin_layout Plain Layout

U V_bsize: 1000
\end_layout

\begin_layout Plain Layout

U V_delay: 100
\end_layout

\end_inset


\end_layout

\begin_layout Standard
Each line starts with an `U' or an `N' indicating whether a variable is
 Used or Not used.
 After the use indicator follows the variable name and the value the variable
 was set to in the particular experiment.
\end_layout

\begin_layout Standard
TEACUP also logs all varying parameters for a series of experiments in a
 file named <test_id_pfx>_varying_params.log.gz.
 The following shows a file as example (excluding the header line):
\begin_inset listings
lstparams "basicstyle={\footnotesize\ttfamily}"
inline false
status open

\begin_layout Plain Layout

V_aqm aqm aqms
\end_layout

\begin_layout Plain Layout

V_bsize bs bsizes
\end_layout

\begin_layout Plain Layout

V_delay del delays
\end_layout

\end_inset


\end_layout

\begin_layout Standard
In each line, the first column is the V_ variable name, the second column
 is the short name used in the test ID (in the file names), and the last
 column is the identifier that is used in TPCONF_vary_parameters (and links
 to an entry in TPCONF_parameter_list).
\end_layout

\begin_layout Section
Host Control Utility Functions
\end_layout

\begin_layout Standard
\begin_inset CommandInset label
LatexCommand label
name "sec:Utility"

\end_inset


\end_layout

\begin_layout Standard
This section describes a number of utility functions available as Fabric
 tasks.
 As mentioned previously, the fab utility has an option to list all available
 tasks:
\end_layout

\begin_layout Standard
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
noindent 
\backslash
colorbox{lightgray}{
\end_layout

\end_inset


\family typewriter
\size small

\begin_inset Box Frameless
position "t"
hor_pos "c"
has_inner_box 1
inner_pos "t"
use_parbox 0
use_makebox 0
width "98col%"
special "none"
height "1in"
height_special "totalheight"
status open

\begin_layout Plain Layout

\family typewriter
\size footnotesize
> fab -l
\end_layout

\end_inset


\begin_inset ERT
status open

\begin_layout Plain Layout

}
\end_layout

\end_inset


\end_layout

\begin_layout Subsection
Remote command execution
\end_layout

\begin_layout Standard
The exec_cmd task can be used to execute one command on one or more testbed
 hosts.
 For example, the following command executes the command 
\family typewriter
\size footnotesize
uname -s
\family default
\size default
 on a number of hosts:
\end_layout

\begin_layout Standard
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
noindent 
\backslash
colorbox{lightgray}{
\end_layout

\end_inset


\family typewriter
\size small

\begin_inset Box Frameless
position "t"
hor_pos "c"
has_inner_box 1
inner_pos "t"
use_parbox 0
use_makebox 0
width "98col%"
special "none"
height "1in"
height_special "totalheight"
status open

\begin_layout Plain Layout

\family typewriter
\size footnotesize
> fab -H 
\size small
testhost
\size footnotesize
1,testhost2,testhost3 exec_cmd:cmd="uname -s"
\end_layout

\end_inset


\begin_inset ERT
status open

\begin_layout Plain Layout

}
\end_layout

\end_inset


\end_layout

\begin_layout Standard
If no hosts are specified on the command line, the exec_cmd command is executed
 on all hosts listed in the config file (the union set of TPCONF_router
 and TPCONF_hosts).
 For example, the following command is executed on all testbed hosts:
\end_layout

\begin_layout Standard
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
noindent 
\backslash
colorbox{lightgray}{
\end_layout

\end_inset


\family typewriter
\size small

\begin_inset Box Frameless
position "t"
hor_pos "c"
has_inner_box 1
inner_pos "t"
use_parbox 0
use_makebox 0
width "98col%"
special "none"
height "1in"
height_special "totalheight"
status open

\begin_layout Plain Layout

\family typewriter
\size footnotesize
> fab exec_cmd:cmd="uname -s"
\end_layout

\end_inset


\begin_inset ERT
status open

\begin_layout Plain Layout

}
\end_layout

\end_inset


\end_layout

\begin_layout Subsection
Copying files to testbed hosts
\end_layout

\begin_layout Standard
The copy_file task can be used to copy a local file to one or more testbed
 hosts.
 For example, the following command copies the web10g-logger executable
 to all testbed hosts except the router (this assumes all the hosts run
 Linux when the command is executed):
\end_layout

\begin_layout Standard
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
noindent 
\backslash
colorbox{lightgray}{
\end_layout

\end_inset


\family typewriter
\size small

\begin_inset Box Frameless
position "t"
hor_pos "c"
has_inner_box 1
inner_pos "t"
use_parbox 0
use_makebox 0
width "98col%"
special "none"
height "1in"
height_special "totalheight"
status open

\begin_layout Plain Layout

\family typewriter
\size footnotesize
> fab -H testhost2,testhost3 copy_file:file_name=/usr/bin/web10g-logger,
 remote_path=/usr/bin
\end_layout

\end_inset


\begin_inset ERT
status open

\begin_layout Plain Layout

}
\end_layout

\end_inset


\end_layout

\begin_layout Standard
If no hosts are specified on the command line, the command is executed for
 all hosts listed in the config file (the union set of TPCONF_router and
 TPCONF_hosts).
 For example, the following command copies the file to all testbed hosts:
\end_layout

\begin_layout Standard
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
noindent 
\backslash
colorbox{lightgray}{
\end_layout

\end_inset


\family typewriter
\size small

\begin_inset Box Frameless
position "t"
hor_pos "c"
has_inner_box 1
inner_pos "t"
use_parbox 0
use_makebox 0
width "98col%"
special "none"
height "1in"
height_special "totalheight"
status open

\begin_layout Plain Layout

\family typewriter
\size footnotesize
> fab copy_file:file_name= /usr/bin/web10g-logger,remote_path=/usr/bin
\end_layout

\end_inset


\begin_inset ERT
status open

\begin_layout Plain Layout

}
\end_layout

\end_inset


\end_layout

\begin_layout Standard
The parameter 
\family typewriter
\size footnotesize
method
\family default
\size default
 controls the method used for copying.
 By default (
\family typewriter
\size footnotesize
method='put'
\family default
\size default
) copy_file will use the Fabric put function to copy the file.
 However, the Fabric put function is slow.
 For large files setting
\family typewriter
\size footnotesize
 method='scp'
\family default
\size default
 provides much better performance using the scp command.
 While scp is faster, it may prompt for the password if public key authenticatio
n has not been configured.
\end_layout

\begin_layout Subsection
Installing ssh keys
\end_layout

\begin_layout Standard
The authorize_key task can be used to append the current user's public SSH
 key to the ~./ssh/authorized_keys file of the remote user.
 The user can then login via SSH without having to enter a password.
 For example, the following command enables password-less access for the
 user on three testbed hosts:
\end_layout

\begin_layout Standard
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
noindent 
\backslash
colorbox{lightgray}{
\end_layout

\end_inset


\family typewriter
\size small

\begin_inset Box Frameless
position "t"
hor_pos "c"
has_inner_box 1
inner_pos "t"
use_parbox 0
use_makebox 0
width "98col%"
special "none"
height "1in"
height_special "totalheight"
status open

\begin_layout Plain Layout

\family typewriter
\size footnotesize
> fab -H 
\size small
testhost
\size footnotesize
1,testhost2,testhost3 authorize_key
\end_layout

\end_inset


\begin_inset ERT
status open

\begin_layout Plain Layout

}
\end_layout

\end_inset


\end_layout

\begin_layout Standard
Note: the authorize_key task assumes the user has a ~/.ssh/id_rsa.pub key
 file.
 This can be created with 
\family typewriter
\size footnotesize
ssh-keygen -t rsa.

\family default
\size default
 Also note that the task does not check if the public key is already in
 the remote user's authorized_keys file, so executing this task multiple
 times may lead to duplicate entries in the remote user's authorized_keys
 file.
\end_layout

\begin_layout Subsection
Topology configuration
\end_layout

\begin_layout Standard
Where the testbed meets the requirements described in Section 
\begin_inset CommandInset ref
LatexCommand ref
reference "sub:topology_config"

\end_inset

, the init_topology task can be used to 
\begin_inset Quotes eld
\end_inset

move
\begin_inset Quotes erd
\end_inset

 hosts from one test subnet to the other by configuring the VLAN membership
 of the switch ports in conjunction with IP addresses and static routes
 on each host.
 The task uses the config.py file to get the testbed IP addresses of the
 hosts to be configured (from TPCONF_host_internal_ip).
 It also uses the values of TPCONF_topology_switch, TPCONF_topology_switch_port_
prefix, and TPCONF_topology_switch_port_offset specified in config.py to
 reconfigure the switch.
 The last three parameters can also be overridden by the task's parameters
 
\family typewriter
\size small
switch
\family default
\size default
, 
\family typewriter
\size small
port_prefix
\family default
\size default
, and 
\family typewriter
\size small
port_offset
\family default
\size default
.
 Limitations of the current implementation are described in Section 
\begin_inset CommandInset ref
LatexCommand ref
reference "sub:topology_config"

\end_inset

.
\end_layout

\begin_layout Standard
The following shows an example where we configure the hosts testhost1 and
 testhost2 using the task's parameters to specify the switch-relevant settings:
\end_layout

\begin_layout Standard
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
noindent 
\backslash
colorbox{lightgray}{
\end_layout

\end_inset


\family typewriter
\size small

\begin_inset Box Frameless
position "t"
hor_pos "c"
has_inner_box 1
inner_pos "t"
use_parbox 0
use_makebox 0
width "98col%"
special "none"
height "1in"
height_special "totalheight"
status open

\begin_layout Plain Layout

\family typewriter
\size footnotesize
> fab -H testhost1,testhost2 init_topology:switch="switch2", port_prefix="Gi1/0/
",port_offset="5"
\end_layout

\end_inset


\begin_inset ERT
status open

\begin_layout Plain Layout

}
\end_layout

\end_inset


\end_layout

\begin_layout Subsection
Initialise hosts to a specific operating system
\end_layout

\begin_layout Standard
The init_os task can be used to reboot hosts into specific operating systems
 (OSs).
 For example, the following command reboots the hosts testhost1 and testhost2
 into the OSs Linux and FreeBSD respectively:
\end_layout

\begin_layout Standard
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
noindent 
\backslash
colorbox{lightgray}{
\end_layout

\end_inset


\family typewriter
\size small

\begin_inset Box Frameless
position "t"
hor_pos "c"
has_inner_box 1
inner_pos "t"
use_parbox 0
use_makebox 0
width "98col%"
special "none"
height "1in"
height_special "totalheight"
status open

\begin_layout Plain Layout

\family typewriter
\size footnotesize
> fab -H testhost1,testhost2 init_os:os_list="Linux
\backslash
,FreeBSD", force_reboot=1
\end_layout

\end_inset


\begin_inset ERT
status open

\begin_layout Plain Layout

}
\end_layout

\end_inset


\end_layout

\begin_layout Standard
Note that the commas in 
\family typewriter
\size small
os_list
\family default
\size default
 need to be escaped with backslashes (
\backslash
), since otherwise Fabric interprets the commas as parameter delimiters.
 Note that 
\family typewriter
\size small
os_list
\family default
\size default
 can be shorter than the number of specified hosts, in which case it will
 be padded to the length of the number of hosts by duplicating the last
 entry.
 This allows to reboot a large number of hosts into the same OS while specifying
 an
\family typewriter
\size small
 os_list
\family default
\size default
 with only a single entry (the desired OS).
\end_layout

\begin_layout Standard
For Linux the kernel to boot can be chosen with the parameters 
\family typewriter
\size small
linux_kern_hosts
\family default
\size default
 and 
\family typewriter
\size small
linux_kern_router
\family default
\size default
.
 
\family typewriter
\size small
linux_kern_hosts
\family default
\size default
 specifies the kernel for normal hosts (not routers) and 
\family typewriter
\size small
linux_kern_router
\family default
\size default
 specifies the kernel for routers.
 Please refer to the description in Section 
\begin_inset CommandInset ref
LatexCommand ref
reference "sub:os_kernel_selection"

\end_inset

 on how to specify the kernel name.
\end_layout

\begin_layout Standard
By default 
\family typewriter
\size small
force_reboot
\family default
\size default
 is 0, which means hosts that are already running the desired OS are not
 rebooted.
 Setting 
\family typewriter
\size small
force_reboot
\family default
\size default
 to 1 enforces a reboot.
 By default the script waits 100 seconds for a host to reboot.
 If the host is not responsive after this time, the script will give up
 unless the 
\family typewriter
\size small
do_power_cycle
\family default
\size default
 parameter is set to 1.
 This timeout can be changed with the 
\family typewriter
\size small
boot_timeout
\family default
\size default
 parameter, which specifies the timeout in seconds (as integer).
 A minimum boot timeout of 60 seconds will be enforced.
\end_layout

\begin_layout Standard
The 
\family typewriter
\size small
do_power_cycle
\family default
\size default
 parameter can be set to 1 to force a power cycle if a host does not respond
 after the boot timeout (assuming TEACUP-compatible power controller(s)
 are configured).
 The script will then wait for 
\family typewriter
\size small
boot_timeout
\family default
\size default
 seconds again for the host to come up.
 If the host is still unresponsive after the timeout the script will give
 up (there are no further automatic power cycles).
 The following command shows an example with 
\family typewriter
\size small
do_power_cycle
\family default
\size default
 set to 1:
\end_layout

\begin_layout Standard
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
noindent 
\backslash
colorbox{lightgray}{
\end_layout

\end_inset


\family typewriter
\size small

\begin_inset Box Frameless
position "t"
hor_pos "c"
has_inner_box 1
inner_pos "t"
use_parbox 0
use_makebox 0
width "98col%"
special "none"
height "1in"
height_special "totalheight"
status open

\begin_layout Plain Layout

\family typewriter
\size footnotesize
> fab -H testhost1,testhost2 init_os:os_list="Linux
\backslash
,FreeBSD", force_reboot=1,do_power_cycle=1
\end_layout

\end_inset


\begin_inset ERT
status open

\begin_layout Plain Layout

}
\end_layout

\end_inset


\end_layout

\begin_layout Standard
Since version 0.9.3 TEACUP can reboot unresponsive hosts (i.e.
 hosts to which TEACUP cannot establish an SSH connection), if the user
 specifies the MAC addresses of the control interface and a power controller
 is configured for the hosts.
 The MAC address(es) are specified with the 
\family typewriter
\size small
mac_list
\family default
\size default
 parameter (comma-separated list of MAC addresses, one for each host to
 be rebooted).
\end_layout

\begin_layout Standard
The following command shows an example of rebooting the unresposive host
 testhost1 (with control network interface MAC of 01:02:03:04:05:06) into
 Linux:
\end_layout

\begin_layout Standard
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
noindent 
\backslash
colorbox{lightgray}{
\end_layout

\end_inset


\family typewriter
\size small

\begin_inset Box Frameless
position "t"
hor_pos "c"
has_inner_box 1
inner_pos "t"
use_parbox 0
use_makebox 0
width "98col%"
special "none"
height "1in"
height_special "totalheight"
status open

\begin_layout Plain Layout

\family typewriter
\size footnotesize
> fab -H testhost1 init_os:os_list="Linux", mac_list="01:02:03:04:05:06"
\end_layout

\end_inset


\begin_inset ERT
status open

\begin_layout Plain Layout

}
\end_layout

\end_inset


\end_layout

\begin_layout Subsection
Power cycling
\end_layout

\begin_layout Standard
The power_cycle task can be used to power cycle hosts, i.e.
 if hosts become unresponsive (assuming TEACUP-compatible power controller
 are configured).
 After the power cycle the hosts will boot the last selected OS.
 For example, the following command power cycles the hosts testhost1 and
 testhost2:
\end_layout

\begin_layout Standard
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
noindent 
\backslash
colorbox{lightgray}{
\end_layout

\end_inset


\family typewriter
\size small

\begin_inset Box Frameless
position "t"
hor_pos "c"
has_inner_box 1
inner_pos "t"
use_parbox 0
use_makebox 0
width "98col%"
special "none"
height "1in"
height_special "totalheight"
status open

\begin_layout Plain Layout

\family typewriter
\size footnotesize
> fab -H testhost1,testhost2 power_cycle
\end_layout

\end_inset


\begin_inset ERT
status open

\begin_layout Plain Layout

}
\end_layout

\end_inset


\end_layout

\begin_layout Subsection
Check software installations on testbed hosts
\end_layout

\begin_layout Standard
The check_host command can be used to check if the required software is
 installed on the hosts.
 The task only checks for the presence of necessary tools, but it does not
 check if the tools actually work.
 For example, the following command checks all testbed hosts:
\end_layout

\begin_layout Standard
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
noindent 
\backslash
colorbox{lightgray}{
\end_layout

\end_inset


\family typewriter
\size small

\begin_inset Box Frameless
position "t"
hor_pos "c"
has_inner_box 1
inner_pos "t"
use_parbox 0
use_makebox 0
width "98col%"
special "none"
height "1in"
height_special "totalheight"
status open

\begin_layout Plain Layout

\family typewriter
\size footnotesize
> fab -H 
\size small
testhost
\size footnotesize
1,testhost2,testhost3 check_host 
\end_layout

\end_inset


\begin_inset ERT
status open

\begin_layout Plain Layout

}
\end_layout

\end_inset


\end_layout

\begin_layout Subsection
Check testbed host connectivity
\end_layout

\begin_layout Standard
The check_connectivity task can be used to check connectivity between testbed
 hosts with 
\family typewriter
\size small
ping
\family default
\size default
.
 This task only checks the connectivity of the internal testbed network,
 not the reachability of hosts on their control interface.
 For example, the following command checks whether each host can reach each
 other host across the testbed network:
\end_layout

\begin_layout Standard
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
noindent 
\backslash
colorbox{lightgray}{
\end_layout

\end_inset


\family typewriter
\size small

\begin_inset Box Frameless
position "t"
hor_pos "c"
has_inner_box 1
inner_pos "t"
use_parbox 0
use_makebox 0
width "98col%"
special "none"
height "1in"
height_special "totalheight"
status open

\begin_layout Plain Layout

\family typewriter
\size footnotesize
> fab -H 
\size small
testhost
\size footnotesize
1,testhost2,testhost3 check_connectivity
\end_layout

\end_inset


\begin_inset ERT
status open

\begin_layout Plain Layout

}
\end_layout

\end_inset


\end_layout

\begin_layout Subsection
Check TEACUP config file
\end_layout

\begin_layout Standard
The check_config task can be used to check the TEACUP config file.
 This task will perform a number of checks and abort with an error message
 if it finds any errors in the config file.
 (This task is automatically run at the start of each experiment or series
 of experiments.)
\end_layout

\begin_layout Standard
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
noindent 
\backslash
colorbox{lightgray}{
\end_layout

\end_inset


\family typewriter
\size small

\begin_inset Box Frameless
position "t"
hor_pos "c"
has_inner_box 1
inner_pos "t"
use_parbox 0
use_makebox 0
width "98col%"
special "none"
height "1in"
height_special "totalheight"
status open

\begin_layout Plain Layout

\family typewriter
\size footnotesize
> fab check_config
\end_layout

\end_inset


\begin_inset ERT
status open

\begin_layout Plain Layout

}
\end_layout

\end_inset


\end_layout

\begin_layout Subsubsection
Print version information
\end_layout

\begin_layout Standard
The get_version task prints out the TEACUP version number, revision number
 and data, and the copyright:
\end_layout

\begin_layout Standard
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
noindent 
\backslash
colorbox{lightgray}{
\end_layout

\end_inset


\family typewriter
\size small

\begin_inset Box Frameless
position "t"
hor_pos "c"
has_inner_box 1
inner_pos "t"
use_parbox 0
use_makebox 0
width "98col%"
special "none"
height "1in"
height_special "totalheight"
status open

\begin_layout Plain Layout

\family typewriter
\size small
> fab get_version
\end_layout

\end_inset


\begin_inset ERT
status open

\begin_layout Plain Layout

}
\end_layout

\end_inset


\end_layout

\begin_layout Standard
The output will look like:
\end_layout

\begin_layout Standard
\begin_inset Float algorithm
wide false
sideways false
status open

\begin_layout Plain Layout

\family typewriter
\size small
TEACUP Version 0.9
\end_layout

\begin_layout Plain Layout

\family typewriter
\size small
Revision: 1175
\end_layout

\begin_layout Plain Layout

\family typewriter
\size small
Date: 2015-04-01 11:00:50 +1100 (Wed, 01 Apr 2015)
\end_layout

\begin_layout Plain Layout

\family typewriter
\size small
Copyright (c) 2013-2015 Centre for Advanced Internet Architectures
\end_layout

\begin_layout Plain Layout

\family typewriter
\size small
Swinburne University of Technology.
 All rights reserved.
\end_layout

\end_inset


\end_layout

\begin_layout Section
Experiment Examples
\end_layout

\begin_layout Subsection
Overview
\end_layout

\begin_layout Standard
Here we provide a few example scenarios of how TEACUP can be used.
 Each scenario involves traffic senders and receivers distributed across
 two subnets (subnet A and subnet B) connected by a bottleneck router.
 All hosts and the router are time synchronised using NTP.
 We have the following scenarios.
\end_layout

\begin_layout Itemize
Scenario 1: We have two TCP flows with data flowing from a source in subnet
 A to a destination in subnet B.
 We emulate different delays on the router.
 In this scenario the rebooting functionality of TEACUP is not used, which
 means the experimenter has to boot all three machines into the desired
 OS before the experiment is started.
\end_layout

\begin_layout Itemize
Scenario 2: As with scenario 1, with TEACUP also automatically booting the
 desired OS.
 
\end_layout

\begin_layout Itemize
Scenario 3: As with scenario 2, with TEACUP using a power controller to
 power cycle hosts if they don't respond after the reboot.
\end_layout

\begin_layout Itemize
Scenario 4: As with scenario 1, with each TCP flow between a different sender/re
ceiver pair and different network path delay emulated for each flow (both
 flows still go through the same bottleneck).
\end_layout

\begin_layout Itemize
Scenario 5: We have three staggered bulk-transfer flows going through the
 router, each between a different sender/receiver pair.
 We use different emulated delay for each sender/receiver pair and also
 vary the bandwidths.
 We now also vary the TCP congestion control algorithm.
 
\end_layout

\begin_layout Itemize
Scenario 6: We have three hosts plus the router.
 One host in subnet A acts as web server.
 The two other hosts in subnet B act as clients that both use DASH-like
 video streaming over HTTP.
 We emulate different network delays and AQM mechanisms.
 
\end_layout

\begin_layout Itemize
Scenario 7: Investigating the incast problem.
 On host in subnet A queries 10 responders in subnet B.
 Again, we emulate different network delays, AQM mechanisms and TCP algorithms.
 We also vary the size of the responses.
\end_layout

\begin_layout Subsection
Scenario 1: Two TCP flows from data sender to receiver
\end_layout

\begin_layout Subsubsection
Topology
\end_layout

\begin_layout Standard
In this scenario we have two hosts: newtcp20 connected to the 172.16.10.0/24
 network and newtcp27 connected to the 172.16.11.0/24 network.
 The machine newtcprt3 connects the two experiment subnets.
 All three machines also have a second network interface that is used to
 control the experiment via TEACUP.
 newtcp20 and newtcp27 must run Linux, FreeBSD, Windows 7 or Mac OS X and
 newtcprt3 must run FreeBSD or Linux.
 newtcp20 and newtcp27 must have the traffic generator and logging tools
 installed as described in 
\begin_inset CommandInset citation
LatexCommand cite
key "zander2014caia_tcp_testbed_v2"

\end_inset

.
 However, PXE booting or a multi-OS installation is not needed for this
 scenario.
\end_layout

\begin_layout Subsubsection
Test Traffic
\end_layout

\begin_layout Standard
Two TCP bulk transfer flows are created using iperf.
\end_layout

\begin_layout Subsubsection
Variable Parameters
\end_layout

\begin_layout Standard
We emulate three different delays and two different bandwidth settings --
 six different experiments in total.
 We do also define a variable parameter for AQM, but define only one AQM
 (default pfifo).
 This causes the used AQM to be logged as part of the experiment ID.
\end_layout

\begin_layout Subsubsection
TEACUP Config File
\end_layout

\begin_layout Standard
You can download the configuration file from 
\begin_inset CommandInset citation
LatexCommand cite
key "teacup-examples-web"

\end_inset

.
 To use the configuration rename it to config.py.
 In the following we explain the configuration file.
\end_layout

\begin_layout Standard
Note that TEACUP configuration files can be split across multiple files
 (using Python's execfile()).
 This allows to split a large config file into multiple files for better
 readability.
 It also allows to include part of configuration files into multiple different
 config files, which makes it possible to reuse parts of the config that
 is not changed across multiple experiments.
 An example of a this is this config file, which is functionally identical
 to the above config file.
 Only here the main config file includes separate files to specify the testbed
 machines, the router setup and the traffic generated.
\end_layout

\begin_layout Standard
At the top of the configuration file we need to import the Fabric env structure
 and we also need to import any other Python functionality used (see Listing
 
\begin_inset CommandInset ref
LatexCommand ref
reference "lis:Scenario1-Fabric"

\end_inset

).
 First we need to configure the user and password used by Fabric via Fabrics
 env parameters.
 A password is not required if public key authentication is set up.
 We also need to tell Fabric how to execute commands on the remote machines.
 TEACUP uses Bourne shell (/bin/sh) by default.
\end_layout

\begin_layout Standard
\begin_inset listings
lstparams "basicstyle={\footnotesize\ttfamily},captionpos=b,float={*t}"
inline false
status open

\begin_layout Plain Layout

# User and password 
\end_layout

\begin_layout Plain Layout

env.user = 'root' 
\end_layout

\begin_layout Plain Layout

env.password = 'rootpw'
\end_layout

\begin_layout Plain Layout

# Set shell used to execute commands 
\end_layout

\begin_layout Plain Layout

env.shell = '/bin/sh -c' 
\end_layout

\begin_layout Plain Layout

\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "lis:Scenario1-Fabric"

\end_inset

Scenario 1, Fabric configuration
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
The next part of the config file defines the path to the TEACUP scripts
 and the testbed hosts (see Listing 
\begin_inset CommandInset ref
LatexCommand ref
reference "lis:Scenario1-Hosts"

\end_inset

).
 TPCONF_router is used to define the router and TPCONF_hosts is used to
 define the list of hosts.
 For each host and the router the testbed network interfaces need to be
 defined with TPCONF_host_internal_ip.
 The router obviously has two testbed network interfaces, whereas the hosts
 have only one.
\end_layout

\begin_layout Standard
\begin_inset listings
lstparams "basicstyle={\footnotesize\ttfamily},captionpos=b,float={*t}"
inline false
status open

\begin_layout Plain Layout

# Path to teacup scripts 
\end_layout

\begin_layout Plain Layout

TPCONF_script_path = '/home/teacup/teacup-0.8' 
\end_layout

\begin_layout Plain Layout

# DO NOT remove the following line 
\end_layout

\begin_layout Plain Layout

sys.path.append(TPCONF_script_path)
\end_layout

\begin_layout Plain Layout

# Set debugging level (0 = no debugging info output) 
\end_layout

\begin_layout Plain Layout

TPCONF_debug_level = 0
\end_layout

\begin_layout Plain Layout

# Host lists 
\end_layout

\begin_layout Plain Layout

TPCONF_router = ['newtcprt3', ] 
\end_layout

\begin_layout Plain Layout

TPCONF_hosts = [ 'newtcp20', 'newtcp27', ]
\end_layout

\begin_layout Plain Layout

# Map external IPs to internal IPs 
\end_layout

\begin_layout Plain Layout

TPCONF_host_internal_ip = { 
\end_layout

\begin_layout Plain Layout

	'newtcprt3': ['172.16.10.1', '172.16.11.1'], 
\end_layout

\begin_layout Plain Layout

	'newtcp20': ['172.16.10.60'], 
\end_layout

\begin_layout Plain Layout

	'newtcp27': ['172.16.11.67'], 
\end_layout

\begin_layout Plain Layout

} 
\end_layout

\begin_layout Plain Layout

\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "lis:Scenario1-Hosts"

\end_inset

Scenario 1, general settings and host configuration
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
In the next part of the configuration file we need to define some general
 experiment settings (see Listing 
\begin_inset CommandInset ref
LatexCommand ref
reference "lis:Scenario1-Test-ID-prefix"

\end_inset

).
 TEACUP_max_time_diff specifies the maximum clock offset in seconds allowed.
 This is a very coarse threshold as the offset estimation performed by TEACUP
 is not very accurate.
 Currently, TEACUP simply attempts to find out if the synchronisation is
 very bad and if yes it will abort; it does try to enforce high accuracy
 for the time synchronisation.
 TPCONF_test_id defines the name prefix for the output files for an experiment
 or a series of experiments.
 TPCONF_remote_dir specifies where on the hosts the log files are stored
 until they are moved to the control host running TEACUP after each experiment.
\end_layout

\begin_layout Standard
\begin_inset listings
lstparams "basicstyle={\footnotesize\ttfamily},captionpos=b,float={*t}"
inline false
status open

\begin_layout Plain Layout

# Maximum allowed time difference between machines in seconds 
\end_layout

\begin_layout Plain Layout

# otherwise experiment will abort cause synchronisation problems 
\end_layout

\begin_layout Plain Layout

TPCONF_max_time_diff = 1
\end_layout

\begin_layout Plain Layout

# Experiment name prefix used if not set on the command line 
\end_layout

\begin_layout Plain Layout

# The command line setting will overrule this config setting 
\end_layout

\begin_layout Plain Layout

now = datetime.datetime.today() 
\end_layout

\begin_layout Plain Layout

TPCONF_test_id = now.strftime("%Y%m%d-%H%M%S") + 'experiment'
\end_layout

\begin_layout Plain Layout

# Directory to store log files on remote host 
\end_layout

\begin_layout Plain Layout

TPCONF_remote_dir = '/tmp/'
\end_layout

\begin_layout Plain Layout

\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "lis:Scenario1-Test-ID-prefix"

\end_inset

Scenario 1, test ID prefix and directory configuration
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
Then we define the router queues/pipes using TPCONF_router_queues (see Listing
 
\begin_inset CommandInset ref
LatexCommand ref
reference "lis:Scenario1-Router"

\end_inset

).
 Each entry of this list is a tuple.
 The first value is the queue number and the second value is a comma separated
 list of parameters.
 The queue numbers must be unique.
 Note that variable parameters must be either constants or variable names
 defined by the experimenter.
 Variables are evaluated during run-time.
 Variable names must start with a `V_'.
 Parameter names can only contain numbers, letter (upper and lower case),
 underscores (_), and hyphen/minus (-).
 All V_variables must be defined in TPCONF_variable_list (see below).
\end_layout

\begin_layout Standard
\begin_inset listings
lstparams "basicstyle={\footnotesize\ttfamily},captionpos=b,float={*t}"
inline false
status open

\begin_layout Plain Layout

TPCONF_router_queues = [ 
\end_layout

\begin_layout Plain Layout

	# Set same delay for every host 
\end_layout

\begin_layout Plain Layout

	('1', " source='172.16.10.0/24', dest='172.16.11.0/24', delay=V_delay, " 
\end_layout

\begin_layout Plain Layout

    	  " loss=V_loss, rate=V_up_rate, queue_disc=V_aqm, queue_size=V_bsize
 "), 
\end_layout

\begin_layout Plain Layout

	('2', " source='172.16.11.0/24', dest='172.16.10.0/24', delay=V_delay, " 
\end_layout

\begin_layout Plain Layout

    	  " loss=V_loss, rate=V_down_rate, queue_disc=V_aqm, queue_size=V_bsize
 "), 
\end_layout

\begin_layout Plain Layout

]
\end_layout

\begin_layout Plain Layout

\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "lis:Scenario1-Router"

\end_inset

Scenario 1, router queue configuration
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
Next we need to define the traffic generated during the experiments (see
 Listing 
\begin_inset CommandInset ref
LatexCommand ref
reference "lis:Scenario1-Traffic"

\end_inset

).
 TEACUP implements a number of traffic generators.
 In this example we use iperf to generate TCP bulk transfer flows.
 TPCONF_traffic_gens defines the traffic generator, but here we use a temporary
 variable as well, which allows to have multiple traffic generator definitions
 and switch between them by changing the variable assigned to TPCONF_traffic_gen
s.
\end_layout

\begin_layout Standard
Each entry in is a 3-tuple.
 The first value of the tuple must be a float and is the time relative to
 the start of the experiment when tasks are executed.
 If two tasks have the same start time their start order is arbitrary.
 The second entry of the tuple is the task number and must be a unique integer
 (used as ID for the process).
 The last value of the tuple is a comma separated list of parameters.
 The first parameter of this list must be the task name.
 The TEACUP manual lists the task name and possible parameters.
 Client and server can be specified using the external/control IP addresses
 or host names.
 In this case the actual interface used is the 
\emph on
first
\emph default
 internal address (according to TPCONF_host_internal_ip).
 Alternatively, client and server can be specified as internal addresses,
 which allows to use any internal interfaces configured.
 
\end_layout

\begin_layout Standard
\begin_inset listings
lstparams "basicstyle={\footnotesize\ttfamily},captionpos=b,float={*t}"
inline false
status open

\begin_layout Plain Layout

traffic_iperf = [ 
\end_layout

\begin_layout Plain Layout

	('0.0', '1', " start_iperf, client='newtcp27', server='newtcp20', port=5000,
 " 
\end_layout

\begin_layout Plain Layout

    	         " duration=V_duration "), 
\end_layout

\begin_layout Plain Layout

	('0.0', '2', " start_iperf, client='newtcp27', server='newtcp20', port=5001,
 " 
\end_layout

\begin_layout Plain Layout

    	         " duration=V_duration "), 
\end_layout

\begin_layout Plain Layout

	# Or using internal addresses 
\end_layout

\begin_layout Plain Layout

	#( '0.0', '1', " start_iperf, client='172.16.11.2', server='172.16.10.2', " 
\end_layout

\begin_layout Plain Layout

	#              " port=5000, duration=V_duration " ), 
\end_layout

\begin_layout Plain Layout

	#( '0.0', '2', " start_iperf, client='172.16.11.2', server='172.16.10.2', " 
\end_layout

\begin_layout Plain Layout

	#              " port=5001, duration=V_duration " ), 
\end_layout

\begin_layout Plain Layout

]
\end_layout

\begin_layout Plain Layout

# THIS is the traffic generator setup we will use 
\end_layout

\begin_layout Plain Layout

TPCONF_traffic_gens = traffic_iperf
\end_layout

\begin_layout Plain Layout

\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "lis:Scenario1-Traffic"

\end_inset

Scenario 1, traffic configuration
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
Next, we define all the parameter values used in the experiments (see Listing
 
\begin_inset CommandInset ref
LatexCommand ref
reference "lis:Scenario1-Parameters"

\end_inset

).
 TPCONF_duration defines the duration of the traffic.
 TPCONF_runs specifies the number of runs carried out for each unique combinatio
n of parameters.
 TPCONF_TCP_algos specifies the congestion control algorithms.
 Here we only use Newreno.
\end_layout

\begin_layout Standard
In this simple case all hosts use the same TCP congestion control algorithm,
 but TEACUP allows to specify per-host algorithms with TPCONF_host_TCP_algos.
 Parameter settings for TCP congestion control algorithms can be specified
 with TPCONF_host_TCP_algo_params (assuming parameters can be controlled
 with sysctl), but here we do not make use of that and simply use the default
 settings.
\end_layout

\begin_layout Standard
TPCONF_delays specifies the delay values (delay in each direction), TPCONF_loss_
rates specifies the possible packet loss rates and TPCONF_bandwidths specifies
 the emulated bandwidths (in downstream and upstream directions).
 TPCONF_aqms specifies the AQM mechanism to use (here pfifo which is the
 default).
 TPCONF_buffer_sizes specifies the size of the queue.
 This is normally specified in packets, but it depends on the type of AQM.
 For example, if bfifo was used the size would need to be specified in bytes.
\end_layout

\begin_layout Standard
\begin_inset listings
lstparams "basicstyle={\footnotesize\ttfamily},captionpos=b,float={*t}"
inline false
status open

\begin_layout Plain Layout

# Duration in seconds of traffic 
\end_layout

\begin_layout Plain Layout

TPCONF_duration = 30
\end_layout

\begin_layout Plain Layout

# Number of runs for each setting 
\end_layout

\begin_layout Plain Layout

TPCONF_runs = 1
\end_layout

\begin_layout Plain Layout

# TCP congestion control algorithm used 
\end_layout

\begin_layout Plain Layout

TPCONF_TCP_algos = ['newreno', ]
\end_layout

\begin_layout Plain Layout

# Emulated delays in ms 
\end_layout

\begin_layout Plain Layout

TPCONF_delays = [0, 25, 50]
\end_layout

\begin_layout Plain Layout

# Emulated loss rates 
\end_layout

\begin_layout Plain Layout

TPCONF_loss_rates = [0]
\end_layout

\begin_layout Plain Layout

# Emulated bandwidths (downstream, upstream) 
\end_layout

\begin_layout Plain Layout

TPCONF_bandwidths = [ ('8mbit', '1mbit'), ('20mbit', '1.4mbit'), ]
\end_layout

\begin_layout Plain Layout

# AQM 
\end_layout

\begin_layout Plain Layout

TPCONF_aqms = ['pfifo', ]
\end_layout

\begin_layout Plain Layout

# Buffer size 
\end_layout

\begin_layout Plain Layout

TPCONF_buffer_sizes = [100]
\end_layout

\begin_layout Plain Layout

\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "lis:Scenario1-Parameters"

\end_inset

Scenario 1, experiment parameter value configuration
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
Finally, we need to specify which parameters will be varied and which parameters
 will be fixed for a series of experiments, and we also need to define how
 our parameter ranges above map to V_variables used for the queue setup
 and traffic generators and the log file names generated by TEACUP (see
 Listing 
\begin_inset CommandInset ref
LatexCommand ref
reference "lis:Scenario1-Vary-Parameters"

\end_inset

).
\end_layout

\begin_layout Standard
TPCONF_parameter_list is a map of the parameters we potentially want to
 vary.
 The key of each item is the identifier that can be used in TPCONF_vary_paramete
rs (see below).
 The value of each item is a 4-tuple containing the following things.
 First, a list of variable names.
 Second, a list of short names uses for the file names.
 For each parameter varied a string `_<short_name>_<value>' is appended
 to the log file names (appended to chosen prefix).
 Note, short names should only be letters from a--z or A--Z, do not use
 underscores or hyphens.
 Third, the list of parameters values.
 If there is more than one variable this must be a list of tuples, each
 tuple having the same number of items as the number of variables.
 Fourth, an optional dictionary with additional variables, where the keys
 are the variable names and the values are the variable values.
\end_layout

\begin_layout Standard
The parameters that are actually varied are specified with TPCONF_vary_parameter
s.
 Only parameters listed in TPCONF_vary_parameters will appear in the name
 of TEACUP output files.
 So it can make sense to add a parameter in TPCONF_vary_parameters that
 only has a single value, because only then will the parameter short name
 and value be part of the file names.
\end_layout

\begin_layout Standard
TPCONF_variable_defaults specifies the default value for each variable,
 which is used for variables that are not varied.
 The key of each item is the parameter name.
 The value of each item is the default parameter value used if the variable
 is not varied.
\end_layout

\begin_layout Standard
\begin_inset listings
lstparams "basicstyle={\footnotesize\ttfamily},captionpos=b,float={*t}"
inline false
status open

\begin_layout Plain Layout

TPCONF_parameter_list = { 
\end_layout

\begin_layout Plain Layout

	# Vary name V_ variable file name values extra vars 
\end_layout

\begin_layout Plain Layout

	'delays' : (['V_delay'], ['del'], TPCONF_delays, {}), 
\end_layout

\begin_layout Plain Layout

	'loss' : (['V_loss'], ['loss'], TPCONF_loss_rates, {}), 
\end_layout

\begin_layout Plain Layout

	'tcpalgos' : (['V_tcp_cc_algo'],['tcp'], TPCONF_TCP_algos, {}), 
\end_layout

\begin_layout Plain Layout

	'aqms' : (['V_aqm'], ['aqm'], TPCONF_aqms, {}), 
\end_layout

\begin_layout Plain Layout

	'bsizes' : (['V_bsize'], ['bs'], TPCONF_buffer_sizes, {}), 
\end_layout

\begin_layout Plain Layout

	'runs' : (['V_runs'], ['run'], range(TPCONF_runs), {}), 
\end_layout

\begin_layout Plain Layout

	'bandwidths' : (['V_down_rate', 'V_up_rate'], ['down', 'up'], TPCONF_bandwidths
, {}), 
\end_layout

\begin_layout Plain Layout

}
\end_layout

\begin_layout Plain Layout

TPCONF_variable_defaults = { 
\end_layout

\begin_layout Plain Layout

	# V_ variable value 
\end_layout

\begin_layout Plain Layout

	'V_duration' : TPCONF_duration, 
\end_layout

\begin_layout Plain Layout

	'V_delay' : TPCONF_delays[0], 
\end_layout

\begin_layout Plain Layout

	'V_loss' : TPCONF_loss_rates[0], 
\end_layout

\begin_layout Plain Layout

	'V_tcp_cc_algo' : TPCONF_TCP_algos[0], 
\end_layout

\begin_layout Plain Layout

	'V_down_rate' : TPCONF_bandwidths[0][0], 
\end_layout

\begin_layout Plain Layout

	'V_up_rate' : TPCONF_bandwidths[0][1], 
\end_layout

\begin_layout Plain Layout

	'V_aqm' : TPCONF_aqms[0], 
\end_layout

\begin_layout Plain Layout

	'V_bsize' : TPCONF_buffer_sizes[0], 
\end_layout

\begin_layout Plain Layout

}
\end_layout

\begin_layout Plain Layout

# Specify the parameters we vary through all values, all others will be
 fixed 
\end_layout

\begin_layout Plain Layout

# according to TPCONF_variable_defaults 
\end_layout

\begin_layout Plain Layout

TPCONF_vary_parameters = ['delays', 'bandwidths', 'aqms', 'runs',]
\end_layout

\begin_layout Plain Layout

\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "lis:Scenario1-Vary-Parameters"

\end_inset

Scenario 1, variable parameters configuration
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Subsubsection
Running Experiment
\end_layout

\begin_layout Standard
Create a directory with the above config.py and copy fabfile.py and run.sh
 from the TEACUP code distribution into this directory.
 To run the series of experiments with all parameter combinations go into
 the experiment directory (that contains fabfile.py and run.sh) and execute:
 
\end_layout

\begin_layout Standard
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
noindent 
\backslash
colorbox{lightgray}{
\end_layout

\end_inset


\family typewriter
\size small

\begin_inset Box Frameless
position "t"
hor_pos "c"
has_inner_box 1
inner_pos "t"
use_parbox 0
use_makebox 0
width "97col%"
special "none"
height "1in"
height_special "totalheight"
status open

\begin_layout Plain Layout

\family typewriter
\size small
> ./run.sh
\end_layout

\end_inset


\begin_inset ERT
status open

\begin_layout Plain Layout

}
\end_layout

\end_inset


\end_layout

\begin_layout Standard
This will create a sub directory with the name of the test ID prefix and
 store all output files in this sub directory.
\end_layout

\begin_layout Subsubsection
Analysing Results
\end_layout

\begin_layout Standard
TEACUP provides a range of tasks for analysing the results of a given experiment
, described in an accompanying technical report 
\begin_inset CommandInset citation
LatexCommand cite
key "zander2015caia_teacup_v1.0_analysis"

\end_inset

.
 Here we briefly summarise how to extract some key results.
\end_layout

\begin_layout Standard
TEACUP will create a file names <test_id_prefix>.log file in the experiment
 data sub directory.
 It will also create a file experiments_started.txt and experiments_completed.txt
 in the parent directory.
 The file experiments_started.txt contains the names of all experiments started
 and the file experiments_completed.txt contains the names of all experiments
 successfully completed.
 If some experiments were not completed, check the log file for errors.
\end_layout

\begin_layout Standard
Assuming all experiments of a series completed successfully, we can now
 start to analyse the data.
 To create time series of CWND, RTT as estimated by TCP, RTT as estimated
 using SPP and the throughput over time for each experiment of the series,
 use the following command which creates intermediate files and the .pdf
 plot files in a sub directory named results inside the test data directory
 (the command needs to be executed in the directory where fabfile.py is).
 
\end_layout

\begin_layout Standard
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
noindent 
\backslash
colorbox{lightgray}{
\end_layout

\end_inset


\family typewriter
\size small

\begin_inset Box Frameless
position "t"
hor_pos "c"
has_inner_box 1
inner_pos "t"
use_parbox 0
use_makebox 0
width "97col%"
special "none"
height "1in"
height_special "totalheight"
status open

\begin_layout Plain Layout

\family typewriter
\size small
> fab analyse_all:out_dir="./results"
\end_layout

\end_inset


\begin_inset ERT
status open

\begin_layout Plain Layout

}
\end_layout

\end_inset


\end_layout

\begin_layout Standard
Figure 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:Throughput-and-RTT"

\end_inset

 shows the throughput and TCP's smoothed RTT estimates produced by TEACUP
 for the experiment with an emulated RTT of 50 ms, a bandwidth of 8 mbit/s
 downstream and 1 mbit/s upstream, and a buffer size of 100 packets.
 The hosts and the router ran Linux kernel 3.17.4.
 The throughput graph shows that both flows share the downstream link equally,
 while the upstream link carrying only ACKs is not fully utilised.
 The RTT graph shows that the total RTT reaches almost 100 ms due to the
 buffering (the plotted RTT estimates for the ACK streams are useless).
\end_layout

\begin_layout Standard
\begin_inset Float figure
placement t
wide true
sideways false
status open

\begin_layout Plain Layout
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\begin_inset Graphics
	filename graphs/20150211-171242_experiment_del_25_down_8mbit_up_1mbit_aqm_pfifo_run_0_throughput_time_series.pdf
	scale 80
	BoundingBox 0bp 0bp 290bp 206bp
	clip

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
Throughput
\end_layout

\end_inset


\end_layout

\end_inset


\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\begin_inset Graphics
	filename graphs/20150211-171242_experiment_del_25_down_8mbit_up_1mbit_aqm_pfifo_run_0_smooth_tcprtt_time_series.pdf
	scale 80
	BoundingBox 0bp 0bp 290bp 206bp
	clip

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
RTT
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "fig:Throughput-and-RTT"

\end_inset

Throughput and TCP RTT estimate measured in Scenario 1
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Subsection
Scenario 2: Scenario 1 plus automatic booting of hosts
\end_layout

\begin_layout Subsubsection
Topology
\end_layout

\begin_layout Standard
Like in scenario 1 we have two hosts: newtcp20 connected to the 172.16.10.0/24
 network and newtcp27 connected to the 172.16.11.0/24 network.
 The machine newtcprt3 connects the two experiment subnets.
 All three machines also have a second network interface that is used to
 control the experiment via TEACUP.
 In this scenario we assume that the hosts have been installed according
 to 
\begin_inset CommandInset citation
LatexCommand cite
key "zander2014caia_tcp_testbed_v2"

\end_inset

 including PXE booting and a multi-OS installation on each host as described
 in the tech report.
\end_layout

\begin_layout Subsubsection
Test Traffic
\end_layout

\begin_layout Standard
Like in scenario 1 two TCP bulk transfer flows are created using iperf.
\end_layout

\begin_layout Subsubsection
Variable Parameters
\end_layout

\begin_layout Standard
Like in scenario 1 we emulate three different delays and two different bandwidth
 settings -- six different experiments in total.
 We do also define a variable parameter for AQM, but define only one AQM
 (default pfifo).
 This causes the used AQM to be logged as part of the experiment ID.
\end_layout

\begin_layout Subsubsection
TEACUP Config File
\end_layout

\begin_layout Standard
You can download the configuration file from 
\begin_inset CommandInset citation
LatexCommand cite
key "teacup-examples-web"

\end_inset

.
 To use the configuration rename it to config.py.
 In the following we explain the configuration file.
\end_layout

\begin_layout Standard
Most of the configuration is identical to the configuration used in scenario
 1.
 The only difference is that now TEACUP will reboot the machines automatically
 into the specified OS, which is very useful if machines have a multi-boot
 setup, i.e.
 can run different OS.
 The automatic rebooting of multi-OS machines requires that machines are
 configured with PXE+GRUB as described in the tech report.
 If machines have only a single OS the reboot function is still useful to
 put machines into a clean state before an experiment and in this case PXE
 booting is not needed.
\end_layout

\begin_layout Standard
Listing 
\begin_inset CommandInset ref
LatexCommand ref
reference "lis:Scenario2-Reboot"

\end_inset

 shows the additional configuration needed, compared to scenario 1.
 TPCONF_tftpboot_dir specifies the directory where TEACUP will put the files
 that GRUB will read (after loaded via PXE) which specify from which hard
 disk partition to boot from.
 TPCONF_host_os specifies the operating for each host and router.
 For Linux TEACUP allows to specify the kernel that is booted.
 TPCONF_linux_kern_router specifies the kernel booted on the router and
 TPCONF_linux_kern_hosts specifies the kernel booted on the other hosts.
 If TPCONF_force_reboot is not set to `0', TEACUP will only reboot a host
 if the currently running OS is different from the OS specified in TPCONF_host_o
s (Linux hosts will also be rebooted if the currently running kernel is
 different from the kernel specified in TPCONF_linux_kern_router or TPCONF_linux
_kern_hosts).
 TPCONF_boot_timeout specifies the amount of time TEACUP will wait for a
 host to be rebooted and accessible via SSH again.
 If a host is not rebooted and running the desired OS within this time TEACUP
 will abort with an error.
\end_layout

\begin_layout Standard
Currently, by default TEACUP expects Windows on partition 1, Linux on partition
 2, FreeBSD on partition 3 on the first hard disk.
 However, the variable TPCONF_os_partition can be used to specify the partitions
 in GRUB4DOS format.
 PXE booting of MacOS is not supported currently.
\end_layout

\begin_layout Standard
\begin_inset listings
lstparams "basicstyle={\footnotesize\ttfamily},captionpos=b,float={*t}"
inline false
status open

\begin_layout Plain Layout

# Path to tftp server handling the pxe boot 
\end_layout

\begin_layout Plain Layout

# Setting this to an empty string '' means no PXE booting, and TPCONF_host_os
 
\end_layout

\begin_layout Plain Layout

# and TPCONF_force_reboot are simply ignored 
\end_layout

\begin_layout Plain Layout

TPCONF_tftpboot_dir = '/tftpboot'
\end_layout

\begin_layout Plain Layout

# Operating system config, machines that are not explicitly listed are 
\end_layout

\begin_layout Plain Layout

# left as they are (OS can be 'Linux', 'FreeBSD', 'CYGWIN', 'Darwin') 
\end_layout

\begin_layout Plain Layout

TPCONF_host_os = { 
\end_layout

\begin_layout Plain Layout

	'newtcprt3': 'Linux', 
\end_layout

\begin_layout Plain Layout

	'newtcp20': 'Linux', 
\end_layout

\begin_layout Plain Layout

	'newtcp27': 'Linux', 
\end_layout

\begin_layout Plain Layout

}
\end_layout

\begin_layout Plain Layout

# Specify the Linux kernel to use, only used for machines running Linux
 
\end_layout

\begin_layout Plain Layout

# (basically the full name without the vmlinuz-) 
\end_layout

\begin_layout Plain Layout

TPCONF_linux_kern_router = '3.17.4-vanilla-10000hz' 
\end_layout

\begin_layout Plain Layout

TPCONF_linux_kern_hosts = '3.17.4-vanilla-web10g'
\end_layout

\begin_layout Plain Layout

# Force reboot 
\end_layout

\begin_layout Plain Layout

# If set to '1' will force a reboot of all hosts 
\end_layout

\begin_layout Plain Layout

# If set to '0' only hosts where OS is not the desired OS will be rebooted
 
\end_layout

\begin_layout Plain Layout

TPCONF_force_reboot = '0'
\end_layout

\begin_layout Plain Layout

# Time to wait for reboot in seconds (integer) 
\end_layout

\begin_layout Plain Layout

# Minimum timeout is 60 seconds 
\end_layout

\begin_layout Plain Layout

TPCONF_boot_timeout = 120
\end_layout

\begin_layout Plain Layout

# Map OS to partition on hard disk (note the partition must be specified
 
\end_layout

\begin_layout Plain Layout

# in the GRUB4DOS format, _not_ GRUB2 format) 
\end_layout

\begin_layout Plain Layout

TPCONF_os_partition = { 
\end_layout

\begin_layout Plain Layout

	'CYGWIN': '(hd0,0)', 
\end_layout

\begin_layout Plain Layout

	'Linux': '(hd0,1)', 
\end_layout

\begin_layout Plain Layout

	'FreeBSD': '(hd0,2)', 
\end_layout

\begin_layout Plain Layout

}
\end_layout

\begin_layout Plain Layout

\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "lis:Scenario2-Reboot"

\end_inset

Scenario 2, OS and reboot configuration
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Subsubsection
Run and analyse experiment
\end_layout

\begin_layout Standard
See scenario 1.
\end_layout

\begin_layout Subsection
Scenario 3: Scenario 1 plus power control
\end_layout

\begin_layout Subsubsection
Topology
\end_layout

\begin_layout Standard
Like in scenario 1 we have two hosts: newtcp20 connected to the 172.16.10.0/24
 network and newtcp27 connected to the 172.16.11.0/24 network.
 The machine newtcprt3 connects the two experiment subnets.
 All three machines also have a second network interface that is used to
 control the experiment via TEACUP.
 We assume that the hosts have been installed according to 
\begin_inset CommandInset citation
LatexCommand cite
key "zander2014caia_tcp_testbed_v2"

\end_inset

.
 Furthermore, this scenario only works with installed TEACUP-compatible
 power controllers that are set up to control the power of the three hosts.
\end_layout

\begin_layout Subsubsection
Test Traffic
\end_layout

\begin_layout Standard
Like in scenario 1 two TCP bulk transfer flows are created using iperf.
\end_layout

\begin_layout Subsubsection
Variable Parameters
\end_layout

\begin_layout Standard
Like in scenario 1 we emulate three different delays and two different bandwidth
 settings -- six different experiments in total.
 We do also define a variable parameter for AQM, but define only one AQM
 (default pfifo).
 This causes the used AQM to be logged as part of the experiment ID.
\end_layout

\begin_layout Subsubsection
TEACUP Config File
\end_layout

\begin_layout Standard
You can download the configuration file from 
\begin_inset CommandInset citation
LatexCommand cite
key "teacup-examples-web"

\end_inset

.
 To use the configuration rename it to config.py.
 In the following we explain the configuration file.
\end_layout

\begin_layout Standard
Most of the configuration is identical to the configuration used in scenario
 2.
 The only different is that now TEACUP will automatically power cycle machines
 that to not come up within the reboot timeout.
 TEACUP will only power cycle machines once.
 If after a power cycle and reboot the machines are still unresponsive TEACUP
 will give up.
 Power cycling can only used if the machines are connected via a power controlle
r supported by TEACUP.
 Currently, TEACUP supports two power controllers: IP Power 9258HP (9258HP)
 and Serverlink SLP-SPP1008-H (SLP-SPP1008).
\end_layout

\begin_layout Standard
Listing 
\begin_inset CommandInset ref
LatexCommand ref
reference "lis:Scenario3-Power"

\end_inset

 shows the additional configuration needed, compared to scenario 1.
 TPCONF_do_power_cycle must be set to `1' to perform power cycling.
 If power cycling is used TPCONF_host_power_ctrlport must define the IP
 address of the responsible power controller for each machine as well as
 the power controller's port the machine is connected to.
 TPCONF_power_admin_name and TPCONF_power_admin_pw must specify the admin
 user's name and password required to login to the power controller's web
 interface.
 TPCONF_power_ctrl_type specifies the type of power controller.
 
\end_layout

\begin_layout Standard
\begin_inset listings
lstparams "basicstyle={\footnotesize\ttfamily},captionpos=b,float={*t}"
inline false
status open

\begin_layout Plain Layout

# If host does not come up within timeout force power cycle 
\end_layout

\begin_layout Plain Layout

# If set to '1' force power cycle if host not up within timeout 
\end_layout

\begin_layout Plain Layout

# If set to '0' never force power cycle 
\end_layout

\begin_layout Plain Layout

TPCONF_do_power_cycle = '1'
\end_layout

\begin_layout Plain Layout

# Maps host to power controller IP (or name) and power controller port number
 
\end_layout

\begin_layout Plain Layout

TPCONF_host_power_ctrlport = { 
\end_layout

\begin_layout Plain Layout

	'newtcprt3': ('10.0.0.100', '1'), 
\end_layout

\begin_layout Plain Layout

	'newtcp20': ('10.0.0.100', '2'), 
\end_layout

\begin_layout Plain Layout

	'newtcp27': ('10.0.0.100', '3'), 
\end_layout

\begin_layout Plain Layout

}
\end_layout

\begin_layout Plain Layout

# Power controller admin user name 
\end_layout

\begin_layout Plain Layout

TPCONF_power_admin_name = 'admin' 
\end_layout

\begin_layout Plain Layout

# Power controller admin user password 
\end_layout

\begin_layout Plain Layout

TPCONF_power_admin_pw = env.password
\end_layout

\begin_layout Plain Layout

# Type of power controller.
 Currently supported are only: 
\end_layout

\begin_layout Plain Layout

# IP Power 9258HP (9258HP) and Serverlink SLP-SPP1008-H (SLP-SPP1008) 
\end_layout

\begin_layout Plain Layout

TPCONF_power_ctrl_type = 'SLP-SPP1008'
\end_layout

\begin_layout Plain Layout

\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "lis:Scenario3-Power"

\end_inset

Scenario 3, power controller configuration
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Subsubsection
Run and analyse experiment
\end_layout

\begin_layout Standard
See scenario 1.
\end_layout

\begin_layout Subsection
Scenario 4: TCP flows with same bottleneck queue but different delay
\end_layout

\begin_layout Subsubsection
Topology
\end_layout

\begin_layout Standard
We now have two hosts in each subnet: newtcp20 and newtcp21 connected to
 the 172.16.10.0/24 network, newtcp27 and newtcp28 connected to the 172.16.11.0/24
 network.
 The machine newtcprt3 connects the two experiment subnets.
 All three machines also have a second network interface that is used to
 control the experiment via TEACUP.
 Like scenario 1 this scenario requires that hosts have the traffic generator
 and logging tools installed as described in 
\begin_inset CommandInset citation
LatexCommand cite
key "zander2014caia_tcp_testbed_v2"

\end_inset

, but PXE booting or a multi-OS installation is not needed.
\end_layout

\begin_layout Subsubsection
Test Traffic
\end_layout

\begin_layout Standard
Two TCP bulk transfer flows are created using iperf.
 One flow is between newtcp20 and newtcp27 and the second flow is between
 newtcp21 and newtcp28.
\end_layout

\begin_layout Subsubsection
Variable Parameters
\end_layout

\begin_layout Standard
Like in scenario 1 we emulate two different bandwidth settings.
 However, we setup different delays for each flow.
 Since each flow can have two different values, we have eight different
 experiments in total.
 We do also define a variable parameter for AQM, but define only one AQM
 (default pfifo).
 This causes the used AQM to be logged as part of the experiment ID.
\end_layout

\begin_layout Subsubsection
TEACUP Config File
\end_layout

\begin_layout Standard
You can download the configuration file from 
\begin_inset CommandInset citation
LatexCommand cite
key "teacup-examples-web"

\end_inset

.
 To use the configuration rename it to config.py.
 In the following we explain the parts of the configuration file that have
 changed compared to scenario 1.
\end_layout

\begin_layout Standard
Our host configuration now looks as in Listing 
\begin_inset CommandInset ref
LatexCommand ref
reference "lis:Scenario4-Hosts"

\end_inset

.
\end_layout

\begin_layout Standard
\begin_inset listings
lstparams "basicstyle={\footnotesize\ttfamily},captionpos=b,float={*t}"
inline false
status open

\begin_layout Plain Layout

TPCONF_router = ['newtcprt3', ] 
\end_layout

\begin_layout Plain Layout

TPCONF_hosts = [ 'newtcp20', 'newtcp21', 'newtcp27', 'newtcp28', ]
\end_layout

\begin_layout Plain Layout

TPCONF_host_internal_ip = { 
\end_layout

\begin_layout Plain Layout

	'newtcprt3': ['172.16.10.1', '172.16.11.1'], 
\end_layout

\begin_layout Plain Layout

	'newtcp20': ['172.16.10.60'], 
\end_layout

\begin_layout Plain Layout

	'newtcp21': ['172.16.10.61'], 
\end_layout

\begin_layout Plain Layout

	'newtcp27': ['172.16.11.67'], 
\end_layout

\begin_layout Plain Layout

	'newtcp28': ['172.16.11.68'], 
\end_layout

\begin_layout Plain Layout

}
\end_layout

\begin_layout Plain Layout

\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "lis:Scenario4-Hosts"

\end_inset

Scenario 4, host configuration
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
To configure different delays for each flow we also need to change the router
 setup (see Listing 
\begin_inset CommandInset ref
LatexCommand ref
reference "lis:Scenario4-Router"

\end_inset

).
 
\end_layout

\begin_layout Standard
\begin_inset listings
lstparams "basicstyle={\footnotesize\ttfamily},captionpos=b,float={*t}"
inline false
status open

\begin_layout Plain Layout

TPCONF_router_queues = [ 
\end_layout

\begin_layout Plain Layout

	('1', " source='172.16.10.60', dest='172.16.11.67', delay=V_delay, " 
\end_layout

\begin_layout Plain Layout

          " loss=V_loss, rate=V_up_rate, queue_disc=V_aqm, queue_size=V_bsize
 "), 
\end_layout

\begin_layout Plain Layout

	('2', " source='172.16.11.67', dest='172.16.10.60', delay=V_delay, " 
\end_layout

\begin_layout Plain Layout

          " loss=V_loss, rate=V_down_rate, queue_disc=V_aqm, queue_size=V_bsize
 "), 
\end_layout

\begin_layout Plain Layout

	('3', " source='172.16.10.61', dest='172.16.11.68', delay=V_delay2, " 
\end_layout

\begin_layout Plain Layout

          " loss=V_loss, rate=V_up_rate, queue_disc=V_aqm, queue_size=V_bsize,
 " 
\end_layout

\begin_layout Plain Layout

          " attach_to_queue='1' "), 
\end_layout

\begin_layout Plain Layout

	('4', " source='172.16.11.68', dest='172.16.10.61', delay=V_delay2, " 
\end_layout

\begin_layout Plain Layout

          " loss=V_loss, rate=V_down_rate, queue_disc=V_aqm, queue_size=V_bsize,
 " 
\end_layout

\begin_layout Plain Layout

          " attach_to_queue='2' "), 
\end_layout

\begin_layout Plain Layout

]
\end_layout

\begin_layout Plain Layout

\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "lis:Scenario4-Router"

\end_inset

Scenario 4, router queue configuration
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
We also need to define both of the V_ variables and make sure we iterate
 over both in the experiments (see Listing 
\begin_inset CommandInset ref
LatexCommand ref
reference "lis:Scenario4-Parameters"

\end_inset

).
 
\end_layout

\begin_layout Standard
\begin_inset listings
lstparams "basicstyle={\footnotesize\ttfamily},captionpos=b,float={*t}"
inline false
status open

\begin_layout Plain Layout

TPCONF_delays = [5, 50] 
\end_layout

\begin_layout Plain Layout

TPCONF_delays2 = [5, 50]
\end_layout

\begin_layout Plain Layout

TPCONF_parameter_list = { 
\end_layout

\begin_layout Plain Layout

	# Vary name V_ variable file name values extra vars 
\end_layout

\begin_layout Plain Layout

	'delays' : (['V_delay'], ['del1'], TPCONF_delays, {}), 
\end_layout

\begin_layout Plain Layout

	'delays2' : (['V_delay2'], ['del2'], TPCONF_delays2, {}), 
\end_layout

\begin_layout Plain Layout

	'loss' : (['V_loss'], ['loss'], TPCONF_loss_rates, {}), 
\end_layout

\begin_layout Plain Layout

	'tcpalgos' : (['V_tcp_cc_algo'],['tcp'], TPCONF_TCP_algos, {}), 
\end_layout

\begin_layout Plain Layout

	'aqms' : (['V_aqm'], ['aqm'], TPCONF_aqms, {}), 
\end_layout

\begin_layout Plain Layout

	'bsizes' : (['V_bsize'], ['bs'], TPCONF_buffer_sizes, {}), 
\end_layout

\begin_layout Plain Layout

	'runs' : (['V_runs'], ['run'], range(TPCONF_runs), {}), 
\end_layout

\begin_layout Plain Layout

	'bandwidths' : (['V_down_rate', 'V_up_rate'], ['down', 'up'], TPCONF_bandwidths
, {}), 
\end_layout

\begin_layout Plain Layout

}
\end_layout

\begin_layout Plain Layout

TPCONF_variable_defaults = { 
\end_layout

\begin_layout Plain Layout

	# V_ variable value 
\end_layout

\begin_layout Plain Layout

	'V_duration' : TPCONF_duration, 
\end_layout

\begin_layout Plain Layout

	'V_delay' : TPCONF_delays[0], 
\end_layout

\begin_layout Plain Layout

	'V_delay2' : TPCONF_delays2[0], 
\end_layout

\begin_layout Plain Layout

	'V_loss' : TPCONF_loss_rates[0], 
\end_layout

\begin_layout Plain Layout

	'V_tcp_cc_algo' : TPCONF_TCP_algos[0], 
\end_layout

\begin_layout Plain Layout

	'V_down_rate' : TPCONF_bandwidths[0][0], 
\end_layout

\begin_layout Plain Layout

	'V_up_rate' : TPCONF_bandwidths[0][1], 
\end_layout

\begin_layout Plain Layout

	'V_aqm' : TPCONF_aqms[0], 
\end_layout

\begin_layout Plain Layout

	'V_bsize' : TPCONF_buffer_sizes[0], 
\end_layout

\begin_layout Plain Layout

}
\end_layout

\begin_layout Plain Layout

TPCONF_vary_parameters = ['delays', 'delays2', 'bandwidths', 'aqms', 'runs',]
\end_layout

\begin_layout Plain Layout

\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "lis:Scenario4-Parameters"

\end_inset

Scenario 4, experiment parameter configuration
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
Finally, we need to define the traffic generators to create one TCP bulk
 transfer flow for each host pair as shown in Listing 
\begin_inset CommandInset ref
LatexCommand ref
reference "lis:Scenario4-Traffic"

\end_inset

.
 
\end_layout

\begin_layout Standard
\begin_inset listings
lstparams "basicstyle={\footnotesize\ttfamily},captionpos=b,float={*t}"
inline false
status open

\begin_layout Plain Layout

traffic_iperf = [ 
\end_layout

\begin_layout Plain Layout

	('0.0', '1', " start_iperf, client='newtcp27', server='newtcp20', port=5000,
 " 
\end_layout

\begin_layout Plain Layout

                 " duration=V_duration "), 
\end_layout

\begin_layout Plain Layout

	('0.0', '2', " start_iperf, client='newtcp28', server='newtcp21', port=5001,
 " 
\end_layout

\begin_layout Plain Layout

                 " duration=V_duration "), 
\end_layout

\begin_layout Plain Layout

]
\end_layout

\begin_layout Plain Layout

TPCONF_traffic_gens = traffic_iperf
\end_layout

\begin_layout Plain Layout

\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "lis:Scenario4-Traffic"

\end_inset

Scenario 4, traffic configuration
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Subsubsection
Run and analyse experiment
\end_layout

\begin_layout Standard
See scenario 1.
\end_layout

\begin_layout Subsection
Scenario 5: Partially overlapping TCP flows with different TCP CC
\end_layout

\begin_layout Subsubsection
Topology
\end_layout

\begin_layout Standard
We now have three hosts in each subnet: newtcp20, newtcp21 and newtcp22
 connected to the 172.16.10.0/24 network, and newtcp27, newtcp28 and newtcp29
 connected to the 172.16.11.0/24 network.
 The machine newtcprt3 connects the two experiment subnets.
 All three machines also have a second network interface that is used to
 control the experiment via TEACUP.
 Like scenario 1 this scenario requires that hosts have the traffic generator
 and logging tools installed as described in 
\begin_inset CommandInset citation
LatexCommand cite
key "zander2014caia_tcp_testbed_v2"

\end_inset

, but PXE booting or a multi-OS installation is not needed.
\end_layout

\begin_layout Subsubsection
Test Traffic
\end_layout

\begin_layout Standard
Three TCP bulk transfer flows are created using iperf.
 One flow is between newtcp20 and newtcp27, the second flow is between newtcp21
 and newtcp28, and the third flow is between newtcp22 and newtcp29.
 The flows do not longer start at the same time.
 Flow one start at the start of the experiment, while flow 2 starts 10 seconds
 after the first flow and flow 3 starts 10 seconds after flow 2.
 All flows have a duration of 30 seconds as in scenario 1.
\end_layout

\begin_layout Subsubsection
Variable Parameters
\end_layout

\begin_layout Standard
Like in scenario 1 we emulate three different delays (same delays for all
 flows) and two different bandwidth settings.
 However, we now also vary the used TCP congestion control algorithm between
 Newreno and Cubic.
 This means we have 12 different experiments in total.
 We do also define a variable parameter for AQM, but define only one AQM
 (default pfifo).
 This causes the used AQM to be logged as part of the experiment ID.
\end_layout

\begin_layout Subsubsection
TEACUP Config File
\end_layout

\begin_layout Standard
You can download the configuration file from 
\begin_inset CommandInset citation
LatexCommand cite
key "teacup-examples-web"

\end_inset

.
 To use the configuration rename it to config.py.
 In the following we explain the parts of the configuration file that have
 changed compared to scenario 1.
\end_layout

\begin_layout Standard
Our host configuration now looks as shown in Listing 
\begin_inset CommandInset ref
LatexCommand ref
reference "lis:Scenario5-Hosts"

\end_inset

.
 
\end_layout

\begin_layout Standard
\begin_inset listings
lstparams "basicstyle={\footnotesize\ttfamily},captionpos=b,float={*t}"
inline false
status open

\begin_layout Plain Layout

TPCONF_router = ['newtcprt3', ] 
\end_layout

\begin_layout Plain Layout

TPCONF_hosts = [ 'newtcp20', 'newtcp21', 'newtcp22', 'newtcp27', 'newtcp28',
 'newtcp29', ]
\end_layout

\begin_layout Plain Layout

TPCONF_host_internal_ip = { 
\end_layout

\begin_layout Plain Layout

	'newtcprt3': ['172.16.10.1', '172.16.11.1'], 
\end_layout

\begin_layout Plain Layout

	'newtcp20': ['172.16.10.60'], 
\end_layout

\begin_layout Plain Layout

	'newtcp21': ['172.16.10.61'], 
\end_layout

\begin_layout Plain Layout

	'newtcp22': ['172.16.10.62'], 
\end_layout

\begin_layout Plain Layout

	'newtcp27': ['172.16.11.67'], 
\end_layout

\begin_layout Plain Layout

	'newtcp28': ['172.16.11.68'], 
\end_layout

\begin_layout Plain Layout

	'newtcp29': ['172.16.11.69'], 
\end_layout

\begin_layout Plain Layout

}
\end_layout

\begin_layout Plain Layout

\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "lis:Scenario5-Hosts"

\end_inset

Scenario 5, host configuration
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
The traffic generator setup now creates three staggered flows as shown in
 Listing 
\begin_inset CommandInset ref
LatexCommand ref
reference "lis:Scenario5-Traffic"

\end_inset

.
 
\end_layout

\begin_layout Standard
\begin_inset listings
lstparams "basicstyle={\footnotesize\ttfamily},captionpos=b,float={*t}"
inline false
status open

\begin_layout Plain Layout

traffic_iperf = [ 
\end_layout

\begin_layout Plain Layout

	('0.0', '1', " start_iperf, client='newtcp27', server='newtcp20', port=5000,
 " 
\end_layout

\begin_layout Plain Layout

	             " duration=V_duration "), 
\end_layout

\begin_layout Plain Layout

	('10.0', '2', " start_iperf, client='newtcp28', server='newtcp21', port=5001,
 " 
\end_layout

\begin_layout Plain Layout

                  " duration=V_duration "), 
\end_layout

\begin_layout Plain Layout

	('20.0', '3', " start_iperf, client='newtcp29', server='newtcp22', port=5002,
 " 
\end_layout

\begin_layout Plain Layout

                  " duration=V_duration "), 
\end_layout

\begin_layout Plain Layout

]
\end_layout

\begin_layout Plain Layout

TPCONF_traffic_gens = traffic_iperf
\end_layout

\begin_layout Plain Layout

\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "lis:Scenario5-Traffic"

\end_inset

Scenario 5, traffic configuration
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
We also need to configure the different TCP congestion control algorithms
 and instruct TEACUP to vary this parameter (see Listing 
\begin_inset CommandInset ref
LatexCommand ref
reference "lis:Scenario5-Parameters"

\end_inset

).
 
\end_layout

\begin_layout Standard
\begin_inset listings
lstparams "basicstyle={\footnotesize\ttfamily},captionpos=b,float={*t}"
inline false
status open

\begin_layout Plain Layout

TPCONF_TCP_algos = ['newreno', 'cubic', ]
\end_layout

\begin_layout Plain Layout

TPCONF_parameter_list = { 
\end_layout

\begin_layout Plain Layout

	'delays' : (['V_delay'], ['del'], TPCONF_delays, {}), 
\end_layout

\begin_layout Plain Layout

	'loss' : (['V_loss'], ['loss'], TPCONF_loss_rates, {}), 
\end_layout

\begin_layout Plain Layout

	'tcpalgos' : (['V_tcp_cc_algo'],['tcp'], TPCONF_TCP_algos, {}), 
\end_layout

\begin_layout Plain Layout

	'aqms' : (['V_aqm'], ['aqm'], TPCONF_aqms, {}), 
\end_layout

\begin_layout Plain Layout

	'bsizes' : (['V_bsize'], ['bs'], TPCONF_buffer_sizes, {}), 
\end_layout

\begin_layout Plain Layout

	'runs' : (['V_runs'], ['run'], range(TPCONF_runs), {}), 
\end_layout

\begin_layout Plain Layout

	'bandwidths' : (['V_down_rate', 'V_up_rate'], ['down', 'up'], TPCONF_bandwidths
, {}), 
\end_layout

\begin_layout Plain Layout

}
\end_layout

\begin_layout Plain Layout

TPCONF_variable_defaults = { 
\end_layout

\begin_layout Plain Layout

	'V_duration' : TPCONF_duration, 
\end_layout

\begin_layout Plain Layout

	'V_delay' : TPCONF_delays[0], 
\end_layout

\begin_layout Plain Layout

	'V_loss' : TPCONF_loss_rates[0], 
\end_layout

\begin_layout Plain Layout

	'V_tcp_cc_algo' : TPCONF_TCP_algos[0], 
\end_layout

\begin_layout Plain Layout

	'V_down_rate' : TPCONF_bandwidths[0][0], 
\end_layout

\begin_layout Plain Layout

	'V_up_rate' : TPCONF_bandwidths[0][1], 
\end_layout

\begin_layout Plain Layout

	'V_aqm' : TPCONF_aqms[0], 
\end_layout

\begin_layout Plain Layout

	'V_bsize' : TPCONF_buffer_sizes[0], 
\end_layout

\begin_layout Plain Layout

}
\end_layout

\begin_layout Plain Layout

TPCONF_vary_parameters = ['tcpalgos', 'delays', 'bandwidths', 'aqms', 'runs',]
\end_layout

\begin_layout Plain Layout

\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "lis:Scenario5-Parameters"

\end_inset

Scenario 5, variable parameter configuration
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Subsubsection
Run and analyse experiment
\end_layout

\begin_layout Standard
See scenario 1.
\end_layout

\begin_layout Subsection
Scenario 6: Two HTTP-based video streaming clients
\end_layout

\begin_layout Subsubsection
Topology
\end_layout

\begin_layout Standard
We now have hosts newtcp20, newtcp21 connected to the 172.16.10.0/24 network
 and host newtcp27 connected to the 172.16.11.0/24 network.
 The machine newtcprt3 connects the two experiment subnets.
 All three machines also have a second network interface that is used to
 control the experiment via TEACUP.
 Like scenario 1 this scenario requires that hosts have the traffic generator
 and logging tools installed as described in 
\begin_inset CommandInset citation
LatexCommand cite
key "zander2014caia_tcp_testbed_v2"

\end_inset

, but PXE booting or a multi-OS installation is not needed.
\end_layout

\begin_layout Subsubsection
Test Traffic
\end_layout

\begin_layout Standard
In this scenario we simulate DASH-like HTTP video streaming.
 Host newtcp27 runs a web server.
 Host newtcp20 and newtcp21 are clients and use httperf to emulate DASH-like
 streaming -- there is one DASH-like flow between each client and the server.
 In this scenario we have fixed the video rates and on/off cycle times,
 but the rate and cycle time differs for both streams.
\end_layout

\begin_layout Subsubsection
Variable Parameters
\end_layout

\begin_layout Standard
Like in scenario 1 we emulate three different delays (same delays for all
 flows) and two different bandwidth settings.
 We now also vary the AQM mechanism used on the router between FIFO, CoDel
 and FQ CoDel.
 This means we have 18 experiments in total.
\end_layout

\begin_layout Subsubsection
TEACUP Config File
\end_layout

\begin_layout Standard
You can download the configuration file from 
\begin_inset CommandInset citation
LatexCommand cite
key "teacup-examples-web"

\end_inset

.
 To use the configuration rename it to config.py.
 In the following we explain the parts of the configuration file that have
 changed compared to scenario 1.
\end_layout

\begin_layout Standard
Our host configuration now looks as in Listing 
\begin_inset CommandInset ref
LatexCommand ref
reference "lis:Scenario6-Hosts"

\end_inset

.
\end_layout

\begin_layout Standard
\begin_inset listings
lstparams "basicstyle={\footnotesize\ttfamily},captionpos=b,float={*t}"
inline false
status open

\begin_layout Plain Layout

TPCONF_router = ['newtcprt3', ] 
\end_layout

\begin_layout Plain Layout

TPCONF_hosts = [ 'newtcp20', 'newtcp21', 'newtcp27', ]
\end_layout

\begin_layout Plain Layout

TPCONF_host_internal_ip = { 
\end_layout

\begin_layout Plain Layout

	'newtcprt3': ['172.16.10.1', '172.16.11.1'], 
\end_layout

\begin_layout Plain Layout

	'newtcp20': ['172.16.10.60'], 
\end_layout

\begin_layout Plain Layout

	'newtcp21': ['172.16.10.61'], 
\end_layout

\begin_layout Plain Layout

	'newtcp27': ['172.16.11.67'], 
\end_layout

\begin_layout Plain Layout

}
\end_layout

\begin_layout Plain Layout

\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "lis:Scenario6-Hosts"

\end_inset

Scenario 6, host configuration
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
The traffic generator setup now starts a web server and generates fake streaming
 content on newtcp27 before starting the DASH-like flows as shown in Listing
 
\begin_inset CommandInset ref
LatexCommand ref
reference "lis:Scenario6-Traffic"

\end_inset

.
 
\end_layout

\begin_layout Standard
\begin_inset listings
lstparams "basicstyle={\footnotesize\ttfamily},captionpos=b,float={*t}"
inline false
status open

\begin_layout Plain Layout

traffic_dash = [ 
\end_layout

\begin_layout Plain Layout

	# Start server and create content (server must be started first) 
\end_layout

\begin_layout Plain Layout

	('0.0', '1', " start_http_server, server='newtcp27', port=80 "), 
\end_layout

\begin_layout Plain Layout

	('0.0', '2', " create_http_dash_content, server='newtcp27', duration=2*V_duratio
n, " 
\end_layout

\begin_layout Plain Layout

                 " rates='500, 1000', cycles='5, 10' "),
\end_layout

\begin_layout Plain Layout

	# Create DASH-like flows 
\end_layout

\begin_layout Plain Layout

	('0.5', '3', " start_httperf_dash, client='newtcp20', server='newtcp27',
 port=80, " 
\end_layout

\begin_layout Plain Layout

                 " duration=V_duration, rate=500, cycle=5, prefetch=2.0,
 " 
\end_layout

\begin_layout Plain Layout

                 " prefetch_timeout=2.0 "), 
\end_layout

\begin_layout Plain Layout

	('0.5', '4', " start_httperf_dash, client='newtcp20', server='newtcp27',
 port=80, " 
\end_layout

\begin_layout Plain Layout

                 " duration=V_duration, rate=1000, cycle=10, prefetch=2.0,
 " 
\end_layout

\begin_layout Plain Layout

                 " prefetch_timeout=2.0 "),
\end_layout

\begin_layout Plain Layout

]
\end_layout

\begin_layout Plain Layout

TPCONF_traffic_gens = traffic_dash
\end_layout

\begin_layout Plain Layout

\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "lis:Scenario6-Traffic"

\end_inset

Scenario 6, traffic configuration
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
Finally, we need to configure the different AQM mechanisms used (see Listing
 
\begin_inset CommandInset ref
LatexCommand ref
reference "lis:Scenario6-Parameters"

\end_inset

).
 TPCONF_vary_parameters already included the `aqms' parameters in scenario
 1, so TPCONF_parameter_list and TPCONF_variable_defaults look like in scenario
 1.
 We only have to change TPCONF_aqms.
\end_layout

\begin_layout Standard
\begin_inset listings
lstparams "basicstyle={\footnotesize\ttfamily},captionpos=b,float={*t}"
inline false
status open

\begin_layout Plain Layout

TPCONF_aqms = ['pfifo', 'codel', 'fq_codel', ]
\end_layout

\begin_layout Plain Layout

TPCONF_vary_parameters = ['delays', 'bandwidths', 'aqms', 'runs',]
\end_layout

\begin_layout Plain Layout

\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "lis:Scenario6-Parameters"

\end_inset

Scenario 6, parameter configuration
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Subsubsection
Run and analyse experiment
\end_layout

\begin_layout Standard
See scenario 1.
\end_layout

\begin_layout Subsection
Scenario 7: Incast problem scenario
\end_layout

\begin_layout Subsubsection
Topology
\end_layout

\begin_layout Standard
We now have the host newtcp20 connected to the 172.16.10.0/24 network and hosts
 newtcp22--30 connected to the 172.16.11.0/24 network.
 The machine newtcprt3 connects the two experiment subnets.
 All three machines also have a second network interface that is used to
 control the experiment via TEACUP.
 Like scenario 1 this scenario requires that hosts have the traffic generator
 and logging tools installed as described in 
\begin_inset CommandInset citation
LatexCommand cite
key "zander2014caia_tcp_testbed_v2"

\end_inset

, but PXE booting or a multi-OS installation is not needed.
\end_layout

\begin_layout Subsubsection
Test Traffic
\end_layout

\begin_layout Standard
In this scenario we emulate traffic to investigate the incast problem.
 The host newtcp20 is the querier and in regular intervals sends simultaneous
 queries to hosts newtcp21, newtcp22, newtcp23, newtcp24, newtcp25, newtcp26,
 newtcp27, newtcp28, newtcp29 and newtcp30 which then respond simultaneously.
 The querier uses httperf to send the queries to web servers running on
 all of the responders.
\end_layout

\begin_layout Subsubsection
Variable Parameters
\end_layout

\begin_layout Standard
Like in scenario 6 we emulate three different delays (same delays for all
 flows), two different bandwidth settings, and three different AQM mechanism
 (FIFO, CoDel and FQ CoDel).
 We now also vary the size of the response between six different values.
 This means we have 108 experiments in total.
\end_layout

\begin_layout Subsubsection
TEACUP Config File
\end_layout

\begin_layout Standard
You can download the configuration file from 
\begin_inset CommandInset citation
LatexCommand cite
key "teacup-examples-web"

\end_inset

.
 To use the configuration rename it to config.py.
 In the following we explain the parts of the configuration file that have
 changed compared to scenario 6.
\end_layout

\begin_layout Standard
Our host configuration now looks as in Listing 
\begin_inset CommandInset ref
LatexCommand ref
reference "lis:Scenario7-Hosts"

\end_inset

.
\end_layout

\begin_layout Standard
\begin_inset listings
lstparams "basicstyle={\footnotesize\ttfamily},captionpos=b,float={*t}"
inline false
status open

\begin_layout Plain Layout

TPCONF_router = ['newtcprt3', ] 
\end_layout

\begin_layout Plain Layout

TPCONF_hosts = [ 
\end_layout

\begin_layout Plain Layout

	'newtcp20', 'newtcp21', 'newtcp22', 'newtcp23', 'newtcp24', 
\end_layout

\begin_layout Plain Layout

    'newtcp25', 'newtcp26', 'newtcp27', 'newtcp28', 'newtcp29', 'newtcp30',
 
\end_layout

\begin_layout Plain Layout

]
\end_layout

\begin_layout Plain Layout

TPCONF_host_internal_ip = { 
\end_layout

\begin_layout Plain Layout

	'newtcprt3': ['172.16.10.1', '172.16.11.1'],
\end_layout

\begin_layout Plain Layout

	'newtcp20': ['172.16.10.60'], # querier 
\end_layout

\begin_layout Plain Layout

	'newtcp21': ['172.16.11.61'], # responders...
 
\end_layout

\begin_layout Plain Layout

	'newtcp22': ['172.16.11.62'], 
\end_layout

\begin_layout Plain Layout

	'newtcp23': ['172.16.11.63'], 
\end_layout

\begin_layout Plain Layout

	'newtcp24': ['172.16.11.64'], 
\end_layout

\begin_layout Plain Layout

	'newtcp25': ['172.16.11.65'], 
\end_layout

\begin_layout Plain Layout

	'newtcp26': ['172.16.11.66'], 
\end_layout

\begin_layout Plain Layout

	'newtcp27': ['172.16.11.67'], 
\end_layout

\begin_layout Plain Layout

	'newtcp28': ['172.16.11.68'], 
\end_layout

\begin_layout Plain Layout

	'newtcp29': ['172.16.11.69'], 
\end_layout

\begin_layout Plain Layout

	'newtcp30': ['172.16.11.70'], 
\end_layout

\begin_layout Plain Layout

}
\end_layout

\begin_layout Plain Layout

\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "lis:Scenario7-Hosts"

\end_inset

Scenario 7, host configuration
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
The traffic generator setup now starts a web server and generates fake streaming
 content on each responder.
 Then after a delay of one second it starts the querier.
 Listing 
\begin_inset CommandInset ref
LatexCommand ref
reference "lis:Scenario7-Traffic"

\end_inset

 shows the configuration.
 Setting up each server individually requires a large number of entries
 in the traffic configuration.
 Since version 0.9 TEACUP supports the start_httperf_incast_n traffic generator
 that will setup the 
\begin_inset Formula $n$
\end_inset

 servers and the querier with a single entry.
\end_layout

\begin_layout Standard
\begin_inset listings
lstparams "basicstyle={\scriptsize\ttfamily},captionpos=b,float={*t}"
inline false
status open

\begin_layout Plain Layout

traffic_incast = [ 
\end_layout

\begin_layout Plain Layout

	# Start servers and create contents (server must be started first) 
\end_layout

\begin_layout Plain Layout

	('0.0', '1', " start_http_server, server='newtcp21', port=80 "), 
\end_layout

\begin_layout Plain Layout

	('0.0', '2', " start_http_server, server='newtcp22', port=80 "), 
\end_layout

\begin_layout Plain Layout

	('0.0', '3', " start_http_server, server='newtcp23', port=80 "), 
\end_layout

\begin_layout Plain Layout

	('0.0', '4', " start_http_server, server='newtcp24', port=80 "), 
\end_layout

\begin_layout Plain Layout

	('0.0', '5', " start_http_server, server='newtcp25', port=80 "), 
\end_layout

\begin_layout Plain Layout

	('0.0', '6', " start_http_server, server='newtcp26', port=80 "), 
\end_layout

\begin_layout Plain Layout

	('0.0', '7', " start_http_server, server='newtcp27', port=80 "), 
\end_layout

\begin_layout Plain Layout

	('0.0', '8', " start_http_server, server='newtcp28', port=80 "), 
\end_layout

\begin_layout Plain Layout

	('0.0', '9', " start_http_server, server='newtcp29', port=80 "), 
\end_layout

\begin_layout Plain Layout

	('0.0', '10', " start_http_server, server='newtcp30', port=80 "),
\end_layout

\begin_layout Plain Layout

	('0.0', '11', " create_http_incast_content, server='newtcp21', duration=2*V_dura
tion, " 
\end_layout

\begin_layout Plain Layout

                  " sizes=V_inc_content_sizes_str "), 
\end_layout

\begin_layout Plain Layout

	('0.0', '12', " create_http_incast_content, server='newtcp22', duration=2*V_dura
tion, " 
\end_layout

\begin_layout Plain Layout

                  " sizes=V_inc_content_sizes_str "), 
\end_layout

\begin_layout Plain Layout

	('0.0', '13', " create_http_incast_content, server='newtcp23', duration=2*V_dura
tion, " 
\end_layout

\begin_layout Plain Layout

                  " sizes=V_inc_content_sizes_str "), 
\end_layout

\begin_layout Plain Layout

	('0.0', '14', " create_http_incast_content, server='newtcp24', duration=2*V_dura
tion, " 
\end_layout

\begin_layout Plain Layout

                  " sizes=V_inc_content_sizes_str "), 
\end_layout

\begin_layout Plain Layout

	('0.0', '15', " create_http_incast_content, server='newtcp25', duration=2*V_dura
tion, "   
\end_layout

\begin_layout Plain Layout

                  " sizes=V_inc_content_sizes_str "), 
\end_layout

\begin_layout Plain Layout

	('0.0', '16', " create_http_incast_content, server='newtcp26', duration=2*V_dura
tion, " 
\end_layout

\begin_layout Plain Layout

                  " sizes=V_inc_content_sizes_str "), 
\end_layout

\begin_layout Plain Layout

	('0.0', '17', " create_http_incast_content, server='newtcp27', duration=2*V_dura
tion, " 
\end_layout

\begin_layout Plain Layout

                  " sizes=V_inc_content_sizes_str "), 
\end_layout

\begin_layout Plain Layout

	('0.0', '18', " create_http_incast_content, server='newtcp28', duration=2*V_dura
tion, " 
\end_layout

\begin_layout Plain Layout

                  " sizes=V_inc_content_sizes_str "), 
\end_layout

\begin_layout Plain Layout

	('0.0', '19', " create_http_incast_content, server='newtcp29', duration=2*V_dura
tion, " 
\end_layout

\begin_layout Plain Layout

                  " sizes=V_inc_content_sizes_str "),
\end_layout

\begin_layout Plain Layout

	('0.0', '20', " create_http_incast_content, server='newtcp30', duration=2*V_dura
tion, " 
\end_layout

\begin_layout Plain Layout

                  " sizes=V_inc_content_sizes_str "),
\end_layout

\begin_layout Plain Layout

	# Start querier 
\end_layout

\begin_layout Plain Layout

	('1.0', '30', " start_httperf_incast, client='newtcp20', " 
\end_layout

\begin_layout Plain Layout

	  " servers='newtcp21:80,newtcp22:80,newtcp23:80,newtcp24:80,newtcp25:80,newtcp
26:80, "
\end_layout

\begin_layout Plain Layout

      " newtcp27:80,newtcp28:80,newtcp29:80,newtcp30:80', "
\end_layout

\begin_layout Plain Layout

      " duration=V_duration, period=V_inc_period, response_size=V_inc_size"),
 
\end_layout

\begin_layout Plain Layout

]
\end_layout

\begin_layout Plain Layout

TPCONF_traffic_gens = traffic_incast
\end_layout

\begin_layout Plain Layout

\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "lis:Scenario7-Traffic"

\end_inset

Scenario 7, traffic configuration
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
Next, we need to configure the value ranges for response sizes and the time
 period between sending queries (see Listing 
\begin_inset CommandInset ref
LatexCommand ref
reference "lis:Scenario7-Parameters"

\end_inset

).
\end_layout

\begin_layout Standard
\begin_inset listings
lstparams "basicstyle={\footnotesize\ttfamily},captionpos=b,float={*t}"
inline false
status open

\begin_layout Plain Layout

TPCONF_inc_content_sizes = [8, 16, 32, 64, 128, 256] 
\end_layout

\begin_layout Plain Layout

TPCONF_inc_content_sizes_str = ','.join( str(x) for x in TPCONF_inc_content_sizes
)
\end_layout

\begin_layout Plain Layout

TPCONF_inc_periods = [10]
\end_layout

\begin_layout Plain Layout

\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "lis:Scenario7-Parameters"

\end_inset

Scenario 7, incast content parameter configuration
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
Finally, we need to configure TEACUP to make sure the V_ variables used
 in the traffic generator setup are defined and we vary the response sizes
 (see Listing 
\begin_inset CommandInset ref
LatexCommand ref
reference "lis:Scenario7-Vary-parameters"

\end_inset

).
\end_layout

\begin_layout Standard
\begin_inset listings
lstparams "basicstyle={\footnotesize\ttfamily},captionpos=b,float={*t}"
inline false
status open

\begin_layout Plain Layout

TPCONF_parameter_list = { 
\end_layout

\begin_layout Plain Layout

	'delays' : (['V_delay'], ['del'], TPCONF_delays, {}), 
\end_layout

\begin_layout Plain Layout

	'loss' : (['V_loss'], ['loss'], TPCONF_loss_rates, {}), 
\end_layout

\begin_layout Plain Layout

	'tcpalgos' : (['V_tcp_cc_algo'],['tcp'], TPCONF_TCP_algos, {}), 
\end_layout

\begin_layout Plain Layout

	'aqms' : (['V_aqm'], ['aqm'], TPCONF_aqms, {}), 
\end_layout

\begin_layout Plain Layout

	'bsizes' : (['V_bsize'], ['bs'], TPCONF_buffer_sizes, {}), 
\end_layout

\begin_layout Plain Layout

	'runs' : (['V_runs'], ['run'], range(TPCONF_runs), {}), 
\end_layout

\begin_layout Plain Layout

	'bandwidths' : (['V_down_rate', 'V_up_rate'], ['down', 'up'], TPCONF_bandwidths
, {}),
\end_layout

\begin_layout Plain Layout

	'incast_periods': (['V_inc_period'], ['incper'], TPCONF_inc_periods, {}),
 
\end_layout

\begin_layout Plain Layout

	'incast_sizes' : (['V_inc_size'], ['incsz'], TPCONF_inc_content_sizes,{}),
 
\end_layout

\begin_layout Plain Layout

}
\end_layout

\begin_layout Plain Layout

TPCONF_variable_defaults = { 
\end_layout

\begin_layout Plain Layout

	'V_duration' : TPCONF_duration, 
\end_layout

\begin_layout Plain Layout

	'V_delay' : TPCONF_delays[0], 
\end_layout

\begin_layout Plain Layout

	'V_loss' : TPCONF_loss_rates[0], 
\end_layout

\begin_layout Plain Layout

	'V_tcp_cc_algo' : TPCONF_TCP_algos[0], 
\end_layout

\begin_layout Plain Layout

	'V_down_rate' : TPCONF_bandwidths[0][0], 
\end_layout

\begin_layout Plain Layout

	'V_up_rate' : TPCONF_bandwidths[0][1], 
\end_layout

\begin_layout Plain Layout

	'V_aqm' : TPCONF_aqms[0], 
\end_layout

\begin_layout Plain Layout

	'V_bsize' : TPCONF_buffer_sizes[0], 
\end_layout

\begin_layout Plain Layout

	'V_inc_period' : TPCONF_inc_periods[0], 
\end_layout

\begin_layout Plain Layout

	'V_inc_size' : TPCONF_inc_content_sizes[0], 
\end_layout

\begin_layout Plain Layout

	'V_inc_content_sizes_str': TPCONF_inc_content_sizes_str,
\end_layout

\begin_layout Plain Layout

}
\end_layout

\begin_layout Plain Layout

TPCONF_vary_parameters = ['incast_sizes', 'delays', 'bandwidths', 'aqms',
 'runs',]
\end_layout

\begin_layout Plain Layout

\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "lis:Scenario7-Vary-parameters"

\end_inset

Scenario 7, variable parameter configuration
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Subsubsection
Run and analyse experiment
\end_layout

\begin_layout Standard
See scenario 1.
\end_layout

\begin_layout Section
Extending TEACUP Functionality
\end_layout

\begin_layout Standard
\begin_inset CommandInset label
LatexCommand label
name "sec:Extending"

\end_inset


\end_layout

\begin_layout Standard
This section contains some notes on extending the current implementation.
 We refer to Python functions (which can be Fabric tasks) using the notation
 of <python_file>.py:<function>().
\end_layout

\begin_layout Subsection
Additional host setup
\end_layout

\begin_layout Standard
Any general host setup (e.g.
 sysctl settings for all experiments) should be added in 
\family typewriter
\size footnotesize
hostsetup.py:init_host()
\family default
\size default
.
 Note that in this function there are different sections, one for each OS
 (FreeBSD, Linux, 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
mbox{
\end_layout

\end_inset

Windows/Cygwin
\begin_inset ERT
status open

\begin_layout Plain Layout

}
\end_layout

\end_inset

, Mac OS X).
 Commands that shall only be executed in certain experiments can be set
 in the config (TPCONF_host_init_custom_cmds).
\end_layout

\begin_layout Subsection
New TCP congestion control algorithm
\end_layout

\begin_layout Standard
Adding support for a new TCP congestion control algorithm requires modifying
 
\family typewriter
\size footnotesize
hostsetup.py:init_cc_algo()
\family default
\size default
.
 The new algorithm needs to be added to the list of supported algorithms
 and in the OS-specific sections code need to be added to load the corresponding
 kernel module (if any).
\end_layout

\begin_layout Subsection
New traffic generator
\end_layout

\begin_layout Standard
Adding a new traffic generator requires adding a new start task in 
\family typewriter
\size small
trafficgens.py
\family default
\size default
.
 The current start tasks always consist of two methods, the actual start
 method is a wrapper around an internal _start method.
 This allows having the host on which the generator is started as explicit
 parameter (and not as Fabric hosts parameter) and having multiple traffic
 generators that actually use the same underlying tool (for example this
 is the case for httperf).
 The new start method must be added to the imports in 
\family typewriter
\size small
experiment.py
\size default
.
\end_layout

\begin_layout Standard
The traffic generator start function must, after the traffic generator process
 has been started, register the started process with its process ID by calling
 
\family typewriter
\size footnotesize
bgproc.register_proc()
\family default
\size default
.
 This ensures that the process will be stopped at the end of the experiment
 and the traffic generator's log file is collected when 
\family typewriter
\size footnotesize
runbg.py:stop_processes()
\family default
\size default
 is called.
 A current limitation is that there can only be one log file per traffic
 generator process.
 
\end_layout

\begin_layout Standard
Some traffic generators also have stop methods.
 Initially, the idea was that traffic generators could be started and stopped
 from the command line directly, but this is not supported at the moment,
 i.e.
 some stop methods are not implemented (empty).
\end_layout

\begin_layout Subsection
New data logger
\end_layout

\begin_layout Standard
To add a new data logger a start method and possibly a stop method need
 to be added in 
\family typewriter
\size footnotesize
loggers.py
\family default
\size default
.
 The new logger's start method should be called from 
\family typewriter
\size footnotesize
loggers.py:start_loggers()
\family default
\size default
 via Fabric's execute(), but could also be called from 
\family typewriter
\size footnotesize
experiment.py:run_experiment()
\family default
\size default
 if required (in the latter case it must be added to the imports in 
\family typewriter
\size small
experiment.py
\family default
\size default
).
 
\end_layout

\begin_layout Standard
If the logger is a userspace process, such as tcpdump, at the end of the
 start function it should register itself (including its process ID) using
 
\family typewriter
\size footnotesize
bgproc.register_proc_later().
 
\family default
\size default
Then it is ensured that the logging process will be stopped at the end of
 the experiment and the log file is collected when 
\family typewriter
\size footnotesize
runbg.py:stop_processes()
\family default
\size default
 is called.
 In this case no stop method needs to be implemented.
 
\end_layout

\begin_layout Standard
If the logger is not a userspace process, for example SIFTR on FreeBSD,
 start 
\emph on
and
\emph default
 stop methods need to be implemented.
 The start method must still call 
\family typewriter
\size footnotesize
bgproc.register_proc_later()
\family default
\size default
, but the process ID must be set to zero.
 The stop method must be called from 
\family typewriter
\size footnotesize
runbg.py:stop_processes()
\family default
\size default
 if the process ID is zero and the internal TEACUP name of the process is
 the name of the new logger.
\end_layout

\begin_layout Subsection
New analysis method
\end_layout

\begin_layout Standard
To add a new analysis method add an analysis task in 
\family typewriter
\size footnotesize
analysis.py
\family default
\size default
.
 If the new analysis should be carried out as part of the analyse_all task,
 the new task must be called from 
\family typewriter
\size footnotesize
analysis.py:analyse_all()
\family default
\size default
 via Fabrics 
\family typewriter
\size footnotesize
execute()
\family default
\size default
 function.
 The new task should implement the common parameters test_id, out_dir, pdf_dir,
 out_name, replot_only, source_filter, min_values, etime, stime, ymin, ymax
 (see existing analyse tasks as examples).
 The new task must be added to the imports in 
\family typewriter
\size footnotesize
fabfile.py
\family default
\size default
.
\end_layout

\begin_layout Section
Known Issues
\end_layout

\begin_layout Standard
\begin_inset CommandInset label
LatexCommand label
name "sec:Issues"

\end_inset


\end_layout

\begin_layout Standard
During the host setup phase TEACUP enables and disables NICs.
 On Windows the enable and disable NIC commands have permanent effect.
 If TEACUP is interrupted or aborts between a disable and enable command,
 the NIC will stay disabled.
 TEACUP will automatically enable all testbed NICs on Windows prior to each
 experiment, however in the unlikely event that the previous aborted NIC
 configuration left the NIC in an inconsistent state, it may be necessary
 to reconfigure the NIC manually.
\end_layout

\begin_layout Standard
TEACUP logs all output from traffic generators, such as iperf or httperf.
 Some of the tools used only generate output after they completed.
 If an experiment ends 
\emph on
before
\emph default
 a tool completed its task, the resulting log file may be empty.
 Possibly this issue could be mitigated by turning the stdout and stderr
 buffering off for these tools in future versions.
 
\end_layout

\begin_layout Section
Conclusions and Future Work
\end_layout

\begin_layout Standard
\begin_inset CommandInset label
LatexCommand label
name "sec:Conclusions"

\end_inset


\end_layout

\begin_layout Standard
In this report we described TEACUP, a Python-based software we developed
 to run automated TCP performance tests in a controlled testbed.
 In the future we will continue to extend TEACUP with more features.
\end_layout

\begin_layout Section*
Acknowledgements
\end_layout

\begin_layout Standard
TEACUP versions prior to 1.0 were developed as part of a project funded by
 Cisco Systems and titled "Study in TCP Congestion Control Performance In
 A Data Centre".
 This was a collaborative effort between Swinburne University of Technology's
 Center for Advanced Internet Archectures and Fred Baker of Cisco Systems.
 These may be found at 
\begin_inset Flex URL
status collapsed

\begin_layout Plain Layout

http://caia.swin.edu.au/tools/teacup/downloads.html
\end_layout

\end_inset

.
\end_layout

\begin_layout Standard
Starting with TEACUP v1.0, development will be community supported and publicly
 hosted at 
\begin_inset Flex URL
status collapsed

\begin_layout Plain Layout

http://sourceforge.net/projects/teacup/
\end_layout

\end_inset

.
\end_layout

\begin_layout Section*
Copyright and License
\begin_inset CommandInset label
LatexCommand label
name "sec:Copying"

\end_inset


\end_layout

\begin_layout Standard
This document, 
\begin_inset Quotes eld
\end_inset

TEACUP v1.0 -- A System for Automated TCP Testbed Experiments
\begin_inset Quotes erd
\end_inset

 by Sebastian Zander and Grenville Armitage, is 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
copyright
\end_layout

\end_inset


\begin_inset space ~
\end_inset

2015 -- 2016 CAIA, Swinburne University of Technology.
 As of June 2016 this document has been licensed under a Creative Commons
 Attribution-ShareAlike 4.0 International License (CC BY-SA 4.0, 
\begin_inset Flex URL
status collapsed

\begin_layout Plain Layout

http://creativecommons.org/licenses/by-sa/4.0
\end_layout

\end_inset

).
 Based on a work at 
\begin_inset Flex URL
status collapsed

\begin_layout Plain Layout

http://caia.swin.edu.au/reports/150529A/CAIA-TR-150529A.pdf
\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
balance
\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset CommandInset bibtex
LatexCommand bibtex
bibfiles "teacup-system"
options "IEEEtran"

\end_inset


\end_layout

\end_body
\end_document
